function InputObserver(){this.isAcceptingInput=!0}window.me=window.me||{},function(a){function b(){if(!h){if(!e.body)return setTimeout(b,13);e.removeEventListener?e.removeEventListener("DOMContentLoaded",b,!1):a.removeEventListener("load",b,!1),h=!0;for(var c=0;c<i.length;c++)i[c].call(a,[]);i.length=0}}function c(){return g?void 0:(g=!0,"complete"===e.readyState?b():(e.addEventListener&&e.addEventListener("DOMContentLoaded",b,!1),void a.addEventListener("load",b,!1)))}function d(){f||(me.device._check(),me.save._init(),me.loader.setNocache(e.location.href.match(/\?nocache/)||!1),me.timer.init(),me.mapReader=new me.TMXMapReader,me.state.init(),me.entityPool.init(),me.levelDirector.reset(),f=!0)}var e=a.document;me={mod:"melonJS",version:"0.9.11"},me.sys={fps:60,interpolation:!1,scale:null,scalingInterpolation:!1,gravity:void 0,stopOnAudioError:!0,pauseOnBlur:!0,resumeOnFocus:!0,stopOnBlur:!1,preRender:!1,checkVersion:function(a,b){b=b||me.version;for(var c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0,g=0;e>g&&!(f=+c[g]-+d[g]);g++);return f?f:c.length-d.length}};var f=!1,g=!1,h=!1,i=[];a.onReady=function(b){return c(),h?b.call(a,[]):i.push(function(){return b.call(a,[])}),this},a.onReady(function(){d()});var j=!1,k=/var xyz/.test(function(){})?/\bparent\b/:/[\D|\d]*/,l=function(a){if(null==a||"object"!=typeof a)return a;var b;if(a instanceof Array){b=[],Object.setPrototypeOf(b,Object.getPrototypeOf(a));for(var c=0,d=a.length;d>c;c++)b[c]=l(a[c]);return b}if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;b={},Object.setPrototypeOf(b,Object.getPrototypeOf(a));for(var e in a)a.hasOwnProperty(e)&&(b[e]=l(a[e]));return b};if(Object.extend=function(a){function b(a,b){return function(){var c=this.parent;this.parent=d[a];var e=b.apply(this,arguments);return this.parent=c,e}}function c(){if(!j){for(var a in this)"object"==typeof this[a]&&(this[a]=l(this[a]));this.init&&this.init.apply(this,arguments)}return this}var d=this.prototype;j=!0;var e=new this;j=!1;for(var f in a)e[f]="function"==typeof a[f]&&"function"==typeof d[f]&&k.test(a[f])?b(f,a[f]):a[f];return c.prototype=e,c.constructor=c,c.extend=Object.extend,c},"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),!Function.prototype.bind){var m=function(){};Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=b.apply(this,c.concat(Array.prototype.slice.call(arguments)));return Object(e)===e?e:this}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return b.prototype&&(m.prototype=b.prototype,d.prototype=new m,m.prototype=null),d}}window.throttle||(window.throttle=function(a,b,c){var d,e=Date.now();return"boolean"!=typeof b&&(b=!1),function(){var f=Date.now(),g=f-e,h=arguments;return a>g?void(b===!1&&(clearTimeout(d),d=setTimeout(function(){return e=f,c.apply(null,h)},g))):(e=f,c.apply(null,h))}}),"undefined"==typeof Date.now&&(Date.now=function(){return(new Date).getTime()}),"undefined"==typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}}),Function.prototype.defer=function(){var a=this,b=Array.prototype.slice.call(arguments);return window.setTimeout(function(){return a.apply(a,b)},.01)},Object.defineProperty||(Object.defineProperty=function(a,b,c){if(!a.__defineGetter__)throw"melonJS: Object.defineProperty not supported";c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)}),Object.getPrototypeOf=Object.getPrototypeOf||function(a){return a.__proto__},Object.setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),String.prototype.isNumeric=function(){return null!==this&&!isNaN(this)&&""!==this.trim()},String.prototype.isBoolean=function(){return null!==this&&("true"===this.trim()||"false"===this.trim())},String.prototype.contains=function(a){return this.indexOf(a)>-1},String.prototype.toHex=function(){for(var a="",b=0;b<this.length;)a+=this.charCodeAt(b++).toString(16);return a},Number.prototype.clamp=function(a,b){return a>this?a:this>b?b:+this},Number.prototype.random=function(a,b){return~~(Math.random()*(b-a+1))+a},Number.prototype.round=function(){var a=arguments.length<2?this:arguments[0],b=Math.pow(10,arguments[1]||arguments[0]||0);return Math.round(a*b)/b},Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+"0123456789ABCDEF".charAt(this%16)},Number.prototype.sign=function(){return 0>this?-1:this>0?1:0},Number.prototype.degToRad=function(a){return(a||this)/180*Math.PI},Number.prototype.radToDeg=function(a){return(a||this)*(180/Math.PI)},Array.prototype.remove=function(a){var b=Array.prototype.indexOf.call(this,a);return-1!==b&&Array.prototype.splice.call(this,b,1),this},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d--;c++)a.call(b||this,this[c],c,this)}),Object.defineProperty(me,"initialized",{get:function(){return f}}),me.game=function(){var a={},b=null,c=!1,d=null,e=!0;return a.viewport=null,a.collisionMap=null,a.currentLevel=null,a.world=null,a.mergeGroup=!0,a.sortOn="z",a.renderer=null,a.NO_OBJECT=0,a.ENEMY_OBJECT=1,a.COLLECTABLE_OBJECT=2,a.ACTION_OBJECT=3,a.onLevelLoaded=null,a.init=function(d,f){c||(d=d||me.video.getWidth(),f=f||me.video.getHeight(),a.viewport=new me.Viewport(0,0,d,f),a.world=new me.ObjectContainer(0,0,d,f),a.world.name="rootContainer",b=me.video.getSystemContext(),me.event.publish(me.event.GAME_INIT),e=!0,c=!0)},a.reset=function(){a.removeAll(),a.viewport&&a.viewport.reset(),b.setTransform(1,0,0,1,0,0),a.currentLevel={pos:{x:0,y:0}}},a.loadTMXLevel=function(c){a.world.autoSort=!1,a.currentLevel=c,a.collisionMap=a.currentLevel.getLayerByName("collision"),a.collisionMap&&a.collisionMap.isCollisionMap||console.error("WARNING : no collision map detected");for(var d=a.currentLevel.getLayers(),e=d.length;e--;)d[e].visible&&a.add(d[e]);a.viewport.setBounds(Math.max(a.currentLevel.width,a.viewport.width),Math.max(a.currentLevel.height,a.viewport.height));for(var f=a.world,g=a.currentLevel.getObjectGroups(),h=0;h<g.length;h++){var i=g[h];a.mergeGroup===!1&&(f=new me.ObjectContainer,f.name=i.name,f.visible=i.visible,f.z=i.z,f.setOpacity(i.opacity),f.autoSort=!1);for(var j=0;j<i.objects.length;j++){var k=i.objects[j],l=me.entityPool.newInstanceOf(k.name,k.x,k.y,k);l&&(l.z=i.z,a.mergeGroup===!0&&l.isRenderable===!0&&(l.setOpacity(l.getOpacity()*i.opacity),null!==l.renderable&&l.renderable.setOpacity(l.renderable.getOpacity()*i.opacity)),f.addChild(l))}a.mergeGroup===!1&&(a.world.addChild(f),f.autoSort=!0)}a.world.sort(!0),a.world.autoSort=!0,a.currentLevel.pos.x!==a.currentLevel.pos.y&&b.translate(a.currentLevel.pos.x,a.currentLevel.pos.y),a.onLevelLoaded&&a.onLevelLoaded.call(a.onLevelLoaded,c.name),me.event.publish(me.event.LEVEL_LOADED,[c.name])},a.add=function(b,c){"undefined"!=typeof c&&(b.z=c),a.world.addChild(b)},a.getEntityByName=function(b){return a.world.getEntityByProp("name",b)},a.getEntityByGUID=function(b){var c=a.world.getEntityByProp("GUID",b);return c.length>0?c[0]:null},a.getEntityByProp=function(b,c){return a.world.getEntityByProp(b,c)},a.getEntityContainer=function(a){return a.ancestor},a.remove=function(a,b){a.ancestor&&(b===!0?a.ancestor.removeChild(a):(a.visible=a.inViewport=!1,d=function(a){"undefined"!=typeof a.ancestor&&a.ancestor.removeChild(a),d=null}.defer(a)))},a.removeAll=function(){d&&(clearTimeout(d),d=null),a.world.destroy()},a.sort=function(){a.world.sort()},a.collide=function(b,c){return a.world.collide(b,c)},a.collideType=function(b,c,d){return a.world.collideType(b,c,d)},a.repaint=function(){e=!0},a.update=function(){return e=a.world.update()||e,e=a.viewport.update(e)||e},a.draw=function(){e&&(a.viewport.screenX=a.viewport.pos.x+~~a.viewport.offset.x,a.viewport.screenY=a.viewport.pos.y+~~a.viewport.offset.y,b.save(),b.translate(-a.viewport.screenX,-a.viewport.screenY),a.viewport.screenX-=a.currentLevel.pos.x,a.viewport.screenY-=a.currentLevel.pos.y,a.world.draw(b,a.viewport),b.restore(),a.viewport.draw(b)),e=!1},a}()}(window),function(a){me.device=function(){function b(a){a.reading?(d.accelerationX=a.reading.accelerationX,d.accelerationY=a.reading.accelerationY,d.accelerationZ=a.reading.accelerationZ):(d.accelerationX=a.accelerationIncludingGravity.x,d.accelerationY=a.accelerationIncludingGravity.y,d.accelerationZ=a.accelerationIncludingGravity.z)}function c(a){d.gamma=a.gamma,d.beta=a.beta,d.alpha=a.alpha}var d={},e=!1,f=!1,g=null;return d._check=function(){me.audio.detectCapabilities(),me.device.pointerEnabled=navigator.pointerEnabled||navigator.msPointerEnabled,navigator.maxTouchPoints=navigator.maxTouchPoints||navigator.msMaxTouchPoints||0,a.gesture=a.gesture||a.MSGesture,me.device.touch="createTouch"in document||"ontouchstart"in a||navigator.isCocoonJS||navigator.maxTouchPoints>0,me.device.isMobile=me.device.ua.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone|Mobi/i)||!1,me.device.hasAccelerometer="undefined"!=typeof a.DeviceMotionEvent||"undefined"!=typeof a.Windows&&"function"==typeof Windows.Devices.Sensors.Accelerometer,a.DeviceOrientationEvent&&(me.device.hasDeviceOrientation=!0);try{d.localStorage=!!a.localStorage}catch(b){d.localStorage=!1}},d.ua=navigator.userAgent,d.sound=!1,d.localStorage=!1,d.hasAccelerometer=!1,d.hasDeviceOrientation=!1,d.nativeBase64="function"==typeof a.atob,d.touch=!1,d.isMobile=!1,d.orientation=0,d.accelerationX=0,d.accelerationY=0,d.accelerationZ=0,d.gamma=0,d.beta=0,d.alpha=0,d.getPixelRatio=function(){if(null===g){var b=me.video.getScreenContext(),c=a.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;g=c/d}return g},d.getStorage=function(a){switch(a=a||"local"){case"local":return me.save}throw"melonJS : storage type "+a+" not supported"},d.watchAccelerometer=function(){if(me.device.hasAccelerometer){if(!e){if("undefined"==typeof Windows)a.addEventListener("devicemotion",b,!1);else{var c=Windows.Devices.Sensors.Accelerometer.getDefault();if(c){var d=c.minimumReportInterval,f=d>=16?d:25;c.reportInterval=f,c.addEventListener("readingchanged",b,!1)}}e=!0}return!0}return!1},d.unwatchAccelerometer=function(){if(e){if("undefined"==typeof Windows)a.removeEventListener("devicemotion",b,!1);else{var c=Windows.Device.Sensors.Accelerometer.getDefault();c.removeEventListener("readingchanged",b,!1)}e=!1}},d.watchDeviceOrientation=function(){return me.device.hasDeviceOrientation&&!f&&(a.addEventListener("deviceorientation",c,!1),f=!0),!1},d.unwatchDeviceOrientation=function(){f&&(a.removeEventListener("deviceorientation",c,!1),f=!1)},d}()}(window),function(){me.timer=function(){var a={},b=0,c=0,d=0,e=0,f=0,g=Math.ceil(1e3/me.sys.fps),h=1e3/me.sys.fps*1.25;return a.tick=1,a.fps=0,a.init=function(){a.reset()},a.reset=function(){e=d=Date.now(),c=0,b=0},a.getTime=function(){return e},a.countFPS=function(){b++,c+=f,b%10===0&&(this.fps=(~~(1e3*b/c)).clamp(0,me.sys.fps),c=0,b=0)},a.update=function(){d=e,e=Date.now(),f=e-d,a.tick=f>h&&me.sys.interpolation?f/g:1},a}()}(window),function(){me.Vector2d=Object.extend({x:0,y:0,init:function(a,b){this.x=a||0,this.y=b||0},set:function(a,b){return this.x=a,this.y=b,this},setZero:function(){return this.set(0,0)},setV:function(a){return this.x=a.x,this.y=a.y,this},add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},scale:function(a){return this.x*=a.x,this.y*=a.y,this},div:function(a){return this.x/=a,this.y/=a,this},abs:function(){return this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this},clamp:function(a,b){return new me.Vector2d(this.x.clamp(a,b),this.y.clamp(a,b))},clampSelf:function(a,b){return this.x=this.x.clamp(a,b),this.y=this.y.clamp(a,b),this},minV:function(a){return this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y,this},maxV:function(a){return this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y,this},floor:function(){return new me.Vector2d(~~this.x,~~this.y)},floorSelf:function(){return this.x=~~this.x,this.y=~~this.y,this},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){return this.x=-this.x,this.y=-this.y,this},copy:function(a){return this.x=a.x,this.y=a.y,this},equals:function(a){return this.x===a.x&&this.y===a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.length();if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},dotProduct:function(a){return this.x*a.x+this.y*a.y},distance:function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},angle:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},clone:function(){return new me.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+",y:"+this.y}})}(window),function(){me.Rect=Object.extend({pos:null,colPos:null,width:0,height:0,hWidth:0,hHeight:0,shapeType:"Rectangle",offset:null,init:function(a,b,c){null===this.pos&&(this.pos=new me.Vector2d),this.pos.setV(a),null===this.offset&&(this.offset=new me.Vector2d),this.offset.set(0,0),null===this.colPos&&(this.colPos=new me.Vector2d),this.colPos.setV(0,0),this.width=b,this.height=c,this.hWidth=~~(b/2),this.hHeight=~~(c/2),Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:!0}),Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})},set:function(a,b,c){this.pos.setV(a),this.width=b,this.height=c,this.hWidth=~~(b/2),this.hHeight=~~(c/2),this.offset.set(0,0)},getBounds:function(){return this.clone()},clone:function(){return new me.Rect(this.pos.clone(),this.width,this.height)},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this},translateV:function(a){return this.pos.add(a),this},union:function(a){var b=Math.min(this.pos.x,a.pos.x),c=Math.min(this.pos.y,a.pos.y);return this.width=Math.ceil(Math.max(this.pos.x+this.width,a.pos.x+a.width)-b),this.height=Math.ceil(Math.max(this.pos.y+this.height,a.pos.y+a.height)-c),this.hWidth=~~(this.width/2),this.hHeight=~~(this.height/2),this.pos.x=~~b,this.pos.y=~~c,this},adjustSize:function(a,b,c,d){-1!==a&&(this.colPos.x=a,this.width=b,this.hWidth=~~(this.width/2),this.left!==this.pos.x+this.colPos.x&&Object.defineProperty(this,"left",{get:function(){return this.pos.x+this.colPos.x},configurable:!0}),this.right!==this.pos.x+this.colPos.x+this.width&&Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:!0})),-1!==c&&(this.colPos.y=c,this.height=d,this.hHeight=~~(this.height/2),this.top!==this.pos.y+this.colPos.y&&Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:!0}),this.bottom!==this.pos.y+this.colPos.y+this.height&&Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:!0}))},flipX:function(a){this.colPos.x=a-this.width-this.colPos.x,this.hWidth=~~(this.width/2)},flipY:function(a){this.colPos.y=a-this.height-this.colPos.y,this.hHeight=~~(this.height/2)},equals:function(a){return this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},within:function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPointV:function(a){return this.containsPoint(a.x,a.y)},containsPoint:function(a,b){return a>=this.left&&a<=this.right&&b>=this.top&&b<=this.bottom},collideWithRectangle:function(a){var b=new me.Vector2d(0,0);if(this.overlaps(a)){var c=this.left+this.hWidth-a.left-a.hWidth,d=this.top+this.hHeight-a.top-a.hHeight;b.x=a.hWidth+this.hWidth-(0>c?-c:c),b.y=a.hHeight+this.hHeight-(0>d?-d:d),b.x<b.y?(b.y=0,b.x=0>c?-b.x:b.x):(b.x=0,b.y=0>d?-b.y:b.y)}return b},draw:function(a,b){a.strokeStyle=b||"red",a.strokeRect(this.left,this.top,this.width,this.height)}}),me.Ellipse=Object.extend({pos:null,radius:null,shapeType:"Ellipse",init:function(a,b,c){null===this.pos&&(this.pos=new me.Vector2d),null===this.radius&&(this.radius=new me.Vector2d),this.set(a,b,c)},set:function(a,b,c){this.radius.set(b/2,c/2),this.pos.setV(a).add(this.radius),this.offset=new me.Vector2d},getBounds:function(){return new me.Rect(this.pos.clone().sub(this.radius),2*this.radius.x,2*this.radius.y)},clone:function(){return new me.Ellipse(this.pos.clone(),2*this.radius.x,2*this.radius.y)},draw:function(a,b){a.save(),a.beginPath(),a.translate(this.pos.x-this.radius.x,this.pos.y-this.radius.y),a.scale(this.radius.x,this.radius.y),a.arc(1,1,1,0,2*Math.PI,!1),a.restore(),a.strokeStyle=b||"red",a.stroke()}}),me.PolyShape=Object.extend({offset:null,pos:null,points:null,closed:null,shapeType:"PolyShape",init:function(a,b,c){null===this.pos&&(this.pos=new me.Vector2d),null===this.offset&&(this.offset=new me.Vector2d),this.set(a,b,c)},set:function(a,b,c){this.pos.setV(a),this.points=b,this.closed=c===!0,this.offset.set(0,0),this.getBounds()},getBounds:function(){var a=this.offset,b=0,c=0;return this.points.forEach(function(d){a.x=Math.min(a.x,d.x),a.y=Math.min(a.y,d.y),b=Math.max(b,d.x),c=Math.max(c,d.y)}),new me.Rect(a,b-a.x,c-a.y)},clone:function(){return new me.PolyShape(this.pos.clone(),this.points,this.closed)},draw:function(a,b){a.save(),a.translate(-this.offset.x,-this.offset.y),a.strokeStyle=b||"red",a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y),this.points.forEach(function(b){a.lineTo(b.x,b.y),a.moveTo(b.x,b.y)}),this.closed===!0&&a.lineTo(this.points[0].x,this.points[0].y),a.stroke(),a.restore()}})}(window),function(){me.debug={renderCollisionMap:!1}}(window),function(){me.Renderable=me.Rect.extend({isRenderable:!0,GUID:void 0,visible:!0,inViewport:!1,alwaysUpdate:!1,updateWhenPaused:!1,isPersistent:!1,floating:!1,z:0,anchorPoint:null,alpha:1,init:function(a,b,c){this.parent(a,b,c),null===this.anchorPoint&&(this.anchorPoint=new me.Vector2d),this.anchorPoint.set(.5,.5),this.setOpacity(1)},getOpacity:function(){return this.alpha},setOpacity:function(a){"number"==typeof a&&(this.alpha=a.clamp(0,1))},update:function(){return!1},draw:function(a,b){this.parent(a,b)}})}(window),function(){me.SpriteObject=me.Renderable.extend({scale:null,scaleFlag:!1,lastflipX:!1,lastflipY:!1,z:0,offset:null,angle:0,_sourceAngle:0,image:null,flickering:!1,flickerTimer:-1,flickercb:null,flickerState:!1,init:function(a,b,c,d,e){this.isSprite=!0,this.parent(new me.Vector2d(a,b),d||c.width,e||c.height),this.image=c,this.scale=new me.Vector2d(1,1),this.lastflipX=this.lastflipY=!1,this.scaleFlag=!1,this.offset=new me.Vector2d(0,0),this.visible=!0,this.isPersistent=!1,this.flickering=!1},setTransparency:function(a){a="#"===a.charAt(0)?a.substring(1,7):a,this.image=me.video.applyRGBFilter(this.image,"transparent",a.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(a,b){this.flickerTimer=a,this.flickerTimer<0?(this.flickering=!1,this.flickercb=null):this.flickering||(this.flickercb=b,this.flickering=!0)},flipX:function(a){a!==this.lastflipX&&(this.lastflipX=a,this.scale.x=-this.scale.x,this.scaleFlag=1!==this.scale.x||1!==this.scale.y)},flipY:function(a){a!==this.lastflipY&&(this.lastflipY=a,this.scale.y=-this.scale.y,this.scaleFlag=1!==this.scale.x||1!==this.scale.y)},resize:function(a){a>0&&(this.scale.x=this.scale.x<0?-a:a,this.scale.y=this.scale.y<0?-a:a,this.scaleFlag=1!==this.scale.x||1!==this.scale.y)},update:function(){return this.flickering?(this.flickerTimer-=me.timer.tick,this.flickerTimer<0&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(a){if(!this.flickering||(this.flickerState=!this.flickerState,this.flickerState)){a.save(),a.globalAlpha*=this.getOpacity();var b=~~this.pos.x,c=~~this.pos.y,d=this.width,e=this.height,f=this.angle+this._sourceAngle;if(this.scaleFlag||0!==f){var g=d*this.anchorPoint.x,h=e*this.anchorPoint.y;a.translate(b+g,c+h),this.scaleFlag&&a.scale(this.scale.x,this.scale.y),0!==f&&a.rotate(f),0!==this._sourceAngle?(d=this.height,e=this.width,b=-h,c=-g):(b=-g,c=-h)}a.drawImage(this.image,this.offset.x,this.offset.y,d,e,b,c,d,e),a.restore()}},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}}),me.AnimationSheet=me.SpriteObject.extend({spacing:0,margin:0,animationpause:!1,animationspeed:100,init:function(a,b,c,d,e,f,g,h,i){this.anim={},this.resetAnim=null,this.current=null,this.animationspeed=100,this.spacing=f||0,this.margin=g||0,this.parent(a,b,c,d,e,f,g),this.textureAtlas=null,this.atlasIndices=null,this.buildLocalAtlas(h||void 0,i||void 0),this.addAnimation("default",null),this.setCurrentAnimation("default")},buildLocalAtlas:function(a,b){if(void 0!==a)this.textureAtlas=a,this.atlasIndices=b;else{this.textureAtlas=[];for(var c=new me.Vector2d(~~((this.image.width-this.margin)/(this.width+this.spacing)),~~((this.image.height-this.margin)/(this.height+this.spacing))),d=0,e=c.x*c.y;e>d;d++)this.textureAtlas[d]={name:""+d,offset:new me.Vector2d(this.margin+(this.spacing+this.width)*(d%c.x),this.margin+(this.spacing+this.height)*~~(d/c.x)),width:this.width,height:this.height,hWidth:this.width/2,hHeight:this.height/2,angle:0}}},addAnimation:function(a,b,c){if(this.anim[a]={name:a,frame:[],idx:0,length:0,animationspeed:c||this.animationspeed,nextFrame:0},null==b){b=[];var d=0;this.textureAtlas.forEach(function(){b[d]=d++})}for(var e=0,f=b.length;f>e;e++)if("number"==typeof b[e])this.anim[a].frame[e]=this.textureAtlas[b[e]];else{if(null===this.atlasIndices)throw"melonjs: string parameters for addAnimation are only allowed for TextureAtlas ";this.anim[a].frame[e]=this.textureAtlas[this.atlasIndices[b[e]]]}this.anim[a].length=this.anim[a].frame.length},setCurrentAnimation:function(a,b){if(!this.anim[a])throw"melonJS: animation id '"+a+"' not defined";this.current=this.anim[a],this.resetAnim=b||null,this.setAnimationFrame(this.current.idx),this.current.nextFrame=me.timer.getTime()+this.current.animationspeed},isCurrentAnimation:function(a){return this.current.name===a},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length;var b=this.current.frame[this.current.idx];this.offset=b.offset,this.width=b.width,this.height=b.height,this.hWidth=b.hWidth,this.hHeight=b.hHeight,this._sourceAngle=b.angle},getCurrentAnimationFrame:function(){return this.current.idx},update:function(){if(!this.animationpause&&me.timer.getTime()>=this.current.nextFrame){if(this.setAnimationFrame(++this.current.idx),0===this.current.idx&&this.resetAnim)if("string"==typeof this.resetAnim)this.setCurrentAnimation(this.resetAnim);else if("function"==typeof this.resetAnim&&this.resetAnim()===!1)return this.current.idx=this.current.length-1,this.setAnimationFrame(this.current.idx),this.parent(),!1;return this.current.nextFrame=me.timer.getTime()+this.current.animationspeed,this.parent()||!0}return this.parent()}})}(window),function(){var a=-(Math.PI/2);me.TextureAtlas=Object.extend({format:null,texture:null,atlas:null,init:function(a,b){if(a&&a.meta){if(a.meta.app.contains("texturepacker"))if(this.format="texturepacker",void 0===b){var c=me.utils.getBasename(a.meta.image);if(this.texture=me.loader.getImage(c),null===this.texture)throw"melonjs: Atlas texture '"+c+"' not found"}else this.texture=b;if(a.meta.app.contains("ShoeBox")){if(!a.meta.exporter||!a.meta.exporter.contains("melonJS"))throw"melonjs: ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx";this.format="ShoeBox",this.texture=b}this.atlas=this.initFromTexturePacker(a)}if(null===this.atlas)throw"melonjs: texture atlas format not supported"},initFromTexturePacker:function(a){var b={};return a.frames.forEach(function(a){a.hasOwnProperty("filename")&&(b[a.filename]={frame:new me.Rect(new me.Vector2d(a.frame.x,a.frame.y),a.frame.w,a.frame.h),source:new me.Rect(new me.Vector2d(a.spriteSourceSize.x,a.spriteSourceSize.y),a.spriteSourceSize.w,a.spriteSourceSize.h),rotated:a.rotated===!0,trimmed:a.trimmed===!0})}),b},getTexture:function(){return this.texture},getRegion:function(b){var c=this.atlas[b];return c?{name:b,pos:c.source.pos.clone(),offset:c.frame.pos.clone(),width:c.frame.width,height:c.frame.height,hWidth:c.frame.width/2,hHeight:c.frame.height/2,angle:c.rotated===!0?a:0}:null},createSpriteFromName:function(a){var b=this.getRegion(a);if(b){var c=new me.SpriteObject(0,0,this.getTexture(),b.width,b.height);return c.offset.setV(b.offset),c._sourceAngle=b.angle,c}throw"melonjs: TextureAtlas - region for "+a+" not found"},createAnimationFromName:function(a){for(var b=[],c={},d=0;d<a.length;++d)if(b[d]=this.getRegion(a[d]),c[a[d]]=d,null==b[d])throw"melonjs: TextureAtlas - region for "+a[d]+" not found";return new me.AnimationSheet(0,0,this.texture,0,0,0,0,b,c)}})}(window),function(){var a=Math.min,b=Math.max;me.Viewport=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,shaking:!1,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,screenX:0,screenY:0,init:function(a,b,c,d,e,f){this.parent(new me.Vector2d(a,b),c-a,d-b),this.limits=new me.Vector2d(e||this.width,f||this.height),this.offset=new me.Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null,start:0},this._fadeOut={color:0,alpha:0,duration:0,tween:null},this._fadeIn={color:0,alpha:1,duration:0,tween:null},this.setDeadzone(this.width/6,this.height/6)},_followH:function(c){var d=this.pos.x;return c.x-this.pos.x>this._deadwidth?this.pos.x=~~a(c.x-this._deadwidth,this._limitwidth):c.x-this.pos.x<this.deadzone.x&&(this.pos.x=~~b(c.x-this.deadzone.x,0)),d!==this.pos.x},_followV:function(c){var d=this.pos.y;return c.y-this.pos.y>this._deadheight?this.pos.y=~~a(c.y-this._deadheight,this._limitheight):c.y-this.pos.y<this.deadzone.y&&(this.pos.y=~~b(c.y-this.deadzone.y,0)),d!==this.pos.y},reset:function(a,b){this.pos.x=a||0,this.pos.y=b||0,this.target=null,this.follow_axis=null},setDeadzone:function(a,b){this.deadzone=new me.Vector2d(~~((this.width-a)/2),~~((this.height-b)/2-.25*b)),this._deadwidth=this.width-this.deadzone.x,this._deadheight=this.height-this.deadzone.y,this.update(!0)},setBounds:function(a,b){this.limits.set(a,b),this._limitwidth=this.limits.x-this.width,this._limitheight=this.limits.y-this.height},follow:function(a,b){if(a instanceof me.ObjectEntity)this.target=a.pos;else{if(!(a instanceof me.Vector2d))throw"melonJS: invalid target for viewport.follow";this.target=a}this.follow_axis="undefined"==typeof b?this.AXIS.BOTH:b,this.update(!0)},move:function(a,b){var c=~~(this.pos.x+a),d=~~(this.pos.y+b);this.pos.x=c.clamp(0,this._limitwidth),this.pos.y=d.clamp(0,this._limitheight),me.event.publish(me.event.VIEWPORT_ONCHANGE,[this.pos])},update:function(a){var b=!1;if(this.target&&a)switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:b=this._followH(this.target);break;case this.AXIS.VERTICAL:b=this._followV(this.target);break;case this.AXIS.BOTH:b=this._followH(this.target),b=this._followV(this.target)||b}if(this.shaking===!0){var c=me.timer.getTime()-this._shake.start;c>=this._shake.duration?(this.shaking=!1,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):((this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),b=!0}return b===!0&&me.event.publish(me.event.VIEWPORT_ONCHANGE,[this.pos]),(null!=this._fadeIn.tween||null!=this._fadeOut.tween)&&(b=!0),b},shake:function(a,b,c,d){this.shaking||(this.shaking=!0,this._shake={intensity:a,duration:b,axis:c||this.AXIS.BOTH,onComplete:d||null,start:me.timer.getTime()})},fadeOut:function(a,b,c){this._fadeOut.color=a,this._fadeOut.duration=b||1e3,this._fadeOut.alpha=1,this._fadeOut.tween=me.entityPool.newInstanceOf("me.Tween",this._fadeOut).to({alpha:0},this._fadeOut.duration).onComplete(c||null),this._fadeOut.tween.start()},fadeIn:function(a,b,c){this._fadeIn.color=a,this._fadeIn.duration=b||1e3,this._fadeIn.alpha=0,this._fadeIn.tween=me.entityPool.newInstanceOf("me.Tween",this._fadeIn).to({alpha:1},this._fadeIn.duration).onComplete(c||null),this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(a){this.pos.x=a.x-.5*this.width,this.pos.y=a.y-.5*this.height},isVisible:function(a){return a.overlaps(this)},localToWorld:function(a,b){return new me.Vector2d(a,b).add(this.pos).sub(me.game.currentLevel.pos)},worldToLocal:function(a,b){return new me.Vector2d(a,b).sub(this.pos).add(me.game.currentLevel.pos)},draw:function(a){this._fadeIn.tween&&(a.globalAlpha=this._fadeIn.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeIn.color)),a.globalAlpha=1,1===this._fadeIn.alpha&&(this._fadeIn.tween=null)),this._fadeOut.tween&&(a.globalAlpha=this._fadeOut.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeOut.color)),a.globalAlpha=1,0===this._fadeOut.alpha&&(this._fadeOut.tween=null)),me.video.blitSurface()}})}(window),function(){me.GUI_Object=me.SpriteObject.extend({isClickable:!0,updated:!1,init:function(a,b,c){this.parent(a,b,"string"==typeof c.image?me.loader.getImage(c.image):c.image,c.spritewidth,c.spriteheight),this.floating=!0,me.input.registerPointerEvent("mousedown",this,this.clicked.bind(this))},update:function(){return this.updated?(this.updated=!1,!0):!1},clicked:function(a){return this.isClickable?(this.updated=!0,this.onClick(a)):void 0},onClick:function(){return!1},onDestroyEvent:function(){me.input.releasePointerEvent("mousedown",this)}})}(window),function(){var a=new me.Rect(new me.Vector2d,0,0),b=0;me.ObjectContainer=me.Renderable.extend({sortOn:"z",autoSort:!0,pendingSort:null,children:null,collidable:!0,init:function(a,b,c,d){this.parent(new me.Vector2d(a||0,b||0),c||1/0,d||1/0),this.children=[],this.sortOn=me.game.sortOn,this.autoSort=!0},addChild:function(a){"undefined"!=typeof a.ancestor?a.ancestor.removeChild(a):a.isRenderable&&(a.GUID=me.utils.createGUID()),"undefined"==typeof a.z&&(a.z=1/0),a.ancestor=this,this.children.push(a),this.autoSort===!0&&this.sort()},addChildAt:function(a,b){if(!(b>=0&&b<this.children.length))throw"melonJS (me.ObjectContainer): Index ("+b+") Out Of Bounds for addChildAt()";"undefined"!=typeof a.ancestor?a.ancestor.removeChild(a):a.isRenderable&&(a.GUID=me.utils.createGUID()),a.ancestor=this,this.children.splice(b,0,a)},swapChildren:function(a,b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(-1===c||-1===d)throw"melonJS (me.ObjectContainer): "+a+" Both the supplied entities must be a child of the caller "+this;var e=a.z;a.z=b.z,b.z=e,this.children[c]=b,this.children[d]=a},getChildAt:function(a){if(a>=0&&a<this.children.length)return this.children[a];throw"melonJS (me.ObjectContainer): Index ("+a+") Out Of Bounds for getChildAt()"},getChildIndex:function(a){return this.children.indexOf(a)},hasChild:function(a){return this===a.ancestor
},getEntityByProp:function(a,b){function c(a,c){"string"==typeof a[c]?a[c].match(f)&&e.push(a):a[c]===b&&e.push(a)}for(var d,e=[],f=new RegExp(b,"i"),g=this.children.length;g--,d=this.children[g];)d instanceof me.ObjectContainer?(c(d,a),e=e.concat(d.getEntityByProp(a,b))):d.isEntity&&c(d,a);return e},removeChild:function(a,b){if(!this.hasChild(a))throw"melonJS (me.ObjectContainer): "+a+" The supplied entity must be a child of the caller "+this;a.ancestor=void 0,b||("function"==typeof a.destroy&&a.destroy(),me.entityPool.freeInstance(a)),this.children.splice(this.getChildIndex(a),1)},setChildsProperty:function(a,b,c){for(var d,e=this.children.length;e--,d=this.children[e];)c===!0&&d instanceof me.ObjectContainer&&d.setChildsProperty(a,b,c),d[a]=b},moveUp:function(a){var b=this.getChildIndex(a);b-1>=0&&this.swapChildren(a,this.getChildAt(b-1))},moveDown:function(a){var b=this.getChildIndex(a);b+1<this.children.length&&this.swapChildren(a,this.getChildAt(b+1))},moveToTop:function(a){var b=this.getChildIndex(a);b>0&&(this.splice(0,0,this.splice(b,1)[0]),a.z=this.children[1].z+1)},moveToBottom:function(a){var b=this.getChildIndex(a);b<this.children.length-1&&(this.splice(this.children.length-1,0,this.splice(b,1)[0]),a.z=this.children[this.children.length-2].z-1)},collide:function(a,b){return this.collideType(a,null,b)},collideType:function(a,b,c){var d,e;c=c===!0?!0:!1,c===!0&&(e=[]);for(var f,g=this.children.length;g--,f=this.children[g];)if((f.inViewport||f.alwaysUpdate)&&f.collidable)if(f instanceof me.ObjectContainer){if(d=f.collideType(a,b,c),c)e.concat(d);else if(d)return d}else if(f!==a&&(!b||f.type===b)&&(d=f.collisionBox["collideWith"+a.shapeType].call(f.collisionBox,a.collisionBox),0!==d.x||0!==d.y)){if(f.onCollision.call(f,d,a),d.type=f.type,d.obj=f,!c)return d;e.push(d)}return c?e:null},sort:function(a){if(null===this.pendingSort){if(a===!0)for(var b,c=this.children.length;c--,b=this.children[c];)b instanceof me.ObjectContainer&&b.sort(a);this.pendingSort=function(a){a.children.sort(a["_sort"+a.sortOn.toUpperCase()]),a.pendingSort=null,me.game.repaint()}.defer(this)}},_sortZ:function(a,b){return b.z-a.z},_sortX:function(a,b){var c=b.z-a.z;return c?c:(b.pos&&b.pos.x)-(a.pos&&a.pos.x)||0},_sortY:function(a,b){var c=b.z-a.z;return c?c:(b.pos&&b.pos.y)-(a.pos&&a.pos.y)||0},destroy:function(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var a,b=this.children.length;b--,a=this.children[b];)a.isPersistent||this.removeChild(a)},update:function(){for(var c,d,e,f,g=!1,h=!1,i=me.state.isPaused(),j=me.game.viewport,k=this.children.length;k--,f=this.children[k];)(!i||f.updateWhenPaused)&&(f.isRenderable?(h=b>0||f.floating,h&&b++,c=f.visible&&!h,c&&(d=f.pos.x,e=f.pos.y,a.translateV(f.pos),a.set(a.pos,f.width,f.height)),f.inViewport=f.visible&&(h||j.isVisible(a)),g|=(f.inViewport||f.alwaysUpdate)&&f.update(),c&&a.translate(-d,-e),b>0&&b--):g|=f.update());return g},draw:function(a,b){var c=me.game.viewport,d=!1;this.drawCount=0,a.save(),a.globalAlpha*=this.getOpacity(),a.translate(this.pos.x,this.pos.y);for(var e,f=this.children.length;f--,e=this.children[f];)d=e.floating,e.isRenderable&&(e.inViewport||d&&e.visible)&&(d===!0&&(a.save(),a.translate(c.screenX-this.pos.x,c.screenY-this.pos.y)),e.draw(a,b),d===!0&&a.restore(),this.drawCount++);a.restore()}})}(window),function(){me.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:0,collidable:!0},me.entityPool=function(){var a={},b={};return a.init=function(){a.add("me.ObjectEntity",me.ObjectEntity),a.add("me.CollectableEntity",me.CollectableEntity),a.add("me.LevelEntity",me.LevelEntity),a.add("me.Tween",me.Tween,!0)},a.add=function(a,c,d){return d?void(b[a.toLowerCase()]={"class":c,pool:[],active:[]}):void(b[a.toLowerCase()]={"class":c,pool:void 0})},a.newInstanceOf=function(a){var c="string"==typeof a?a.toLowerCase():void 0,d=Array.prototype.slice.call(arguments);if(c&&b[c]){var e;if(!b[c].pool)return e=b[c]["class"],d[0]=e,new(e.bind.apply(e,d));var f,g=b[c];return e=g["class"],g.pool.length>0?(f=g.pool.pop(),"function"==typeof f.init&&f.init.apply(f,d.slice(1)),"function"==typeof f.onResetEvent&&f.onResetEvent.apply(f,d.slice(1))):(d[0]=e,f=new(e.bind.apply(e,d)),f.className=c),g.active.push(f),f}var h=arguments[3];return h&&h.gid&&h.image?new me.SpriteObject(h.x,h.y,h.image):(c&&console.error("Cannot instantiate entity of type '"+a+"': Class not found!"),null)},a.purge=function(){for(var a in b)b[a].pool=[]},a.freeInstance=function(a){var c=a.className;if(c&&b[c]){for(var d=!0,e=0,f=b[c].active.length;f>e;e++)if(b[c].active[e]===a){d=!1,b[c].active.splice(e,1);break}d||b[c].pool.push(a)}},a}(),me.ObjectEntity=me.Renderable.extend({type:0,collidable:!0,collisionBox:null,shapes:null,renderable:null,lastflipX:!1,lastflipY:!1,init:function(a,b,c){if(null===this.pos&&(this.pos=new me.Vector2d),this.parent(this.pos.set(a,b),~~c.spritewidth||~~c.width,~~c.spriteheight||~~c.height),c.image){var d="string"==typeof c.image?me.loader.getImage(c.image):c.image;this.renderable=new me.AnimationSheet(0,0,d,~~c.spritewidth,~~c.spriteheight,~~c.spacing,~~c.margin),c.transparent_color&&this.renderable.setTransparency(c.transparent_color)}this.name=c.name?c.name.toLowerCase():"",void 0===this.vel&&(this.vel=new me.Vector2d),this.vel.set(0,0),void 0===this.accel&&(this.accel=new me.Vector2d),this.accel.set(0,0),void 0===this.friction&&(this.friction=new me.Vector2d),this.friction.set(0,0),void 0===this.maxVel&&(this.maxVel=new me.Vector2d),this.maxVel.set(1e3,1e3),this.gravity=void 0!==me.sys.gravity?me.sys.gravity:.98,this.isEntity=!0,this.alive=!0,this.visible=!0,this.floating=!1,this.isPersistent=!1,this.falling=!1,this.jumping=!0,this.slopeY=0,this.onslope=!1,this.onladder=!1,this.disableTopLadderCollision=!1,this.collidable="undefined"!=typeof c.collidable?c.collidable:!0,this.type=c.type||0,this.lastflipX=this.lastflipY=!1,this.collisionMap=me.game.collisionMap,this.canBreakTile=!1,this.onTileBreak=null,c.isEllipse===!0?this.addShape(new me.Ellipse(new me.Vector2d(0,0),this.width,this.height)):c.isPolygon===!0||c.isPolyline===!0?(this.addShape(new me.PolyShape(new me.Vector2d(0,0),c.points,c.isPolygon)),this.width=this.collisionBox.width,this.height=this.collisionBox.height):this.addShape(new me.Rect(new me.Vector2d(0,0),this.width,this.height))},updateColRect:function(a,b,c,d){this.collisionBox.adjustSize(a,b,c,d)},addShape:function(a){null===this.shapes&&(this.shapes=[]),this.shapes.push(a),1===this.shapes.length&&(this.collisionBox=this.shapes[0].getBounds(),this.collisionBox.pos=this.pos,this.pos.add(this.shapes[0].offset))},onCollision:function(){this.collidable&&this.type===me.game.COLLECTABLE_OBJECT&&me.game.remove(this)},setVelocity:function(a,b){this.accel.x=0!==a?a:this.accel.x,this.accel.y=0!==b?b:this.accel.y,this.setMaxVelocity(a,b)},setMaxVelocity:function(a,b){this.maxVel.x=a,this.maxVel.y=b},setFriction:function(a,b){this.friction.x=a||0,this.friction.y=b||0},flipX:function(a){a!==this.lastflipX&&(this.lastflipX=a,this.renderable&&this.renderable.flipX&&this.renderable.flipX(a),this.collisionBox.flipX(this.width))},flipY:function(a){a!==this.lastflipY&&(this.lastflipY=a,this.renderable&&this.renderable.flipY&&this.renderable.flipY(a),this.collisionBox.flipY(this.height))},doWalk:function(a){this.flipX(a),this.vel.x+=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(a){return this.onladder?(this.vel.y=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick,this.disableTopLadderCollision=!a,!0):!1},doJump:function(){return this.jumping||this.falling?!1:(this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0,!0)},forceJump:function(){this.jumping=this.falling=!1,this.doJump()},distanceTo:function(a){var b=this.pos.x+this.hWidth-(a.pos.x+a.hWidth),c=this.pos.y+this.hHeight-(a.pos.y+a.hHeight);return Math.sqrt(b*b+c*c)},distanceToPoint:function(a){var b=this.pos.x+this.hWidth-a.x,c=this.pos.y+this.hHeight-a.y;return Math.sqrt(b*b+c*c)},angleTo:function(a){var b=a.pos.x+a.hWidth-(this.pos.x+this.hWidth),c=a.pos.y+a.hHeight-(this.pos.y+this.hHeight);return Math.atan2(c,b)},angleToPoint:function(a){var b=a.x-(this.pos.x+this.hWidth),c=a.y-(this.pos.y+this.hHeight);return Math.atan2(c,b)},checkSlope:function(a,b){this.pos.y=a.pos.y-this.height,this.slopeY=b?a.height-(this.collisionBox.right+this.vel.x-a.pos.x):this.collisionBox.left+this.vel.x-a.pos.x,this.vel.y=0,this.pos.y+=this.slopeY.clamp(0,a.height)},computeVelocity:function(a){this.gravity&&(a.y+=this.onladder?0:this.gravity*me.timer.tick,this.falling=a.y>0,this.jumping=this.falling?!1:this.jumping),this.friction.x&&(a.x=me.utils.applyFriction(a.x,this.friction.x)),this.friction.y&&(a.y=me.utils.applyFriction(a.y,this.friction.y)),0!==a.y&&(a.y=a.y.clamp(-this.maxVel.y,this.maxVel.y)),0!==a.x&&(a.x=a.x.clamp(-this.maxVel.x,this.maxVel.x))},updateMovement:function(){this.computeVelocity(this.vel);var a;return this.collidable&&(a=this.collisionMap.checkCollision(this.collisionBox,this.vel),this.onslope=a.yprop.isSlope||a.xprop.isSlope,this.onladder=!1,a.y&&(this.onladder=a.yprop.isLadder||a.yprop.isTopLadder,a.y>0?a.yprop.isSolid||a.yprop.isPlatform&&this.collisionBox.bottom-1<=a.ytile.pos.y||a.yprop.isTopLadder&&!this.disableTopLadderCollision?(this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1):a.yprop.isSlope&&!this.jumping?(this.checkSlope(a.ytile,a.yprop.isLeftSlope),this.falling=!1):a.yprop.isBreakable&&(this.canBreakTile?(me.game.currentLevel.clearTile(a.ytile.col,a.ytile.row),this.onTileBreak&&this.onTileBreak()):(this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1)):a.y<0&&(a.yprop.isPlatform||a.yprop.isLadder||a.yprop.isTopLadder||(this.falling=!0,this.vel.y=0))),a.x&&(this.onladder=a.xprop.isLadder||a.yprop.isTopLadder,a.xprop.isSlope&&!this.jumping?(this.checkSlope(a.xtile,a.xprop.isLeftSlope),this.falling=!1):a.xprop.isPlatform||a.xprop.isLadder||a.xprop.isTopLadder||(a.xprop.isBreakable&&this.canBreakTile?(me.game.currentLevel.clearTile(a.xtile.col,a.xtile.row),this.onTileBreak&&this.onTileBreak()):this.vel.x=0))),this.pos.add(this.vel),a},collide:function(a){return me.game.collide(this,a||!1)},collideType:function(a,b){return me.game.collideType(this,a,b||!1)},update:function(){return this.renderable?this.renderable.update():!1},getBounds:function(){return this.renderable?this.renderable.getBounds().translateV(this.pos):null},draw:function(a){if(this.renderable){var b=~~(this.pos.x+this.anchorPoint.x*(this.width-this.renderable.width)),c=~~(this.pos.y+this.anchorPoint.y*(this.height-this.renderable.height));a.translate(b,c),this.renderable.draw(a),a.translate(-b,-c)}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null),this.onDestroyEvent.apply(this,arguments),this.collisionBox=null,this.shapes=[]},onDestroyEvent:function(){}}),me.CollectableEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.type=me.game.COLLECTABLE_OBJECT}}),me.LevelEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.nextlevel=c.to,this.fade=c.fade,this.duration=c.duration,this.fading=!1,this.gotolevel=c.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel),me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel,this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){this.goTo()}})}(window),function(a){me.ScreenObject=me.Renderable.extend({addAsObject:!1,visible:!1,frame:0,z:999,init:function(a,b){this.parent(new me.Vector2d(0,0),0,0),this.addAsObject=this.visible=a===!0||!1,this.isPersistent=this.visible&&b===!0||!1},reset:function(){me.game.reset(),this.frame=0,this.frameRate=Math.round(60/me.sys.fps),this.onResetEvent.apply(this,arguments),this.addAsObject&&(this.visible=!0,this.floating=!0,this.set(new me.Vector2d,me.game.viewport.width,me.game.viewport.height),me.game.add(this,this.z)),me.game.sort()},destroy:function(){this.onDestroyEvent.apply(this,arguments)},update:function(){return!1},onUpdateFrame:function(){++this.frame%this.frameRate===0&&(this.frame=0,me.timer.update(),me.game.update()),me.game.draw()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}}),function(){for(var a=0,b=["ms","moz","webkit","o"],c=window.requestAnimationFrame,d=window.cancelAnimationFrame,e=0;e<b.length&&(!c||!d);++e)c=window[b[e]+"RequestAnimationFrame"],d=window[b[e]+"CancelAnimationFrame"]||window[b[e]+"CancelRequestAnimationFrame"];c&&d||(c=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e},d=function(a){window.clearTimeout(a)}),window.requestAnimationFrame=c,window.cancelAnimationFrame=d}(),me.state=function(){function b(){-1===j&&-1!==i&&(me.timer.reset(),j=window.requestAnimationFrame(e))}function c(){k&&-1!==i&&(me.timer.reset(),k=!1)}function d(){k=!0}function e(){p(),-1!==j&&(j=window.requestAnimationFrame(e))}function f(){window.cancelAnimationFrame(j),j=-1}function g(a){f(),l[i]&&(l[i].screen.visible?me.game.remove.call(me.game,l[i].screen,!0):l[i].screen.destroy()),l[a]&&(i=a,l[i].screen.reset.apply(l[i].screen,o),p=l[i].screen.onUpdateFrame.bind(l[i].screen),b(),n&&n(),me.game.repaint())}var h={},i=-1,j=-1,k=!1,l={},m={color:"",duration:0},n=null,o=null,p=null;return h.LOADING=0,h.MENU=1,h.READY=2,h.PLAY=3,h.GAMEOVER=4,h.GAME_END=5,h.SCORE=6,h.CREDITS=7,h.SETTINGS=8,h.USER=100,h.onPause=null,h.onResume=null,h.onStop=null,h.onRestart=null,h.init=function(){h.set(h.LOADING,new me.DefaultLoadingScreen),a.addEventListener("blur",function(){i!==h.LOADING&&(me.sys.stopOnBlur&&(h.stop(!0),h.onStop&&h.onStop(),me.event.publish(me.event.STATE_STOP)),me.sys.pauseOnBlur&&(h.pause(!0),h.onPause&&h.onPause(),me.event.publish(me.event.STATE_PAUSE)))},!1),a.addEventListener("focus",function(){i!==h.LOADING&&(me.sys.resumeOnFocus&&(h.resume(!0),h.onResume&&h.onResume(),me.event.publish(me.event.STATE_RESUME)),me.sys.stopOnBlur&&(h.restart(!0),me.game.repaint(),h.onRestart&&h.onRestart(),me.event.publish(me.event.STATE_RESTART)))},!1)},h.stop=function(a){f(),a&&me.audio.pauseTrack()},h.pause=function(a){d(),a&&me.audio.pauseTrack()},h.restart=function(a){b(),a&&me.audio.resumeTrack()},h.resume=function(a){c(),a&&me.audio.resumeTrack()},h.isRunning=function(){return-1!==j},h.isPaused=function(){return k},h.set=function(a,b){l[a]={},l[a].screen=b,l[a].transition=!0},h.current=function(){return l[i].screen},h.transition=function(a,b,c){"fade"===a&&(m.color=b,m.duration=c)},h.setTransition=function(a,b){l[a].transition=b},h.change=function(a){if("undefined"==typeof l[a])throw"melonJS : Undefined ScreenObject for state '"+a+"'";o=null,arguments.length>1&&(o=Array.prototype.slice.call(arguments,1)),m.duration&&l[a].transition?(n=function(){me.game.viewport.fadeOut(m.color,m.duration)},me.game.viewport.fadeIn(m.color,m.duration,function(){g.defer(a)})):g.defer(a)},h.isCurrent=function(a){return i===a},h}()}(window),function(){me.DefaultLoadingScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.invalidate=!1,this.handle=null},onResetEvent:function(){this.logo1=new me.Font("Varela Round",32,"#669ecc","middle"),this.logo2=new me.Font("Varela Round",32,"#4a7ca6","middle"),this.logo2.bold(),this.logo1.textBaseline=this.logo2.textBaseline="alphabetic",this.barHeight=4,this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,this.onProgressUpdate.bind(this)),this.loadPercent=0},onDestroyEvent:function(){this.logo1=this.logo2=null,this.handle&&(me.event.unsubscribe(this.handle),this.handle=null)},onProgressUpdate:function(a){this.loadPercent=a,this.invalidate=!0},update:function(){return this.invalidate===!0?(this.invalidate=!1,!0):!1},drawLogo:function(a){a.save()},draw:function(a){var b=this.logo1.measureText(a,"ms").width,c=(me.video.getWidth()-b-this.logo2.measureText(a,"GELEE").width)/2,d=me.video.getHeight()/2+this.logo2.measureText(a,"ms").height;me.video.clearSurface(a,"#000"),this.drawLogo(a,(me.video.getWidth()-100)/2,me.video.getHeight()/2-this.barHeight/2-90),this.logo1.draw(a,"ms",c,d),c+=b,this.logo2.draw(a,"GELEE",c,d);var e=Math.floor(this.loadPercent*me.video.getWidth());a.fillStyle="black",a.fillRect(0,me.video.getHeight()/2-this.barHeight/2,me.video.getWidth(),this.barHeight),a.fillStyle="#669ecc",a.fillRect(2,me.video.getHeight()/2-this.barHeight/2,e,this.barHeight)}})}(window),function(){me.loader=function(){function a(){m===l?f.onload?(clearTimeout(n),setTimeout(function(){f.onload(),me.event.publish(me.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):n=setTimeout(a,100)}function b(a,b,c){g[a.name]=new Image,g[a.name].onload=b,g[a.name].onerror=c,g[a.name].src=a.src+f.nocache}function c(a,b,c){var d=new XMLHttpRequest,e=me.utils.getFileExtension(a.src).toLowerCase();d.overrideMimeType&&d.overrideMimeType("json"===e?"application/json":"text/xml"),d.open("GET",a.src+f.nocache,!0),"tmx"===a.type&&me.levelDirector.addTMXLevel(a.name),d.ontimeout=c,d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status||0===d.status&&d.responseText){var f=null;switch(e){case"xml":case"tmx":f=me.device.ua.match(/msie/i)||!d.responseXML?(new DOMParser).parseFromString(d.responseText,"text/xml"):d.responseXML,e="xml";break;case"json":f=JSON.parse(d.responseText);break;default:throw"melonJS: TMX file format "+e+"not supported !"}h[a.name]={data:f,isTMX:"tmx"===a.type,format:e},b()}else c()},d.send(null)}function d(a,b,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("application/json"),d.open("GET",a.src+f.nocache,!0),d.ontimeout=c,d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status&&d.responseText?(k[a.name]=JSON.parse(d.responseText),b()):c())},d.send(null)}function e(a,b,c){var d=new XMLHttpRequest;d.open("GET",a.src+f.nocache,!0),d.responseType="arraybuffer",d.onerror=c,d.onload=function(){var c=d.response;if(c){for(var e=new Uint8Array(c),f=[],g=0;g<e.byteLength;g++)f[g]=String.fromCharCode(e[g]);i[a.name]=f.join(""),b()}},d.send()}var f={},g={},h={},i={},j={},k={},l=0,m=0,n=0;return f.nocache="",f.onload=void 0,f.onProgress=void 0,f.onResourceLoaded=function(){m++;var a=f.getLoadProgress();f.onProgress&&f.onProgress(a),me.event.publish(me.event.LOADER_PROGRESS,[a])},f.onLoadingError=function(a){throw"melonJS: Failed loading resource "+a.src},f.setNocache=function(a){f.nocache=a?"?"+parseInt(1e7*Math.random(),10):""},f.preload=function(b){for(var c=0;c<b.length;c++)l+=f.load(b[c],f.onResourceLoaded.bind(f),f.onLoadingError.bind(f,b[c]));a()},f.load=function(a,f,g){switch(a.name=a.name.toLowerCase(),a.type){case"binary":return e.call(this,a,f,g),1;case"image":return b.call(this,a,f,g),1;case"json":return d.call(this,a,f,g),1;case"tmx":case"tsx":return c.call(this,a,f,g),1;case"audio":if(me.audio.isAudioEnable())return me.audio.load(a,f,g),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+a.type}return 0},f.unload=function(a){switch(a.name=a.name.toLowerCase(),a.type){case"binary":return a.name in i?(delete i[a.name],!0):!1;case"image":return a.name in g?("function"==typeof g[a.name].dispose&&g[a.name].dispose(),delete g[a.name],!0):!1;case"json":return a.name in k?(delete k[a.name],!0):!1;case"tmx":case"tsx":return a.name in h?(delete h[a.name],!0):!1;case"audio":return me.audio.unload(a.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+a.type}},f.unloadAll=function(){var a;for(a in i)f.unload(a);for(a in g)f.unload(a);for(a in h)f.unload(a);for(a in j)f.unload(a);for(a in k)f.unload(a);me.audio.unloadAll()},f.getTMXFormat=function(a){return a=a.toLowerCase(),a in h?h[a].format:null},f.getTMX=function(a){return a=a.toLowerCase(),a in h?h[a].data:null},f.getBinary=function(a){return a=a.toLowerCase(),a in i?i[a]:null},f.getImage=function(a){return a=a.toLowerCase(),a in g?g[a]:null},f.getJSON=function(a){return a=a.toLowerCase(),a in k?k[a]:null},f.getLoadProgress=function(){return m/l},f}()}(window),function(){me.Font=me.Renderable.extend({font:null,fontSize:null,fillStyle:"#000000",strokeStyle:"#000000",lineWidth:1,textAlign:"left",textBaseline:"top",lineHeight:1,init:function(a,b,c,d){this.pos=new me.Vector2d,this.fontSize=new me.Vector2d,this.set(a,b,c,d),this.parent(this.pos,0,this.fontSize.y)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(a,b,c,d){var e=a.split(",").map(function(a){return a=a.trim(),/(^".*"$)|(^'.*'$)/.test(a)?a:'"'+a+'"'});this.fontSize.y=parseInt(b,10),this.height=this.fontSize.y,"number"==typeof b&&(b+="px"),this.font=b+" "+e.join(","),this.fillStyle=c,d&&(this.textAlign=d)},measureText:function(a,b){a.font=this.font,a.fillStyle=this.fillStyle,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,this.height=this.width=0;for(var c=(""+b).split("\n"),d=0;d<c.length;d++)this.width=Math.max(a.measureText(c[d].trimRight()).width,this.width),this.height+=this.fontSize.y*this.lineHeight;return{width:this.width,height:this.height}},draw:function(a,b,c,d){this.pos.set(c,d),a.font=this.font,a.fillStyle=this.fillStyle,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var e=(""+b).split("\n"),f=0;f<e.length;f++)a.fillText(e[f].trimRight(),~~c,~~d),d+=this.fontSize.y*this.lineHeight},drawStroke:function(a,b,c,d){this.pos.set(c,d),a.save(),a.font=this.font,a.fillStyle=this.fillStyle,a.strokeStyle=this.strokeStyle,a.lineWidth=this.lineWidth,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var e=(""+b).split("\n"),f=0;f<e.length;f++){var g=e[f].trimRight();a.strokeText(g,~~c,~~d),a.fillText(g,~~c,~~d),d+=this.fontSize.y*this.lineHeight}a.restore()}}),me.BitmapFont=me.Font.extend({sSize:null,firstChar:32,charCount:0,init:function(a,b,c,d){this.parent(a,null,null),this.sSize=new me.Vector2d,this.firstChar=d||32,this.loadFontMetrics(a,b),this.textAlign="left",this.textBaseline="top",c&&this.resize(c)},loadFontMetrics:function(a,b){this.font=me.loader.getImage(a),this.fontSize.x=b.x||b,this.fontSize.y=b.y||this.font.height,this.sSize.copy(this.fontSize),this.height=this.sSize.y,this.charCount=~~(this.font.width/this.fontSize.x)},set:function(a,b){this.textAlign=a,b&&this.resize(b)},resize:function(a){this.sSize.setV(this.fontSize),this.sSize.x*=a,this.sSize.y*=a,this.height=this.sSize.y},measureText:function(a,b){var c=(""+b).split("\n");this.height=this.width=0;for(var d=0;d<c.length;d++)this.width=Math.max(c[d].trimRight().length*this.sSize.x,this.width),this.height+=this.sSize.y*this.lineHeight;return{width:this.width,height:this.height}},draw:function(a,b,c,d){var e=(""+b).split("\n"),f=c,g=this.sSize.y*this.lineHeight;this.pos.set(c,d);for(var h=0;h<e.length;h++){c=f;var i=e[h].trimRight(),j=i.length*this.sSize.x;switch(this.textAlign){case"right":c-=j;break;case"center":c-=.5*j}switch(this.textBaseline){case"middle":d-=.5*g;break;case"ideographic":case"alphabetic":case"bottom":d-=g}for(var k=0,l=i.length;l>k;k++){var m=i.charCodeAt(k)-this.firstChar;m>=0&&a.drawImage(this.font,this.fontSize.x*(m%this.charCount),this.fontSize.y*~~(m/this.charCount),this.fontSize.x,this.fontSize.y,~~c,~~d,this.sSize.x,this.sSize.y),c+=this.sSize.x}d+=g}}})}(window),function(){me.audio=function(){function a(a){var b="",c=a.length;if(me.device.sound)for(var d="",e=0;c>e&&(d=a[e].toLowerCase().trim(),!g.capabilities[d]||!g.capabilities[d].canPlay||""!==b&&"probably"!==g.capabilities[d].canPlayType||(b=d,"probably"!==g.capabilities[d].canPlayType));e++);return""===b&&(l=!1),b}function b(a){for(var b,c=h[a],d=0;b=c[d++];)if(b.ended||!b.currentTime)return b.currentTime=m,b;return c[0].pause(),c[0].currentTime=m,c[0]}function c(a,b){if(n++>3){var c="melonJS: failed loading "+a+"."+i;if(me.sys.stopOnAudioError!==!1)throw c;me.audio.disable(),b&&b(),console.log(c+", disabling audio")}else h[a][0].load()}function d(a,b,c){if(n=0,b>1)for(var d=h[a][0],e=1;b>e;e++)h[a][e]=new Audio(d.src),h[a][e].preload="auto",h[a][e].load();c&&c()}function e(a,c,d,e){var f=b(a.toLowerCase());return f.loop=c||!1,f.volume=e?parseFloat(e).clamp(0,1):o.volume,f.muted=o.muted,f.play(),d&&!c&&f.addEventListener("ended",function g(){f.removeEventListener("ended",g,!1),d()},!1),f}function f(a,b,c){return c&&!b&&setTimeout(c,2e3),null}var g={},h={},i=-1,j=null,k=null,l=!0,m=0,n=0,o={volume:1,muted:!1},p=!1,q=[];return g.capabilities={mp3:{codec:"audio/mpeg",canPlay:!1,canPlayType:"no"},ogg:{codec:'audio/ogg; codecs="vorbis"',canPlay:!1,canPlayType:"no"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',canPlay:!1,canPlayType:"no"},wav:{codec:'audio/wav; codecs="1"',canPlay:!1,canPlayType:"no"}},g.detectCapabilities=function(){var a=document.createElement("audio");if(a.canPlayType)for(var b in g.capabilities){var c=a.canPlayType(g.capabilities[b].codec);""!==c&&"no"!==c&&(g.capabilities[b].canPlay=!0,g.capabilities[b].canPlayType=c),me.device.sound|=g.capabilities[b].canPlay}},g.init=function(b){if(!me.initialized)throw"melonJS: me.audio.init() called before engine initialization.";return b="string"==typeof b?b:"mp3",b=b.split(","),i=a(b),me.device.isMobile&&!navigator.isCocoonJS&&(l=!1),g.play=g.isAudioEnable()?e:f,g.isAudioEnable()},g.isAudioEnable=function(){return l},g.enable=function(){l=me.device.sound,g.play=l?e:f},g.disable=function(){me.audio.stopTrack(),g.play=f,l=!1},g.load=function(a,b,e){if(-1===i)return 0;if(me.device.isMobile&&!navigator.isCocoonJS){if(p)return void q.push([a,b,e]);p=!0}var f=a.channel||1,j="canplaythrough";a.stream!==!0||me.device.isMobile||(f=1,j="canplay");var k=new Audio(a.src+a.name+"."+i+me.loader.nocache);return k.preload="auto",k.addEventListener(j,function l(){k.removeEventListener(j,l,!1),p=!1,d.call(me.audio,a.name,f,b);var c=q.shift();c&&g.load.apply(g,c)},!1),k.addEventListener("error",function(){c.call(me.audio,a.name,e)},!1),k.load(),h[a.name]=[k],1},g.stop=function(a){if(l)for(var b=h[a.toLowerCase()],c=b.length;c--;)b[c].pause(),b[c].currentTime=m},g.pause=function(a){if(l)for(var b=h[a.toLowerCase()],c=b.length;c--;)b[c].pause()},g.playTrack=function(a,b){k=me.audio.play(a,!0,null,b),j=a.toLowerCase()},g.stopTrack=function(){l&&k&&(k.pause(),j=null,k=null)},g.setVolume=function(a){"number"==typeof a&&(o.volume=a.clamp(0,1))},g.getVolume=function(){return o.volume},g.mute=function(a,b){b=void 0===b?!0:!!b;for(var c,d=h[a.toLowerCase()],e=0;c=d[e++];)c.muted=b},g.unmute=function(a){g.mute(a,!1)},g.muteAll=function(){o.muted=!0;for(var a in h)g.mute(a,o.muted)},g.unmuteAll=function(){o.muted=!1;for(var a in h)g.mute(a,o.muted)},g.getCurrentTrack=function(){return j},g.pauseTrack=function(){l&&k&&k.pause()},g.resumeTrack=function(){l&&k&&k.play()},g.unload=function(a){return a=a.toLowerCase(),a in h?(j===a?g.stopTrack():g.stop(a),delete h[a],!0):!1},g.unloadAll=function(){for(var a in h)g.unload(a)},g}()}(window),function(){me.video=function(){function a(){return navigator.isCocoonJS?"screencanvas":"canvas"}var b={},c=null,d=null,e=null,f=null,g=null,h=-1,i=!1,j=0,k=0,l=!1,m=!0,n=1/0,o=1/0;return b.init=function(a,h,n,o,p,q){if(!me.initialized)throw"melonJS: me.video.init() called before engine initialization.";if(i=o||!1,l="auto"===p||!1,m=void 0!==q?q:!0,p="auto"!==p?parseFloat(p||1):1,me.sys.scale=new me.Vector2d(p,p),(l||1!==p)&&(i=!0),j=h*me.sys.scale.x,k=n*me.sys.scale.y,window.addEventListener("resize",throttle(100,!1,function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])}),!1),window.addEventListener("orientationchange",function(a){me.event.publish(me.event.WINDOW_ONORIENTATION_CHANGE,[a])},!1),me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video)),me.event.subscribe(me.event.WINDOW_ONORIENTATION_CHANGE,me.video.onresize.bind(me.video)),c=b.createCanvas(j,k,!0),a&&(g=document.getElementById(a)),g||(g=document.body),g.appendChild(c),!c.getContext)return!1;if(d=b.getContext2d(c),me.device.getPixelRatio()>1&&(c.style.width=c.width/me.device.getPixelRatio()+"px",c.style.height=c.height/me.device.getPixelRatio()+"px"),i?(e=b.createCanvas(h,n,!1),f=b.getContext2d(e)):(e=c,f=d),window.getComputedStyle){var r=window.getComputedStyle(c,null);me.video.setMaxSize(parseInt(r.maxWidth,10),parseInt(r.maxHeight,10))}return me.video.onresize(null),me.game.init(),!0},b.getWrapper=function(){return g},b.getWidth=function(){return e.width},b.getPos=function(a){return a=a||c,a.getBoundingClientRect?a.getBoundingClientRect():{left:0,top:0}},b.getHeight=function(){return e.height},b.setMaxSize=function(a,b){n=a||1/0,o=b||1/0},b.createCanvas=function(b,c,d){if(0===b||0===c)throw new Error("melonJS: width or height was zero, Canvas could not be initialized !");var f=d===!0?a():"canvas",g=document.createElement(f);return g.width=b||e.width,g.height=c||e.height,g},b.getContext2d=function(a){var b;return b=navigator.isCocoonJS?a.getContext("2d",{antialias:me.sys.scalingInterpolation}):a.getContext("2d"),b.canvas||(b.canvas=a),me.video.setImageSmoothing(b,me.sys.scalingInterpolation),b},b.getScreenCanvas=function(){return c},b.getScreenContext=function(){return d},b.getSystemCanvas=function(){return e},b.getSystemContext=function(){return f},b.onresize=function(){var a=1,b=1;if(me.device.orientation="undefined"!=typeof window.orientation?window.orientation:window.outerWidth>window.outerHeight?90:0,l){var c=me.video.getScreenCanvas().parentNode,d=Math.min(n,c.width||window.innerWidth),e=Math.min(o,c.height||window.innerHeight);if(m){var f=me.video.getWidth()/me.video.getHeight(),g=d/e;a=b=f>g?d/me.video.getWidth():e/me.video.getHeight()}else a=d/me.video.getWidth(),b=e/me.video.getHeight();if(a*=me.device.getPixelRatio(),b*=me.device.getPixelRatio(),1!==a||1!==b)return h>=0&&clearTimeout(h),void(h=me.video.updateDisplaySize.defer(a,b))}me.input.offset=me.video.getPos()},b.updateDisplaySize=function(a,f){me.sys.scale.set(a,f),c.width=j=e.width*a,c.height=k=e.height*f,me.device.getPixelRatio()>1&&(c.style.width=c.width/me.device.getPixelRatio()+"px",c.style.height=c.height/me.device.getPixelRatio()+"px"),me.video.setImageSmoothing(d,me.sys.scalingInterpolation),me.input.offset=me.video.getPos(),b.blitSurface(),h=-1},b.clearSurface=function(a,b){var c=a.canvas.width,d=a.canvas.height;a.save(),a.setTransform(1,0,0,1,0,0),"rgba"===b.substr(0,4)&&a.clearRect(0,0,c,d),a.fillStyle=b,a.fillRect(0,0,c,d),a.restore()},b.setImageSmoothing=function(a,b){for(var c=["ms","moz","webkit","o"],d=0;d<c.length;++d)void 0!==a[c[d]+"ImageSmoothingEnabled"]&&(a[c[d]+"ImageSmoothingEnabled"]=b===!0);a.imageSmoothingEnabled=b===!0},b.setAlpha=function(a,b){a.globalCompositeOperation=b?"source-over":"copy"},b.blitSurface=function(){b.blitSurface=i?function(){d.drawImage(e,0,0,e.width,e.height,0,0,j,k)}:function(){},b.blitSurface()},b.applyRGBFilter=function(a,c,d){var e,f,g=b.getContext2d(b.createCanvas(a.width,a.height,!1)),h=me.utils.getPixels(a),i=h.data;switch(c){case"b&w":for(e=0,f=i.length;f>e;e+=4){var j=3*i[e]+4*i[e+1]+i[e+2]>>>3;i[e]=j,i[e+1]=j,i[e+2]=j}break;case"brightness":var k=Math.abs(d).clamp(0,1);for(e=0,f=i.length;f>e;e+=4)i[e]*=k,i[e+1]*=k,i[e+2]*=k;break;case"transparent":for(e=0,f=i.length;f>e;e+=4)me.utils.RGBToHex(i[e],i[e+1],i[e+2])===d&&(i[e+3]=0);break;default:return null}return g.putImageData(h,0,0),g},b}()}(window),function(a){me.input=function(){function b(){t||(a.addEventListener("keydown",f,!1),a.addEventListener("keyup",g,!1),t=!0)}function c(a,b){for(var c=2;c<a.length;++c)void 0!==a[c]&&me.video.getScreenCanvas().addEventListener(a[c],b,!1)}function d(){u||(m.changedTouches.push({x:0,y:0}),m.mouse.pos=new me.Vector2d(0,0),m.offset=me.video.getPos(),a.addEventListener("scroll",throttle(100,!1,function(a){m.offset=me.video.getPos(),me.event.publish(me.event.WINDOW_ONSCROLL,[a])
}),!1),x=a.navigator.pointerEnabled?A:a.navigator.msPointerEnabled?B:me.device.touch?z:y,c(x,l),v="onwheel"in document.createElement("div")?"wheel":"mousewheel",a.addEventListener(v,j,!1),void 0===m.throttlingInterval&&(m.throttlingInterval=Math.floor(1e3/me.sys.fps)),m.throttlingInterval<17?me.video.getScreenCanvas().addEventListener(x[C],k,!1):me.video.getScreenCanvas().addEventListener(x[C],throttle(m.throttlingInterval,!1,function(a){k(a)}),!1),u=!0)}function e(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function f(a,b,c){b=b||a.keyCode||a.which;var d=n[b];if(me.event.publish(me.event.KEYDOWN,[d,b,d?!q[d]:!0]),d){if(!q[d]){var f=c?c:b;r[d][f]||(o[d]++,r[d][f]=!0)}return e(a)}return!0}function g(a,b,c){b=b||a.keyCode||a.which;var d=n[b];if(me.event.publish(me.event.KEYUP,[d,b]),d){var f=c?c:b;return r[d][f]=void 0,o[d]>0&&o[d]--,q[d]=!1,e(a)}return!0}function h(a){var b=!1,c=s[a.type];if(c||(c=x.indexOf(a.type)===F?s[x[E]]:s[a.type]),c)for(var d=me.game.viewport.localToWorld(0,0),e=0,f=m.changedTouches.length;f>e;e++){if("undefined"!=typeof a.timeStamp){if(a.timeStamp<w)continue;w=a.timeStamp}me.device.pointerEnabled||(a.pointerId=m.changedTouches[e].id),a.gameScreenX=m.changedTouches[e].x,a.gameScreenY=m.changedTouches[e].y,a.gameWorldX=a.gameScreenX+d.x,a.gameWorldY=a.gameScreenY+d.y;for(var g,h=c.length;h--,g=c[h];)if(g.floating===!0?(a.gameX=a.gameScreenX,a.gameY=a.gameScreenY):(a.gameX=a.gameWorldX,a.gameY=a.gameWorldY),(null===g.rect||g.rect.containsPoint(a.gameX,a.gameY))&&g.cb(a)===!1){b=!0;break}}return b}function i(a){var b;if(m.changedTouches.length=0,a.touches)for(var c=0,d=a.changedTouches.length;d>c;c++){var e=a.changedTouches[c];b=m.globalToLocal(e.clientX,e.clientY),b.id=e.identifier,m.changedTouches.push(b)}else b=m.globalToLocal(a.clientX,a.clientY),b.id=a.pointerId||1,m.changedTouches.push(b);a.isPrimary!==!1&&m.mouse.pos.set(m.changedTouches[0].x,m.changedTouches[0].y)}function j(a){if(a.target===me.video.getScreenCanvas()){var b={deltaMode:1,type:"mousewheel",deltaX:a.deltaX,deltaY:a.deltaY,deltaZ:a.deltaZ};if("mousewheel"===v&&(b.deltaY=-1/40*a.wheelDelta,a.wheelDeltaX&&(b.deltaX=-1/40*a.wheelDeltaX)),h(b))return e(a)}return!0}function k(a){return i(a),h(a)?e(a):!0}function l(a){if(i(a),h(a))return e(a);var b=a.button||0,c=m.mouse.bind[b];return c?a.type===x[D]?f(a,c,b+1):g(a,c,b+1):!0}var m={},n={},o={},p={},q={},r={},s={},t=!1,u=!1,v="mousewheel",w=0,x=null,y=["mousewheel","mousemove","mousedown","mouseup",void 0,"click","dblclick"],z=[void 0,"touchmove","touchstart","touchend","touchcancel","tap","dbltap"],A=["mousewheel","pointermove","pointerdown","pointerup","pointercancel",void 0,void 0],B=["mousewheel","MSPointerMove","MSPointerDown","MSPointerUp","MSPointerCancel",void 0,void 0],C=1,D=2,E=3,F=4;return m.mouse={pos:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0]},m.offset=null,m.throttlingInterval=void 0,m.changedTouches=[],m.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},m.isKeyPressed=function(a){return o[a]&&!q[a]?(p[a]&&(q[a]=!0),!0):!1},m.keyStatus=function(a){return o[a]>0},m.triggerKeyEvent=function(a,b){b?f({},a):g({},a)},m.bindKey=function(a,c,d){b(),n[a]=c,o[c]=0,p[c]=d?d:!1,q[c]=!1,r[c]={}},m.unlockKey=function(a){q[a]=!1},m.unbindKey=function(a){o[n[a]]=0,p[n[a]]=!1,r[n[a]]={},n[a]=null},m.globalToLocal=function(a,b){var c=m.offset,d=me.device.getPixelRatio();a-=c.left,b-=c.top;var e=me.sys.scale;return(1!==e.x||1!==e.y)&&(a/=e.x,b/=e.y),new me.Vector2d(a*d,b*d)},m.bindMouse=function(a,b){if(d(),!n[b])throw"melonJS : no action defined for keycode "+b;m.mouse.bind[a]=b},m.unbindMouse=function(a){m.mouse.bind[a]=null},m.bindTouch=function(a){m.bindMouse(me.input.mouse.LEFT,a)},m.unbindTouch=function(){m.unbindMouse(me.input.mouse.LEFT)},m.registerPointerEvent=function(a,b,c,e){if(d(),-1!==y.indexOf(a)&&(me.device.touch||me.device.pointerEnabled)&&(a=x[y.indexOf(a)]),a&&-1!==x.indexOf(a)){s[a]||(s[a]=[]);var f=b.floating===!0?!0:!1;return e&&(f=e===!0?!0:!1),void s[a].push({rect:b||null,cb:c,floating:f})}throw"melonJS : invalid event type : "+a},m.releasePointerEvent=function(a,b){-1!==y.indexOf(a)&&(me.device.touch||me.device.pointerEnabled)&&(a=x[y.indexOf(a)]);{if(!a||-1===x.indexOf(a))throw"melonJS : invalid event type : "+a;s[a]||(s[a]=[]);var c=s[a];if(c)for(var d,e=c.length;e--,d=c[e];)d.rect===b&&(d.rect=d.cb=d.floating=null,s[a].splice(e,1))}},m}()}(window),function(a){var b=function(){var b={},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return b.decode=function(b){if(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,""),me.device.nativeBase64)return a.atob(b);for(var d,e,f,g,h,i,j,k=[],l=0;l<b.length;)g=c.indexOf(b.charAt(l++)),h=c.indexOf(b.charAt(l++)),i=c.indexOf(b.charAt(l++)),j=c.indexOf(b.charAt(l++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,k.push(String.fromCharCode(d)),64!==i&&k.push(String.fromCharCode(e)),64!==j&&k.push(String.fromCharCode(f));return k=k.join("")},b}();me.utils=function(){var a={},c={},d="",e=0,f=/^.*(\\|\/|\:)/,g=/\.[^\.]*$/;return a.decodeBase64=function(a){return b.decode(a)},a.decodeBase64AsArray=function(a,c){c=c||1;var d,e,f,g,h=b.decode(a);for(g="function"==typeof window.Uint32Array?new Uint32Array(h.length/c):[],d=0,f=h.length/c;f>d;d++)for(g[d]=0,e=c-1;e>=0;--e)g[d]+=h.charCodeAt(d*c+e)<<(e<<3);return g},a.decompress=function(){throw"melonJS: GZIP/ZLIB compressed TMX Tile Map not supported!"},a.decodeCSV=function(a,b){a=a.trim().split("\n");for(var c=[],d=0;d<a.length;d++)for(var e=a[d].split(",",b),f=0;f<e.length;f++)c.push(+e[f]);return c},a.getBasename=function(a){return a.replace(f,"").replace(g,"")},a.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)},a.HexToRGB=function(a,b){if("#"!==a.charAt(0))return a;if(a=a.substring(1,a.length),null==c[a]){var d,e,f;a.length<6?(d=a.charAt(0)+a.charAt(0),e=a.charAt(1)+a.charAt(1),f=a.charAt(2)+a.charAt(2)):(d=a.substring(0,2),e=a.substring(2,4),f=a.substring(4,6)),c[a]=parseInt(d,16)+","+parseInt(e,16)+","+parseInt(f,16)}return(b?"rgba(":"rgb(")+c[a]+(b?","+b+")":")")},a.RGBToHex=function(a,b,c){return a.toHex()+b.toHex()+c.toHex()},a.getPixels=function(a){if(a instanceof HTMLImageElement){var b=me.video.getContext2d(me.video.createCanvas(a.width,a.height));return b.drawImage(a,0,0),b.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,0,a.width,a.height)},a.resetGUID=function(a){d=a.toString().toUpperCase().toHex(),e=0},a.createGUID=function(){return d+"-"+e++},a.applyFriction=function(a,b){return 0>a+b?a+b*me.timer.tick:a-b>0?a-b*me.timer.tick:0},a}()}(window),function(){me.save=function(){function a(a){return"add"===a||"delete"===a}var b={},c={_init:function(){if(me.device.localStorage===!0){var a=JSON.parse(localStorage.getItem("me.save"))||[];a.forEach(function(a){b[a]=JSON.parse(localStorage.getItem("me.save."+a))})}},add:function(d){Object.keys(d).forEach(function(e){a(e)||(!function(a){Object.defineProperty(c,a,{configurable:!0,enumerable:!0,get:function(){return b[a]},set:function(c){b[a]=c,me.device.localStorage===!0&&localStorage.setItem("me.save."+a,JSON.stringify(c))}})}(e),e in b||(c[e]=d[e]))}),me.device.localStorage===!0&&localStorage.setItem("me.save",JSON.stringify(Object.keys(b)))},"delete":function(c){a(c)||"undefined"!=typeof b[c]&&(delete b[c],me.device.localStorage===!0&&(localStorage.removeItem("me.save."+c),localStorage.setItem("me.save",JSON.stringify(Object.keys(b)))))}};return c}()}(window),function(){me.COLLISION_LAYER="collision",me.TMX_TAG_MAP="map",me.TMX_TAG_NAME="name",me.TMX_TAG_VALUE="value",me.TMX_TAG_VERSION="version",me.TMX_TAG_ORIENTATION="orientation",me.TMX_TAG_WIDTH="width",me.TMX_TAG_HEIGHT="height",me.TMX_TAG_OPACITY="opacity",me.TMX_TAG_TRANS="trans",me.TMX_TAG_TILEWIDTH="tilewidth",me.TMX_TAG_TILEHEIGHT="tileheight",me.TMX_TAG_TILEOFFSET="tileoffset",me.TMX_TAG_FIRSTGID="firstgid",me.TMX_TAG_GID="gid",me.TMX_TAG_TILE="tile",me.TMX_TAG_ID="id",me.TMX_TAG_DATA="data",me.TMX_TAG_COMPRESSION="compression",me.TMX_TAG_GZIP="gzip",me.TMX_TAG_ZLIB="zlib",me.TMX_TAG_ENCODING="encoding",me.TMX_TAG_ATTR_BASE64="base64",me.TMX_TAG_CSV="csv",me.TMX_TAG_SPACING="spacing",me.TMX_TAG_MARGIN="margin",me.TMX_TAG_PROPERTIES="properties",me.TMX_TAG_PROPERTY="property",me.TMX_TAG_IMAGE="image",me.TMX_TAG_SOURCE="source",me.TMX_TAG_VISIBLE="visible",me.TMX_TAG_TILESET="tileset",me.TMX_TAG_LAYER="layer",me.TMX_TAG_TILE_LAYER="tilelayer",me.TMX_TAG_IMAGE_LAYER="imagelayer",me.TMX_TAG_OBJECTGROUP="objectgroup",me.TMX_TAG_OBJECT="object",me.TMX_TAG_X="x",me.TMX_TAG_Y="y",me.TMX_TAG_WIDTH="width",me.TMX_TAG_HEIGHT="height",me.TMX_TAG_POLYGON="polygon",me.TMX_TAG_POLYLINE="polyline",me.TMX_TAG_ELLIPSE="ellipse",me.TMX_TAG_POINTS="points",me.TMX_BACKGROUND_COLOR="backgroundcolor"}(window),function(){me.TMXUtils=function(){function a(a){if(!a||a.isBoolean())a=a?"true"===a:!0;else if(a.isNumeric())a=Number(a);else if(a.match(/^json:/i)){var b=a.split(/^json:/i)[1];try{a=JSON.parse(b)}catch(c){throw"Unable to parse JSON: "+b}}return a}var b={};return b.applyTMXPropertiesFromXML=function(b,c){var d=c.getElementsByTagName(me.TMX_TAG_PROPERTIES)[0];if(d)for(var e=d.getElementsByTagName(me.TMX_TAG_PROPERTY),f=0;f<e.length;f++){var g=me.mapReader.TMXParser.getStringAttribute(e[f],me.TMX_TAG_NAME),h=me.mapReader.TMXParser.getStringAttribute(e[f],me.TMX_TAG_VALUE);b[g]=a(h)}},b.applyTMXPropertiesFromJSON=function(b,c){var d=c[me.TMX_TAG_PROPERTIES];if(d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=a(d[e]))},b.mergeProperties=function(a,b,c){for(var d in b)(c||void 0===a[d])&&(a[d]=b[d]);return a},b}()}(window),function(){me.TMXObjectGroup=Object.extend({name:null,width:0,height:0,visible:!1,z:0,objects:[],initFromXML:function(a,b,c,d){this.name=a,this.width=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_WIDTH),this.height=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_HEIGHT),this.visible=1===me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_VISIBLE,1),this.opacity=me.mapReader.TMXParser.getFloatAttribute(b,me.TMX_TAG_OPACITY,1).clamp(0,1),this.z=d,this.objects=[],b.firstChild&&b.firstChild.nextSibling.nodeName===me.TMX_TAG_PROPERTIES&&me.TMXUtils.applyTMXPropertiesFromXML(this,b);for(var e=b.getElementsByTagName(me.TMX_TAG_OBJECT),f=0;f<e.length;f++){var g=new me.TMXObject;g.initFromXML(e[f],c,d),this.objects.push(g)}},initFromJSON:function(a,b,c,d){var e=this;this.name=a,this.width=b[me.TMX_TAG_WIDTH],this.height=b[me.TMX_TAG_HEIGHT],this.visible=b[me.TMX_TAG_VISIBLE],this.opacity=parseFloat(b[me.TMX_TAG_OPACITY]||1).clamp(0,1),this.z=d,this.objects=[],me.TMXUtils.applyTMXPropertiesFromJSON(this,b),b.objects.forEach(function(a){var b=new me.TMXObject;b.initFromJSON(a,c,d),e.objects.push(b)})},reset:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}}),me.TMXObject=Object.extend({name:null,x:0,y:0,width:0,height:0,z:0,gid:void 0,isPolygon:!1,isPolyline:!1,points:void 0,initFromXML:function(a,b,c){if(this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME),this.x=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_X),this.y=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_Y),this.z=c,this.width=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH,0),this.height=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT,0),this.gid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_GID,null),this.isEllipse=!1,this.isPolygon=!1,this.isPolyline=!1,this.gid)this.setImage(this.gid,b);else if(a.getElementsByTagName(me.TMX_TAG_ELLIPSE).length)this.isEllipse=!0;else{var d=a.getElementsByTagName(me.TMX_TAG_POLYGON);if(d.length?this.isPolygon=!0:(d=a.getElementsByTagName(me.TMX_TAG_POLYLINE),d.length&&(this.isPolyline=!0)),d.length){this.points=[];for(var e,f=me.mapReader.TMXParser.getStringAttribute(d[0],me.TMX_TAG_POINTS).split(" "),g=0;g<f.length;g++)e=f[g].split(","),this.points.push(new me.Vector2d(+e[0],+e[1]))}}me.game.renderer.adjustPosition(this),me.TMXUtils.applyTMXPropertiesFromXML(this,a)},initFromJSON:function(a,b,c){if(this.name=a[me.TMX_TAG_NAME],this.x=parseInt(a[me.TMX_TAG_X],10),this.y=parseInt(a[me.TMX_TAG_Y],10),this.z=parseInt(c,10),this.width=parseInt(a[me.TMX_TAG_WIDTH]||0,10),this.height=parseInt(a[me.TMX_TAG_HEIGHT]||0,10),this.gid=parseInt(a[me.TMX_TAG_GID],10)||null,this.isEllipse=!1,this.isPolygon=!1,this.isPolyline=!1,this.gid)this.setImage(this.gid,b);else if(void 0!==a[me.TMX_TAG_ELLIPSE])this.isEllipse=!0;else{var d=a[me.TMX_TAG_POLYGON];if(void 0!==d?this.isPolygon=!0:(d=a[me.TMX_TAG_POLYLINE],void 0!==d&&(this.isPolyline=!0)),void 0!==d){this.points=[];var e=this;d.forEach(function(a){e.points.push(new me.Vector2d(parseInt(a.x,10),parseInt(a.y,10)))})}}me.game.renderer.adjustPosition(this),me.TMXUtils.applyTMXPropertiesFromJSON(this,a)},setImage:function(a,b){var c=b.getTilesetByGid(this.gid);this.width=c.tilewidth,this.height=c.tileheight,this.spritewidth=this.width;var d=new me.Tile(this.x,this.y,c.tilewidth,c.tileheight,this.gid);this.image=c.getTileImage(d)},getObjectPropertyByName:function(a){return this[a]}})}(window),function(){var a=2147483648,b=1073741824,c=536870912;me.Tile=me.Rect.extend({tileId:null,tileset:null,init:function(d,e,f,g,h){this.parent(new me.Vector2d(d*f,e*g),f,g),this.col=d,this.row=e,this.tileId=h,this.flipX=0!==(this.tileId&a),this.flipY=0!==(this.tileId&b),this.flipAD=0!==(this.tileId&c),this.flipped=this.flipX||this.flipY||this.flipAD,this.tileId&=~(a|b|c)}}),me.TMXTileset=Object.extend({type:{SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",TOPLADDER:"topladder",BREAKABLE:"breakable"},init:function(){this.TileProperties=[],this.tileXOffset=[],this.tileYOffset=[]},initFromXML:function(a){this.firstgid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_FIRSTGID);var b=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_SOURCE);if(b){if(b=me.utils.getBasename(b),a=me.loader.getTMX(b),!a)throw"melonJS:"+b+" TSX tileset not found";me.mapReader.TMXParser.parseFromString(a),a=me.mapReader.TMXParser.getFirstElementByTagName("tileset")}this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME),this.tilewidth=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEWIDTH),this.tileheight=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEHEIGHT),this.spacing=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_SPACING,0),this.margin=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_MARGIN,0),this.tileoffset=new me.Vector2d(0,0);var c=a.getElementsByTagName(me.TMX_TAG_TILEOFFSET);c.length>0&&(this.tileoffset.x=me.mapReader.TMXParser.getIntAttribute(c[0],me.TMX_TAG_X),this.tileoffset.y=me.mapReader.TMXParser.getIntAttribute(c[0],me.TMX_TAG_Y));for(var d=a.getElementsByTagName(me.TMX_TAG_TILE),e=0;e<d.length;e++){var f=me.mapReader.TMXParser.getIntAttribute(d[e],me.TMX_TAG_ID)+this.firstgid,g={};me.TMXUtils.applyTMXPropertiesFromXML(g,d[e]),this.setTileProperty(f,g)}var h=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),i=h?me.loader.getImage(me.utils.getBasename(h)):null;i||console.log("melonJS: '"+h+"' file for tileset '"+this.name+"' not found!");var j=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_TRANS);this.initFromImage(i,j)},initFromJSON:function(a){this.firstgid=a[me.TMX_TAG_FIRSTGID];var b=a[me.TMX_TAG_SOURCE];if(b&&(b=me.utils.getBasename(b),a=me.loader.getTMX(b),!a))throw"melonJS:"+b+" TSX tileset not found";this.name=a[me.TMX_TAG_NAME],this.tilewidth=parseInt(a[me.TMX_TAG_TILEWIDTH],10),this.tileheight=parseInt(a[me.TMX_TAG_TILEHEIGHT],10),this.spacing=parseInt(a[me.TMX_TAG_SPACING]||0,10),this.margin=parseInt(a[me.TMX_TAG_MARGIN]||0,10),this.tileoffset=new me.Vector2d(0,0);var c=a[me.TMX_TAG_TILEOFFSET];c&&(this.tileoffset.x=parseInt(c[me.TMX_TAG_X],10),this.tileoffset.y=parseInt(c[me.TMX_TAG_Y],10));var d=a.tileproperties;for(var e in d){var f={};me.TMXUtils.mergeProperties(f,d[e]),this.setTileProperty(parseInt(e,10)+this.firstgid,f)}var g=me.utils.getBasename(a[me.TMX_TAG_IMAGE]),h=g?me.loader.getImage(g):null;h||console.log("melonJS: '"+g+"' file for tileset '"+this.name+"' not found!");var i=a[me.TMX_TAG_TRANS]||null;this.initFromImage(h,i)},initFromImage:function(a,b){a&&(this.image=a,this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))),this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0),null!==b&&this.image&&(this.image=me.video.applyRGBFilter(this.image,"transparent",b.toUpperCase()).canvas)},setTileProperty:function(a,b){b.isSolid=b.type?b.type.toLowerCase()===this.type.SOLID:!1,b.isPlatform=b.type?b.type.toLowerCase()===this.type.PLATFORM:!1,b.isLeftSlope=b.type?b.type.toLowerCase()===this.type.L_SLOPE:!1,b.isRightSlope=b.type?b.type.toLowerCase()===this.type.R_SLOPE:!1,b.isBreakable=b.type?b.type.toLowerCase()===this.type.BREAKABLE:!1,b.isLadder=b.type?b.type.toLowerCase()===this.type.LADDER:!1,b.isTopLadder=b.type?b.type.toLowerCase()===this.type.TOPLADDER:!1,b.isSlope=b.isLeftSlope||b.isRightSlope,b.isCollidable=!!b.type,this.TileProperties[a]=b},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getTileImage:function(a){var b=me.video.getContext2d(me.video.createCanvas(this.tilewidth,this.tileheight));return this.drawTile(b,0,0,a),b.canvas},getTileProperties:function(a){return this.TileProperties[a]},isTileCollidable:function(a){return this.TileProperties[a].isCollidable},getTileOffsetX:function(a){var b=this.tileXOffset[a];return"undefined"==typeof b&&(b=this.tileXOffset[a]=this.margin+(this.spacing+this.tilewidth)*(a%this.hTileCount)),b},getTileOffsetY:function(a){var b=this.tileYOffset[a];return"undefined"==typeof b&&(b=this.tileYOffset[a]=this.margin+(this.spacing+this.tileheight)*~~(a/this.hTileCount)),b},drawTile:function(a,b,c,d){if(d.flipped){var e=1,f=0,g=0,h=1,i=b,j=c;b=c=0,a.save(),d.flipAD&&(e=0,f=1,g=1,h=0,j+=this.tileheight-this.tilewidth),d.flipX&&(e=-e,g=-g,i+=d.flipAD?this.tileheight:this.tilewidth),d.flipY&&(f=-f,h=-h,j+=d.flipAD?this.tilewidth:this.tileheight),a.transform(e,f,g,h,i,j)}var k=d.tileId-this.firstgid;a.drawImage(this.image,this.getTileOffsetX(k),this.getTileOffsetY(k),this.tilewidth,this.tileheight,b,c,this.tilewidth,this.tileheight),d.flipped&&a.restore()}}),me.TMXTilesetGroup=Object.extend({init:function(){this.tilesets=[]},add:function(a){this.tilesets.push(a)},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){for(var b=-1,c=0,d=this.tilesets.length;d>c;c++){if(this.tilesets[c].contains(a))return this.tilesets[c];this.tilesets[c].firstgid===this.tilesets[c].lastgid&&a>=this.tilesets[c].firstgid&&(b=c)}if(-1!==b)return this.tilesets[b];throw"no matching tileset found for gid "+a}})}(window),function(){me.TMXOrthogonalRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d},canRender:function(a){return"orthogonal"===a.orientation&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){return new me.Vector2d(a/this.tilewidth,b/this.tileheight)},tileToPixelCoords:function(a,b){return new me.Vector2d(a*this.tilewidth,b*this.tileheight)},adjustPosition:function(a){"number"==typeof a.gid&&(a.y-=a.height)},drawTile:function(a,b,c,d,e){e.drawTile(a,e.tileoffset.x+b*this.tilewidth,e.tileoffset.y+(c+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,b,c){var d=this.pixelToTileCoords(c.pos.x,c.pos.y).floorSelf(),e=this.pixelToTileCoords(c.pos.x+c.width+this.tilewidth,c.pos.y+c.height+this.tileheight).ceilSelf();e.x=e.x>this.cols?this.cols:e.x,e.y=e.y>this.rows?this.rows:e.y;for(var f=d.y;f<e.y;f++)for(var g=d.x;g<e.x;g++){var h=b.layerData[g][f];h&&this.drawTile(a,g,f,h,h.tileset)}}}),me.TMXIsometricRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d,this.hTilewidth=c/2,this.hTileheight=d/2,this.originX=this.rows*this.hTilewidth},canRender:function(a){return"isometric"===a.orientation&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){a-=this.originX;var c=b/this.tileheight,d=a/this.tilewidth;return new me.Vector2d(c+d,c-d)},tileToPixelCoords:function(a,b){return new me.Vector2d((a-b)*this.hTilewidth+this.originX,(a+b)*this.hTileheight)},adjustPosition:function(a){var b=a.x/this.hTilewidth,c=a.y/this.tileheight,d=this.tileToPixelCoords(b,c);d.x-=a.width/2,d.y-=a.height,a.x=d.x,a.y=d.y},drawTile:function(a,b,c,d,e){e.drawTile(a,(this.cols-1)*e.tilewidth+(b-c)*e.tilewidth>>1,-e.tilewidth+(b+c)*e.tileheight>>2,d)},drawTileLayer:function(a,b,c){var d=b.tileset,e=d.tileoffset,f=this.pixelToTileCoords(c.pos.x-d.tilewidth,c.pos.y-d.tileheight).floorSelf(),g=this.pixelToTileCoords(c.pos.x+c.width+d.tilewidth,c.pos.y+c.height+d.tileheight).ceilSelf(),h=this.tileToPixelCoords(g.x,g.y),i=this.tileToPixelCoords(f.x,f.y);i.x-=this.hTilewidth,i.y+=this.tileheight;var j=i.y-c.pos.y>this.hTileheight,k=c.pos.x-i.x<this.hTilewidth;j&&(k?(f.x--,i.x-=this.hTilewidth):(f.y--,i.x+=this.hTilewidth),i.y-=this.hTileheight);for(var l=j^k,m=f.clone(),n=i.y;n-this.tileheight<h.y;n+=this.hTileheight){m.setV(f);for(var o=i.x;o<h.x;o+=this.tilewidth){if(m.x>=0&&m.y>=0&&m.x<this.cols&&m.y<this.rows){var p=b.layerData[m.x][m.y];p&&(d=p.tileset,e=d.tileoffset,d.drawTile(a,e.x+o,e.y+n-d.tileheight,p))}m.x++,m.y--}l?(f.y++,i.x-=this.hTilewidth,l=!1):(f.x++,i.x+=this.hTilewidth,l=!0)}}})}(window),function(){me.ColorLayer=me.Renderable.extend({init:function(a,b,c){this.parent(new me.Vector2d(0,0),1/0,1/0),this.name=a,this.color=me.utils.HexToRGB(b),this.z=c},reset:function(){},update:function(){return!1},draw:function(a,b){var c=a.globalAlpha;a.globalAlpha*=this.getOpacity(),a.fillStyle=this.color,a.fillRect(b.left,b.top,b.width,b.height),a.globalAlpha=c}}),me.ImageLayer=me.Renderable.extend({init:function(a,b,c,d,e,f){if(this.name=a,this.image=d?me.loader.getImage(me.utils.getBasename(d)):null,!this.image)throw"melonJS: '"+d+"' file for Image Layer '"+this.name+"' not found!";this.imagewidth=this.image.width,this.imageheight=this.image.height;var g=me.game.viewport;b=b?Math.min(g.width,b):g.width,c=c?Math.min(g.height,c):g.height,this.parent(new me.Vector2d(0,0),b,c),this.z=e,this.ratio=new me.Vector2d(1,1),f&&("number"==typeof f?this.ratio.set(f,f):this.ratio.setV(f)),this.lastpos=g.pos.clone(),this.floating=!0,this._repeat="repeat",this.repeatX=!0,this.repeatY=!0,Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){switch(this._repeat=a,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}}}),this.anchorPoint.set(0,0),this.handle=me.event.subscribe(me.event.VIEWPORT_ONCHANGE,this.updateLayer.bind(this))},reset:function(){this.handle&&(me.event.unsubscribe(this.handle),this.handle=null),this.image=null,this.lastpos=null},updateLayer:function(a){(0!==this.ratio.x||0!==this.ratio.y)&&(this.pos.x+=(a.x-this.lastpos.x)*this.ratio.x%this.imagewidth,this.pos.x=(this.imagewidth+this.pos.x)%this.imagewidth,this.pos.y+=(a.y-this.lastpos.y)*this.ratio.y%this.imageheight,this.pos.y=(this.imageheight+this.pos.y)%this.imageheight,this.lastpos.setV(a))},update:function(){return!1},draw:function(a,b){if(a.save(),0!==this.anchorPoint.y||0!==this.anchorPoint.x){var c=me.game.viewport;a.translate(~~(this.anchorPoint.x*(c.width-this.imagewidth)),~~(this.anchorPoint.y*(c.height-this.imageheight)))}a.globalAlpha*=this.getOpacity();var d,e;if(0===this.ratio.x&&0===this.ratio.y)d=Math.min(b.width,this.imagewidth),e=Math.min(b.height,this.imageheight),a.drawImage(this.image,b.left,b.top,d,e,b.left,b.top,d,e);else{var f=~~this.pos.x,g=~~this.pos.y,h=0,i=0;for(d=Math.min(this.imagewidth-f,this.width),e=Math.min(this.imageheight-g,this.height);;){do a.drawImage(this.image,f,g,d,e,h,i,d,e),g=0,i+=e,e=Math.min(this.imageheight,this.height-i);while(this.repeatY&&i<this.height);if(h+=d,!this.repeatX||h>=this.width)break;f=0,d=Math.min(this.imagewidth,this.width-h),g=~~this.pos.y,i=0,e=Math.min(this.imageheight-~~this.pos.y,this.height)}}a.restore()},destroy:function(){this.reset()}}),me.CollisionTiledLayer=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(0,0),a,b),this.isCollisionMap=!0},reset:function(){},checkCollision:function(a,b){var c=b.x<0?a.left+b.x:a.right+b.x,d=b.y<0?a.top+b.y:a.bottom+b.y,e={x:0,y:0,xprop:{},yprop:{}};return(0>=c||c>=this.width)&&(e.x=b.x),(0>=d||d>=this.height)&&(e.y=b.y),e}}),me.TMXLayer=me.Renderable.extend({layerData:null,init:function(a,b,c,d,e){this.parent(new me.Vector2d(0,0),0,0),this.tilewidth=a,this.tileheight=b,this.orientation=c,this.tilesets=d,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.z=e},initFromXML:function(a){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME),this.visible=1===me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_VISIBLE,1),this.cols=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH),this.rows=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT),this.setOpacity(me.mapReader.TMXParser.getFloatAttribute(a,me.TMX_TAG_OPACITY,1)),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,me.TMXUtils.applyTMXPropertiesFromXML(this,a),"undefined"==typeof this.preRender&&(this.preRender=me.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(me.COLLISION_LAYER),this.isCollisionMap&&!me.debug.renderCollisionMap&&(this.visible=!1),this.preRender===!0&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=me.video.getContext2d(this.layerCanvas))},initFromJSON:function(a){this.name=a[me.TMX_TAG_NAME],this.visible=a[me.TMX_TAG_VISIBLE],this.cols=parseInt(a[me.TMX_TAG_WIDTH],10),this.rows=parseInt(a[me.TMX_TAG_HEIGHT],10),this.setOpacity(parseFloat(a[me.TMX_TAG_OPACITY])),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,me.TMXUtils.applyTMXPropertiesFromJSON(this,a),"undefined"==typeof this.preRender&&(this.preRender=me.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(me.COLLISION_LAYER),this.isCollisionMap&&!me.debug.renderCollisionMap&&(this.visible=!1),this.preRender===!0&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=me.video.getContext2d(this.layerCanvas))},reset:function(){this.preRender&&(this.layerCanvas=null,this.layerSurface=null),this.renderer=null,this.layerData=null,this.tileset=null,this.tilesets=null},setRenderer:function(a){this.renderer=a},initArray:function(a,b){this.layerData=[];for(var c=0;a>c;c++){this.layerData[c]=[];for(var d=0;b>d;d++)this.layerData[c][d]=null}},getTileId:function(a,b){var c=this.getTile(a,b);return c?c.tileId:null},getTile:function(a,b){return this.layerData[~~(a/this.tilewidth)][~~(b/this.tileheight)]},setTile:function(a,b,c){var d=new me.Tile(a,b,this.tilewidth,this.tileheight,c);return d.tileset=this.tileset.contains(d.tileId)?this.tileset:this.tileset=this.tilesets.getTilesetByGid(d.tileId),this.layerData[a][b]=d,d},clearTile:function(a,b){this.layerData[a][b]=null,this.visible&&this.preRender&&this.layerSurface.clearRect(a*this.tilewidth,b*this.tileheight,this.tilewidth,this.tileheight)},checkCollision:function(a,b){var c=b.x<0?~~(a.left+b.x):Math.ceil(a.right-1+b.x),d=b.y<0?~~(a.top+b.y):Math.ceil(a.bottom-1+b.y),e={x:0,xtile:void 0,xprop:{},y:0,ytile:void 0,yprop:{}};return 0>=c||c>=this.width?e.x=b.x:0!==b.x&&(e.xtile=this.getTile(c,Math.ceil(a.bottom-1)),e.xtile&&this.tileset.isTileCollidable(e.xtile.tileId)?(e.x=b.x,e.xprop=this.tileset.getTileProperties(e.xtile.tileId)):(e.xtile=this.getTile(c,~~a.top),e.xtile&&this.tileset.isTileCollidable(e.xtile.tileId)&&(e.x=b.x,e.xprop=this.tileset.getTileProperties(e.xtile.tileId)))),e.ytile=this.getTile(b.x<0?~~a.left:Math.ceil(a.right-1),d),e.ytile&&this.tileset.isTileCollidable(e.ytile.tileId)?(e.y=b.y||1,e.yprop=this.tileset.getTileProperties(e.ytile.tileId)):(e.ytile=this.getTile(b.x<0?Math.ceil(a.right-1):~~a.left,d),e.ytile&&this.tileset.isTileCollidable(e.ytile.tileId)&&(e.y=b.y||1,e.yprop=this.tileset.getTileProperties(e.ytile.tileId))),e},update:function(){return!1},draw:function(a,b){if(this.preRender){var c=Math.min(b.width,this.width),d=Math.min(b.height,this.height);this.layerSurface.globalAlpha=a.globalAlpha*this.getOpacity(),a.drawImage(this.layerCanvas,b.pos.x,b.pos.y,c,d,b.pos.x,b.pos.y,c,d)}else{var e=a.globalAlpha;a.globalAlpha*=this.getOpacity(),this.renderer.drawTileLayer(a,this,b),a.globalAlpha=e}}})}(window),function(){me.TMXTileMap=me.Renderable.extend({init:function(a){this.levelId=a,this.z=0,this.name=null,this.cols=0,this.rows=0,this.tilewidth=0,this.tileheight=0,this.tilesets=null,this.mapLayers=[],this.objectGroups=[],this.initialized=!1,this.version="",this.orientation="",this.tilesets=null,this.parent(new me.Vector2d,0,0)},reset:function(){if(this.initialized===!0){var a;for(a=this.mapLayers.length;a--;)this.mapLayers[a].reset(),this.mapLayers[a]=null;for(a=this.objectGroups.length;a--;)this.objectGroups[a].reset(),this.objectGroups[a]=null;this.tilesets=null,this.mapLayers.length=0,this.objectGroups.length=0,this.pos.set(0,0),this.initialized=!1}},getObjectGroupByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.objectGroups.length;c--;)if(this.objectGroups[c].name.toLowerCase().contains(a)){b=this.objectGroups[c];break}return b},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.mapLayers.length;c--;)if(this.mapLayers[c].name.toLowerCase().contains(a)){b=this.mapLayers[c];break}return a.toLowerCase().contains(me.COLLISION_LAYER)&&null==b&&(b=new me.CollisionTiledLayer(me.game.currentLevel.width,me.game.currentLevel.height)),b},clearTile:function(a,b){for(var c=this.mapLayers.length;c--;)this.mapLayers[c]instanceof me.TMXLayer&&this.mapLayers[c].clearTile(a,b)}})}(window),function(){function a(){var a={tmxDoc:null,setData:function(a){this.tmxDoc=a},getFirstElementByTagName:function(a){return this.tmxDoc?this.tmxDoc.getElementsByTagName(a)[0]:null},getAllTagElements:function(){return this.tmxDoc?this.tmxDoc.getElementsByTagName("*"):null},getStringAttribute:function(a,b,c){var d=a.getAttribute(b);return d?d.trim():c},getIntAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?parseInt(d,10):c},getFloatAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?parseFloat(d):c},getBooleanAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?"true"===d:c},free:function(){this.tmxDoc=null}};return a}me.TMXMapReader=Object.extend({XMLReader:null,JSONReader:null,TMXParser:null,readMap:function(a){if(!a.initialized){if("xml"===me.loader.getTMXFormat(a.levelId)?(null===this.XMLReader&&(this.XMLReader=new b),this.TMXParser=this.XMLReader.TMXParser,this.XMLReader.readXMLMap(a,me.loader.getTMX(a.levelId))):(null===this.JSONReader&&(this.JSONReader=new c),this.JSONReader.readJSONMap(a,me.loader.getTMX(a.levelId))),a.width<me.game.viewport.width||a.height<me.game.viewport.height){var d=~~((me.game.viewport.width-a.width)/2),e=~~((me.game.viewport.height-a.height)/2);a.pos.add({x:d>0?d:0,y:e>0?e:0})}a.initialized=!0}},getNewDefaultRenderer:function(a){switch(a.orientation){case"orthogonal":return new me.TMXOrthogonalRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);
case"isometric":return new me.TMXIsometricRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);default:throw"melonJS: "+a.orientation+" type TMX Tile Map not supported!"}},setLayerData:function(a,b,c,d){switch(a.initArray(a.cols,a.rows),c){case null:b=b.getElementsByTagName(me.TMX_TAG_TILE);break;case"json":break;case me.TMX_TAG_CSV:case me.TMX_TAG_ATTR_BASE64:for(var e="",f=0,g=b.childNodes.length;g>f;f++)e+=b.childNodes[f].nodeValue;c===me.TMX_TAG_CSV?b=me.utils.decodeCSV(e,a.cols):(b=me.utils.decodeBase64AsArray(e,4),null!==d&&(b=me.utils.decompress(b,d))),e=null;break;default:throw"melonJS: TMX Tile Map "+c+" encoding not supported!"}for(var h=0,i=0;i<a.rows;i++)for(var j=0;j<a.cols;j++){var k=null==c?this.TMXParser.getIntAttribute(b[h++],me.TMX_TAG_GID):b[h++];if(0!==k){var l=a.setTile(j,i,k);a.visible&&a.preRender&&a.renderer.drawTile(a.layerSurface,j,i,l,l.tileset)}}}});var b=me.TMXMapReader.extend({TMXParser:null,init:function(){this.TMXParser||(this.TMXParser=new a)},readXMLMap:function(a,b){if(!b)throw"melonJS:"+a.levelId+" TMX map not found";var c=0;this.TMXParser.setData(b);for(var d=this.TMXParser.getAllTagElements(),e=0;e<d.length;e++)switch(d.item(e).nodeName){case me.TMX_TAG_MAP:var f=d.item(e);a.version=this.TMXParser.getStringAttribute(f,me.TMX_TAG_VERSION),a.orientation=this.TMXParser.getStringAttribute(f,me.TMX_TAG_ORIENTATION),a.cols=this.TMXParser.getIntAttribute(f,me.TMX_TAG_WIDTH),a.rows=this.TMXParser.getIntAttribute(f,me.TMX_TAG_HEIGHT),a.tilewidth=this.TMXParser.getIntAttribute(f,me.TMX_TAG_TILEWIDTH),a.tileheight=this.TMXParser.getIntAttribute(f,me.TMX_TAG_TILEHEIGHT),a.width=a.cols*a.tilewidth,a.height=a.rows*a.tileheight,a.backgroundcolor=this.TMXParser.getStringAttribute(f,me.TMX_BACKGROUND_COLOR),a.z=c++,me.TMXUtils.applyTMXPropertiesFromXML(a,f),a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color,a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",a.background_color,c++)),a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,c++)),null!==me.game.renderer&&me.game.renderer.canRender(a)||(me.game.renderer=this.getNewDefaultRenderer(a));break;case me.TMX_TAG_TILESET:a.tilesets||(a.tilesets=new me.TMXTilesetGroup),a.tilesets.add(this.readTileset(d.item(e)));break;case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(this.readImageLayer(a,d.item(e),c++));break;case me.TMX_TAG_LAYER:a.mapLayers.push(this.readLayer(a,d.item(e),c++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(this.readObjectGroup(a,d.item(e),c++))}this.TMXParser.free()},readLayer:function(a,b,c){var d=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);d.initFromXML(b);var e=b.getElementsByTagName(me.TMX_TAG_DATA)[0],f=this.TMXParser.getStringAttribute(e,me.TMX_TAG_ENCODING,null),g=this.TMXParser.getStringAttribute(e,me.TMX_TAG_COMPRESSION,null);return""===f&&(f=null),""===g&&(g=null),(!d.isCollisionMap||me.debug.renderCollisionMap)&&d.setRenderer(me.game.renderer.canRender(d)?me.game.renderer:me.mapReader.getNewDefaultRenderer(d)),this.setLayerData(d,e,f,g),e=null,d},readImageLayer:function(a,b,c){var d=this.TMXParser.getStringAttribute(b,me.TMX_TAG_NAME),e=this.TMXParser.getIntAttribute(b,me.TMX_TAG_WIDTH),f=this.TMXParser.getIntAttribute(b,me.TMX_TAG_HEIGHT),g=b.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),h=new me.ImageLayer(d,e*a.tilewidth,f*a.tileheight,g,c);return h.visible=1===this.TMXParser.getIntAttribute(b,me.TMX_TAG_VISIBLE,1),h.setOpacity(this.TMXParser.getFloatAttribute(b,me.TMX_TAG_OPACITY,1)),me.TMXUtils.applyTMXPropertiesFromXML(h,b),"number"==typeof h.ratio&&(h.ratio=new me.Vector2d(parseFloat(h.ratio),parseFloat(h.ratio))),h},readTileset:function(a){var b=new me.TMXTileset;return b.initFromXML(a),b},readObjectGroup:function(a,b,c){var d=this.TMXParser.getStringAttribute(b,me.TMX_TAG_NAME),e=new me.TMXObjectGroup;return e.initFromXML(d,b,a.tilesets,c),e}}),c=me.TMXMapReader.extend({readJSONMap:function(a,b){if(!b)throw"melonJS:"+a.levelId+" TMX map not found";var c=0,d=this;a.version=b[me.TMX_TAG_VERSION],a.orientation=b[me.TMX_TAG_ORIENTATION],a.cols=parseInt(b[me.TMX_TAG_WIDTH],10),a.rows=parseInt(b[me.TMX_TAG_HEIGHT],10),a.tilewidth=parseInt(b[me.TMX_TAG_TILEWIDTH],10),a.tileheight=parseInt(b[me.TMX_TAG_TILEHEIGHT],10),a.width=a.cols*a.tilewidth,a.height=a.rows*a.tileheight,a.backgroundcolor=b[me.TMX_BACKGROUND_COLOR],a.z=c++,me.TMXUtils.applyTMXPropertiesFromJSON(a,b),a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color,a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",a.background_color,c++)),a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,c++)),null!==me.game.renderer&&me.game.renderer.canRender(a)||(me.game.renderer=this.getNewDefaultRenderer(a)),a.tilesets||(a.tilesets=new me.TMXTilesetGroup),b.tilesets.forEach(function(b){a.tilesets.add(d.readTileset(b))}),b.layers.forEach(function(b){switch(b.type){case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(d.readImageLayer(a,b,c++));break;case me.TMX_TAG_TILE_LAYER:a.mapLayers.push(d.readLayer(a,b,c++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(d.readObjectGroup(a,b,c++))}})},readLayer:function(a,b,c){var d=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);return d.initFromJSON(b),d.isCollisionMap||d.setRenderer(me.game.renderer.canRender(d)?me.game.renderer:me.mapReader.getNewDefaultRenderer(d)),this.setLayerData(d,b[me.TMX_TAG_DATA],"json",null),d},readImageLayer:function(a,b,c){var d=b[me.TMX_TAG_NAME],e=parseInt(b[me.TMX_TAG_WIDTH],10),f=parseInt(b[me.TMX_TAG_HEIGHT],10),g=b[me.TMX_TAG_IMAGE],h=new me.ImageLayer(d,e*a.tilewidth,f*a.tileheight,g,c);return h.visible=b[me.TMX_TAG_VISIBLE],h.setOpacity(parseFloat(b[me.TMX_TAG_OPACITY])),me.TMXUtils.applyTMXPropertiesFromJSON(h,b),"number"==typeof h.ratio&&(h.ratio=new me.Vector2d(parseFloat(h.ratio),parseFloat(h.ratio))),h},readTileset:function(a){var b=new me.TMXTileset;return b.initFromJSON(a),b},readObjectGroup:function(a,b,c){var d=new me.TMXObjectGroup;return d.initFromJSON(b[me.TMX_TAG_NAME],b,a.tilesets,c),d}})}(window),function(){me.levelDirector=function(){var a={},b={},c=[],d=0;return a.reset=function(){},a.addLevel=function(){throw"melonJS: no level loader defined"},a.addTMXLevel=function(a,d){return null!=b[a]?!1:(b[a]=new me.TMXTileMap(a),b[a].name=a,c.push(a),d&&d(),!0)},a.loadLevel=function(e){if(e=e.toString().toLowerCase(),void 0===b[e])throw"melonJS: level "+e+" not found";if(!(b[e]instanceof me.TMXTileMap))throw"melonJS: no level loader defined";var f=me.state.isRunning();return f&&me.state.stop(),me.game.reset(),me.utils.resetGUID(e),b[a.getCurrentLevelId()]&&b[a.getCurrentLevelId()].reset(),me.mapReader.readMap(b[e]),d=c.indexOf(e),me.game.loadTMXLevel(b[e]),f&&me.state.restart.defer(),!0},a.getCurrentLevelId=function(){return c[d]},a.reloadLevel=function(){return a.loadLevel(a.getCurrentLevelId())},a.nextLevel=function(){return d+1<c.length?a.loadLevel(c[d+1]):!1},a.previousLevel=function(){return d-1>=0?a.loadLevel(c[d-1]):!1},a.levelCount=function(){return c.length},a}()}(window),function(){me.Tween=function(a){var b=a,c={},d={},e={},f=1e3,g=0,h=!1,i=!1,j=0,k=null,l=0,m=me.Tween.Easing.Linear.None,n=me.Tween.Interpolation.Linear,o=[],p=null,q=!1,r=null,s=null;for(var t in a)c[t]=parseFloat(a[t],10);this.onResetEvent=function(a){b=a,c={},d={},e={},m=me.Tween.Easing.Linear.None,n=me.Tween.Interpolation.Linear,h=!1,i=!1,f=1e3,j=0,p=null,q=!1,r=null,s=null},this.to=function(a,b){return void 0!==b&&(f=b),d=a,this},this.start=function(){q=!1,me.game.world.addChild(this),k=me.timer.getTime()+j,l=0;for(var a in d){if(d[a]instanceof Array){if(0===d[a].length)continue;d[a]=[b[a]].concat(d[a])}c[a]=b[a],c[a]instanceof Array==!1&&(c[a]*=1),e[a]=c[a]||0}return this},this.stop=function(){return me.game.world.removeChild(this),this},this.delay=function(a){return j=a,this},me.event.subscribe(me.event.STATE_PAUSE,function(){k&&(l=me.timer.getTime())}),me.event.subscribe(me.event.STATE_RESUME,function(){k&&l&&(k+=me.timer.getTime()-l)}),this.repeat=function(a){return g=a,this},this.yoyo=function(a){return h=a,this},this.easing=function(a){if("function"!=typeof a)throw"melonJS: invalid easing function for me.Tween.easing()";return m=a,this},this.interpolation=function(a){return n=a,this},this.chain=function(){return o=arguments,this},this.onStart=function(a){return p=a,this},this.onUpdate=function(a){return r=a,this},this.onComplete=function(a){return s=a,this},this.update=function(){var a,l=me.timer.getTime();if(k>l)return!0;q===!1&&(null!==p&&p.call(b),q=!0);var t=(l-k)/f;t=t>1?1:t;var u=m(t);for(a in d){var v=c[a]||0,w=d[a];w instanceof Array?b[a]=n(w,u):("string"==typeof w&&(w=v+parseFloat(w,10)),"number"==typeof w&&(b[a]=v+(w-v)*u))}if(null!==r&&r.call(b,u),1===t){if(g>0){isFinite(g)&&g--;for(a in e){if("string"==typeof d[a]&&(e[a]=e[a]+parseFloat(d[a],10)),h){var x=e[a];e[a]=d[a],d[a]=x,i=!i}c[a]=e[a]}return k=l+j,!0}me.game.world.removeChild(this),null!==s&&s.call(b);for(var y=0,z=o.length;z>y;y++)o[y].start(l);return!1}return!0}},me.Tween.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-me.Tween.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*me.Tween.Easing.Bounce.In(2*a):.5*me.Tween.Easing.Bounce.Out(2*a-1)+.5}}},me.Tween.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=me.Tween.Interpolation.Utils.Linear;return 0>b?f(a[0],a[1],d):b>1?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)},Bezier:function(a,b){var c,d=0,e=a.length-1,f=Math.pow,g=me.Tween.Interpolation.Utils.Bernstein;for(c=0;e>=c;c++)d+=f(1-b,e-c)*f(b,c)*a[c]*g(e,c);return d},CatmullRom:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=me.Tween.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=me.Tween.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}}}}(),function(){me.event=function(){var a={},b={};return a.STATE_PAUSE="me.state.onPause",a.STATE_RESUME="me.state.onResume",a.STATE_STOP="me.state.onStop",a.STATE_RESTART="me.state.onRestart",a.GAME_INIT="me.game.onInit",a.LEVEL_LOADED="me.game.onLevelLoaded",a.LOADER_COMPLETE="me.loader.onload",a.LOADER_PROGRESS="me.loader.onProgress",a.KEYDOWN="me.input.keydown",a.KEYUP="me.input.keyup",a.WINDOW_ONRESIZE="window.onresize",a.WINDOW_ONORIENTATION_CHANGE="window.orientationchange",a.WINDOW_ONSCROLL="window.onscroll",a.VIEWPORT_ONCHANGE="viewport.onchange",a.publish=function(a,c){for(var d=b[a],e=d?d.length:0;e--;)d[e].apply(window,c||[])},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(a,c){var d=b[c?a:a[0]],e=d?d.length:0;for(c=c||a[1];e--;)d[e]===c&&d.splice(e,1)},a}()}(),function(){me.plugin=function(){var a={};return a.Base=Object.extend({version:void 0,init:function(){}}),a.patch=function(a,b,c){if(void 0!==a.prototype&&(a=a.prototype),"function"==typeof a[b]){var d=a[b];a[b]=function(a,b){return function(){var a=this.parent;this.parent=d;var c=b.apply(this,arguments);return this.parent=a,c}}(b,c)}else console.error(b+" is not an existing function")},a.register=function(a,b){if(me.plugin[b]&&console.error("plugin "+b+" already registered"),void 0===a.prototype.version)throw"melonJS: Plugin version not defined !";if(me.sys.checkVersion(a.prototype.version)>0)throw"melonJS: Plugin version mismatch, expected: "+a.prototype.version+", got: "+me.version;var c=[];if(arguments.length>2&&(c=Array.prototype.slice.call(arguments,1)),c[0]=a,me.plugin[b]=new(a.bind.apply(a,c)),!(me.plugin[b]instanceof me.plugin.Base))throw"melonJS: Plugin should extend the me.plugin.Base Class !"},a}()}(),function(){me.debug=me.debug||{},debugPanel=me.plugin.Base.extend({GUID:null,area:{},rect:null,z:1/0,visible:!1,version:"0.9.9",init:function(a,b){this.parent(),this.rect=new me.Rect(new me.Vector2d(0,0),me.video.getWidth(),35),this.GUID="debug-"+me.utils.createGUID(),this.name="me.debugPanel",this.isPersistent=!0,this.floating=!0,this.isRenderable=!0,this.alwaysUpdate=!0,this.font=new me.Font("courier",10,"white"),this.area.renderHitBox=new me.Rect(new me.Vector2d(160,5),15,15),this.area.renderVelocity=new me.Rect(new me.Vector2d(165,18),15,15),this.area.renderDirty=new me.Rect(new me.Vector2d(270,5),15,15),this.area.renderCollisionMap=new me.Rect(new me.Vector2d(270,18),15,15),this.help_str="(s)how/(h)ide",this.help_str_len=this.font.measureText(me.video.getSystemContext(),this.help_str).width,this.fps_str_len=this.font.measureText(me.video.getSystemContext(),"00/00 fps").width,me.debug.displayFPS=!0,me.input.bindKey(a||me.input.KEY.S,"show"),me.input.bindKey(b||me.input.KEY.H,"hide"),this.samples=[],this.patchSystemFn(),this.show()},patchSystemFn:function(){me.debug.renderHitBox=me.debug.renderHitBox||!1,me.debug.renderVelocity=me.debug.renderVelocity||!1,me.plugin.patch(me.timer,"update",function(){this.parent(),me.timer.countFPS()}),me.plugin.patch(me.SpriteObject,"draw",function(a){this.parent(a),me.debug.renderHitBox&&(a.strokeStyle="green",a.strokeRect(this.left,this.top,this.width,this.height))}),me.plugin.patch(me.ObjectEntity,"draw",function(a){if(this.parent(a),me.debug.renderHitBox&&this.shapes.length&&(this.collisionBox.draw(a,"red"),"Rectangle"!==this.shapes[0].shapeType&&(a.translate(this.pos.x,this.pos.y),this.shapes[0].draw(a,"red"),a.translate(-this.pos.x,-this.pos.y))),me.debug.renderVelocity){var b=~~(this.pos.x+this.hWidth),c=~~(this.pos.y+this.hHeight);a.strokeStyle="blue",a.lineWidth=1,a.beginPath(),a.moveTo(b,c),a.lineTo(b+~~(this.vel.x*this.hWidth),c+~~(this.vel.y*this.hHeight)),a.stroke()}})},show:function(){this.visible||(me.game.getEntityByName("me.debugPanel")[0]||(me.game.add(this,this.z),me.game.sort()),me.input.registerPointerEvent("mousedown",this.rect,this.onClick.bind(this),!0),this.visible=!0,me.game.repaint())},hide:function(){this.visible&&(me.input.releasePointerEvent("mousedown",this.rect),this.visible=!1,me.game.repaint())},update:function(){return me.input.isKeyPressed("show")?this.show():me.input.isKeyPressed("hide")&&this.hide(),!0},getRect:function(){return this.rect},onClick:function(a){this.area.renderHitBox.containsPoint(a.gameX,a.gameY)?me.debug.renderHitBox=!me.debug.renderHitBox:this.area.renderCollisionMap.containsPoint(a.gameX,a.gameY)?me.debug.renderCollisionMap=!me.debug.renderCollisionMap:this.area.renderVelocity.containsPoint(a.gameX,a.gameY)&&(me.debug.renderVelocity=!me.debug.renderVelocity),me.game.repaint()},drawMemoryGraph:function(a,b,c){if(window.performance&&window.performance.memory){var d=Number.prototype.round(window.performance.memory.usedJSHeapSize/1048576,2),e=Number.prototype.round(window.performance.memory.totalJSHeapSize/1048576,2),f=c-b;this.samples.shift(),this.samples[f]=d/e*25;for(var g=f;g--;){var h=c-(f-g);a.beginPath(),a.strokeStyle="lightgreen",a.moveTo(h,30),a.lineTo(h,30-(this.samples[g]||0)),a.stroke()}this.font.draw(a,d+"/"+e+" MB",b,18)}else this.font.draw(a,"??/?? MB",b,18)},draw:function(a){a.save(),a.globalAlpha=.5,a.fillStyle="black",a.fillRect(this.rect.left,this.rect.top,this.rect.width,this.rect.height),a.globalAlpha=1,this.font.draw(a,"#objects : "+me.game.world.children.length,5,5),this.font.draw(a,"#draws   : "+me.game.world.drawCount,5,18),this.font.draw(a,"?hitbox   ["+(me.debug.renderHitBox?"x":" ")+"]",100,5),this.font.draw(a,"?velocity ["+(me.debug.renderVelocity?"x":" ")+"]",100,18),this.font.draw(a,"?dirtyRect  [ ]",200,5),this.font.draw(a,"?col. layer ["+(me.debug.renderCollisionMap?"x":" ")+"]",200,18),this.drawMemoryGraph(a,300,this.rect.width-this.help_str_len-5),this.font.draw(a,this.help_str,this.rect.width-this.help_str_len-5,18);var b=""+me.timer.fps+"/"+me.sys.fps+" fps";this.font.draw(a,b,this.rect.width-this.fps_str_len-5,5),a.restore()},onDestroyEvent:function(){this.hide(),me.input.unbindKey(me.input.KEY.S),me.input.unbindKey(me.input.KEY.H)}})}(window);var game={data:{showDialogs:!0,showIntros:!0,inputObserver:new InputObserver,playerLives:99,playerScore:0,playerHealth:4,isPaused:!1,sugarShotOnScreen:!1,isPlayerDead:!1,isBossDead:!1,frameCount:0,stageWidth:0,stageHeight:0,checkpoint:1,MAX_DIALOG_FRAMES:30,dialogFrames:0,PLAYER_INVINCIBLE_FRAMES:120,PLAYER_TYPE:100,SUGARSHOT_TYPE:101,PLATFROM_TYPE:102,SOLID_TYPE:103,DEATH_TYPE:104,WARP_TYPE:105,MORE_ENERGY_TYPE:106,STARTSNIPE_TYPE:200,STOPSNIPE_TYPE:201,WATER_TYPE:301,ROTATELEFT_TYPE:302,ROTATERIGHT_TYPE:303},screen_data:{INTRO:100,TITLE:101,CONFIG:102,GAME_COMPLETE:103},level_data:{STAGE1_MOVIE:1,STAGE1:2,STAGE1_PT2:3,STAGE1_PT3:4,STAGE2_MOVIE:5,STAGE2_PT1:6,STAGE2_PT2:7,STAGE2_PT3:8,STAGE3_MOVIE:9,STAGE3_PT1:10},stage1_data:{snipingStarted:!1,snipingComplete:!1,dialogShown:!1},onload:function(){return me.video.init("screen",640,480,!0,"auto")?("#debug"===document.location.hash&&window.onReady(function(){me.plugin.register.defer(debugPanel,"debug")}),me.audio.init("ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(game.resources),void me.state.change(me.state.LOADING)):void alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.state.set(game.screen_data.INTRO,new game.IntroScreen),me.state.set(game.screen_data.TITLE,new game.TitleScreen),me.state.set(game.screen_data.CONFIG,new game.ConfigScreen),me.state.set(game.level_data.STAGE1_MOVIE,new game.Stage1Movie),me.state.set(game.level_data.STAGE1,new game.Stage1),me.state.set(game.level_data.STAGE1_PT2,new game.Stage1pt2),me.state.set(game.level_data.STAGE1_PT3,new game.Stage1pt3),me.state.set(game.level_data.STAGE2_MOVIE,new game.Stage2Movie),me.state.set(game.level_data.STAGE2_PT1,new game.Stage2pt1),me.state.set(game.level_data.STAGE2_PT2,new game.Stage2pt2),me.state.set(game.level_data.STAGE2_PT3,new game.Stage2pt3),me.state.set(game.screen_data.GAME_COMPLETE,new game.GameCompleteScreen),me.state.set(game.level_data.STAGE3_MOVIE,new game.Stage3Movie),me.state.set(game.level_data.STAGE3_PT1,new game.Stage3pt1),me.entityPool.add("player",game.PlayerEntity),me.entityPool.add("more-energy-item",game.MoreEnergyEntity),me.entityPool.add("royal-jelly-item",game.RoyalJellyEntity),me.entityPool.add("desert-knight-enemy",game.DesertKnightEnemy),me.entityPool.add("peashooter-enemy",game.PeaShooterEnemy),me.entityPool.add("desert-spike-trap",game.DesertSpikeTrap),me.entityPool.add("flame-shooter-enemy",game.FlameShooterEnemy),me.entityPool.add("warp-tile",game.WarpTile),me.entityPool.add("start-snipe",game.StartSnipeEvent),me.entityPool.add("stop-snipe",game.StopSnipeEvent),me.entityPool.add("rotary-cannon-enemy",game.RotaryCannonEnemy),me.entityPool.add("sand-shark-enemy",game.SandSharkEnemy),me.entityPool.add("sniper-scope-enemy",game.SniperScopeEnemy),me.entityPool.add("elevator",game.Elevator),me.entityPool.add("lantern-entity",game.LanternEntity),me.entityPool.add("ceiling-lamp-entity",game.CeilingLampEntity),me.entityPool.add("vesperado-shadow-entity",game.VesperadoShadowEntity),me.entityPool.add("vesperado-enemy",game.VesperadoEnemy),me.entityPool.add("rotate-left",game.RotateLeftEvent),me.entityPool.add("rotate-right",game.RotateRightEvent),me.entityPool.add("water-event",game.WaterEvent),me.entityPool.add("raft",game.RaftEntity),me.entityPool.add("waterfall",game.WaterfallEntity),me.entityPool.add("waterfall-base",game.WaterfallBaseEntity),me.entityPool.add("parrot",game.ParrotEnemy),me.entityPool.add("popout-fish",game.PopoutFishEnemy),me.entityPool.add("pixie",game.PixieEnemy),me.entityPool.add("ninja-cat",game.NinjaCatEnemy),me.input.bindKey(me.input.KEY.DOWN,"down"),me.input.bindKey(me.input.KEY.UP,"up"),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.X,"jump",!0),me.input.bindKey(me.input.KEY.Z,"pause"),me.input.bindKey(me.input.KEY.C,"shoot"),me.state.change(game.screen_data.INTRO)}};game.resources=[{name:"player-spritesheet",type:"image",src:"data/img/player/player-spritesheet.png"},{name:"sugar-shot",type:"image",src:"data/img/player/sugar-shot-spritesheet.png"},{name:"event-alert",type:"image",src:"data/img/player/event-alert.png"},{name:"sugar-shot-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"jump-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"freeze-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"hit-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"event-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"hud",type:"image",src:"data/img/hud/hud.png"},{name:"health-meter-1",type:"image",src:"data/img/hud/health-meter-1.png"},{name:"health-meter-2",type:"image",src:"data/img/hud/health-meter-2.png"},{name:"health-meter-3",type:"image",src:"data/img/hud/health-meter-3.png"},{name:"health-meter-4",type:"image",src:"data/img/hud/health-meter-4.png"},{name:"metatiles32x32",type:"image",src:"data/img/stage/stage-metatiles/metatiles32x32.png"},{name:"more-energy-spritesheet",type:"image",src:"data/img/collectibles/more-energy-spritesheet.png"},{name:"royal-jelly-spritesheet",type:"image",src:"data/img/collectibles/royal-jelly-spritesheet.png"},{name:"pause",type:"image",src:"data/img/hud/pause.png"},{name:"title-1",type:"image",src:"data/img/screens/title-1.png"},{name:"title-2",type:"image",src:"data/img/screens/title-2.png"},{name:"title-screen",type:"audio",src:"data/music/all/",channel:1},{name:"title-cursor",type:"image",src:"data/img/screens/title-cursor.png"},{name:"title-name",type:"image",src:"data/img/screens/title-name.png"},{name:"game-complete-screen",type:"image",src:"data/img/screens/game-complete.png"},{name:"intro",type:"audio",src:"data/music/all/",channel:1},{name:"logo",type:"image",src:"data/img/screens/logo.png"},{name:"game-start",type:"audio",src:"data/sfx/all/",channel:2},{name:"select-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"more-health-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"royal-jelly-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"death-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"pause-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"boss",type:"audio",src:"data/music/all/",channel:1},{name:"boss-hurt-sfx",type:"audio",src:"data/sfx/all/",channel:2},{name:"movie",type:"audio",src:"data/music/all/",channel:1},{name:"stage-1-cutscene-1",type:"image",src:"data/img/stage/stage-1/intro/scene-1.png"},{name:"stage-1-cutscene-2",type:"image",src:"data/img/stage/stage-1/intro/scene-2.png"},{name:"stage-1-cutscene-3",type:"image",src:"data/img/stage/stage-1/intro/scene-3.png"},{name:"stage-1-cutscene-4",type:"image",src:"data/img/stage/stage-1/intro/scene-4.png"},{name:"stage-1-bg",type:"audio",src:"data/music/stage-1/",channel:1},{name:"stage-2-bg",type:"audio",src:"data/music/stage-2/",channel:1},{name:"stage-3-bg",type:"audio",src:"data/music/stage-3/",channel:1},{name:"desert-tilesheet",type:"image",src:"data/img/stage/stage-1/tiles/desert-tilesheet.png"},{name:"sunset-1",type:"image",src:"data/img/stage/stage-1/tiles/sunset-1.png"},{name:"rooftop-scene",type:"image",src:"data/img/stage/stage-1/tiles/rooftop-scene.png"},{name:"oilbg-1",type:"image",src:"data/img/stage/stage-1/tiles/oilbg-1.png"},{name:"oilbg-2",type:"image",src:"data/img/stage/stage-1/tiles/oilbg-2.png"},{name:"oilbg-3",type:"image",src:"data/img/stage/stage-1/tiles/oilbg-3.png"},{name:"desert",type:"tmx",src:"data/img/stage/stage-1.tmx"},{name:"desert2",type:"tmx",src:"data/img/stage/stage-1-2.tmx"},{name:"desert3",type:"tmx",src:"data/img/stage/stage-1-3.tmx"},{name:"thankyou",type:"image",src:"data/img/screens/game-complete.png"},{name:"peashooter-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/peashooter-spritesheet.png"},{name:"pea-shot",type:"image",src:"data/img/stage/stage-1/enemies/pea-shot.png"},{name:"pea-shot-sfx",type:"audio",src:"data/sfx/stage-1/",channel:2},{name:"desert-knight-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/desert-knight-spritesheet.png"},{name:"desert-spike-trap",type:"image",src:"data/img/stage/stage-1/enemies/desert-spike-trap.png"},{name:"flame-shooter-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/flame-shooter-spritesheet.png"},{name:"flame-shot-1",type:"image",src:"data/img/stage/stage-1/enemies/flame-shot-1.png"},{name:"flame-shot-2",type:"image",src:"data/img/stage/stage-1/enemies/flame-shot-2.png"},{name:"flame-shot-sfx",type:"audio",src:"data/sfx/stage-1/",channel:2},{name:"rotary-cannon-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/rotary-cannon-spritesheet.png"},{name:"rotary-cannon-bullet",type:"image",src:"data/img/stage/stage-1/enemies/rotary-cannon-bullet.png"},{name:"sand-shark-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/sand-shark-spritesheet.png"},{name:"sniper-scope-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/sniper-scope-spritesheet.png"},{name:"sniper-shot-sfx",type:"audio",src:"data/sfx/stage-1/",channel:2},{name:"elevator",type:"image",src:"data/img/stage/stage-1/tiles/elevator.png"},{name:"vesperado-shadow-spritesheet",type:"image",src:"data/img/stage/stage-1/entities/vesperado-shadow-spritesheet.png"},{name:"lantern-spritesheet",type:"image",src:"data/img/stage/stage-1/entities/lantern-spritesheet.png"},{name:"ceiling-lamp-spritesheet",type:"image",src:"data/img/stage/stage-1/entities/ceiling-lamp-spritesheet.png"},{name:"vesperado-spritesheet",type:"image",src:"data/img/stage/stage-1/enemies/vesperado-spritesheet.png"},{name:"vesperado-bullet",type:"image",src:"data/img/stage/stage-1/enemies/vesperado-bullet.png"},{name:"stage-2-cutscene-1",type:"image",src:"data/img/stage/stage-2/intro/scene-1.png"},{name:"stage-2-cutscene-2",type:"image",src:"data/img/stage/stage-2/intro/scene-2.png"},{name:"stage-2-cutscene-3",type:"image",src:"data/img/stage/stage-2/intro/scene-3.png"},{name:"stage-2-cutscene-4",type:"image",src:"data/img/stage/stage-2/intro/scene-4.png"},{name:"raft",type:"image",src:"data/img/stage/stage-2/elements/raft.png"},{name:"jungle-tilesheet",type:"image",src:"data/img/stage/stage-2/tiles/jungle-tilesheet.png"},{name:"junglebg-1",type:"image",src:"data/img/stage/stage-2/tiles/junglebg-1.png"},{name:"junglebg-2",type:"image",src:"data/img/stage/stage-2/tiles/junglebg-2.png"},{name:"jungleboss-bg",type:"image",src:"data/img/stage/stage-2/tiles/jungleboss-bg.png"},{name:"jungle1",type:"tmx",src:"data/img/stage/stage-2-1.tmx"},{name:"jungle2",type:"tmx",src:"data/img/stage/stage-2-2.tmx"},{name:"jungle3",type:"tmx",src:"data/img/stage/stage-2-3.tmx"},{name:"parrot-spritesheet",type:"image",src:"data/img/stage/stage-2/enemies/parrot-spritesheet.png"},{name:"parrot-sfx",type:"audio",src:"data/sfx/stage-2/",channel:2},{name:"popout-fish-spritesheet",type:"image",src:"data/img/stage/stage-2/enemies/popout-fish-spritesheet.png"},{name:"popout-fish-splash-sfx",type:"audio",src:"data/sfx/stage-2/",channel:2},{name:"popout-fish-eat-sfx",type:"audio",src:"data/sfx/stage-2/",channel:2},{name:"pixie-spritesheet",type:"image",src:"data/img/stage/stage-2/enemies/pixie-spritesheet.png",channel:2},{name:"pixie-shot-spritesheet",type:"image",src:"data/img/stage/stage-2/enemies/pixie-shot-spritesheet.png",channel:2},{name:"pixie-shot-sfx",type:"audio",src:"data/sfx/stage-2/",channel:2},{name:"ninja-cat-spritesheet",type:"image",src:"data/img/stage/stage-2/enemies/ninja-cat-spritesheet.png",channel:2},{name:"waterfall-spritesheet",type:"image",src:"data/img/stage/stage-2/elements/waterfall-spritesheet.png"},{name:"waterfall-base-spritesheet",type:"image",src:"data/img/stage/stage-2/elements/waterfall-base-spritesheet.png"},{name:"wave-spritesheet-lr",type:"image",src:"data/img/stage/stage-2/enemies/wave-spritesheet-lr.png"},{name:"wave-spritesheet-ud",type:"image",src:"data/img/stage/stage-2/enemies/wave-spritesheet-ud.png"},{name:"cat-fireball-spritesheet",type:"image",src:"data/img/stage/stage-2/enemies/cat-fireball-spritesheet.png"},{name:"cat-wave-sfx",type:"audio",src:"data/sfx/stage-2/",channel:2},{name:"cat-flame-sfx",type:"audio",src:"data/sfx/stage-2/",channel:2},{name:"stage-3-cutscene-1",type:"image",src:"data/img/stage/stage-3/intro/scene-1.png"},{name:"stage-3-cutscene-2",type:"image",src:"data/img/stage/stage-3/intro/scene-2.png"},{name:"stage-3-cutscene-3",type:"image",src:"data/img/stage/stage-3/intro/scene-3.png"},{name:"stage-3-cutscene-4",type:"image",src:"data/img/stage/stage-3/intro/scene-4.png"},{name:"jungle1",type:"tmx",src:"data/img/stage/stage-3-1.tmx"}],function(a){"use strict";var b=function(){},c={getType:function(){return"null"},isSupported:function(){return!1},update:b},d=function(a){var c=this,d=window;this.update=b,this.requestAnimationFrame=a||d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame,this.tickFunction=function(){c.update(),c.startTicker()},this.startTicker=function(){c.requestAnimationFrame.apply(d,[c.tickFunction])}};d.prototype.start=function(a){this.update=a||b,this.startTicker()};var e=function(){};e.prototype.update=b,e.prototype.start=function(a){this.update=a||b};var f=function(a,b){this.listener=a,this.gamepadGetter=b,this.knownGamepads=[]};f.factory=function(a){var b=c,d=window&&window.navigator;return d&&("undefined"!=typeof d.getGamepads?b=new f(a,function(){return d.getGamepads()}):"undefined"!=typeof d.webkitGamepads?b=new f(a,function(){return d.webkitGamepads()}):"undefined"!=typeof d.webkitGetGamepads&&(b=new f(a,function(){return d.webkitGetGamepads()
}))),b},f.getType=function(){return"WebKit"},f.prototype.getType=function(){return f.getType()},f.prototype.isSupported=function(){return!0},f.prototype.update=function(){var a,b,c=this,d=Array.prototype.slice.call(this.gamepadGetter(),0);for(b=this.knownGamepads.length-1;b>=0;b--)a=this.knownGamepads[b],d.indexOf(a)<0&&(this.knownGamepads.splice(b,1),this.listener._disconnect(a));for(b=0;b<d.length;b++)a=d[b],a&&c.knownGamepads.indexOf(a)<0&&(c.knownGamepads.push(a),c.listener._connect(a))};var g=function(a){this.listener=a,window.addEventListener("gamepadconnected",function(b){a._connect(b.gamepad)}),window.addEventListener("gamepaddisconnected",function(b){a._disconnect(b.gamepad)})};g.factory=function(a){var b=c;return window&&"undefined"!=typeof window.addEventListener&&(b=new g(a)),b},g.getType=function(){return"Firefox"},g.prototype.getType=function(){return g.getType()},g.prototype.isSupported=function(){var a=window&&window.navigator;return-1!==a.userAgent.indexOf("Firefox")},g.prototype.update=b;var h=function(a){this.updateStrategy=a||new d,this.gamepads=[],this.listeners={},this.platform=c,this.deadzone=.03,this.maximizeThreshold=.97};h.UpdateStrategies={AnimFrameUpdateStrategy:d,ManualUpdateStrategy:e},h.PlatformFactories=[g.factory,f.factory],h.Type={N64:"n64",PLAYSTATION:"playstation",LOGITECH:"logitech",XBOX:"xbox",UNKNOWN:"unknown"},h.Event={CONNECTED:"connected",UNSUPPORTED:"unsupported",DISCONNECTED:"disconnected",TICK:"tick",BUTTON_DOWN:"button-down",BUTTON_UP:"button-up",AXIS_CHANGED:"axis-changed"},h.StandardButtons=["FACE_1","FACE_2","FACE_3","FACE_4","LEFT_TOP_SHOULDER","RIGHT_TOP_SHOULDER","LEFT_BOTTOM_SHOULDER","RIGHT_BOTTOM_SHOULDER","SELECT_BACK","START_FORWARD","LEFT_STICK","RIGHT_STICK","DPAD_UP","DPAD_DOWN","DPAD_LEFT","DPAD_RIGHT","HOME"],h.StandardAxes=["LEFT_STICK_X","LEFT_STICK_Y","RIGHT_STICK_X","RIGHT_STICK_Y"];var i=function(a,b,c){return b<a.length?a[b]:c+(b-a.length+1)};h.StandardMapping={env:{},buttons:{byButton:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},axes:{byAxis:[0,1,2,3]}},h.Mappings=[{env:{platform:g.getType(),type:h.Type.N64},buttons:{byButton:[2,1,3,0,4,5,-1,-1,8,9,-1,-1,12,13,14,15,-1]},axes:{byAxis:[1,2,-1,-1]}},{env:{platform:f.getType(),type:h.Type.N64},buttons:{byButton:[2,1,3,0,4,5,-1,-1,8,9,-1,-1,12,13,14,15,-1]},axes:{byAxis:[0,1,-1,-1]}},{env:{platform:g.getType(),type:h.Type.XBOX},buttons:{byButton:[0,1,2,3,4,5,15,16,9,8,6,7,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:g.getType(),type:h.Type.PLAYSTATION},buttons:{byButton:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]},axes:{byAxis:[0,1,2,3]}},{env:{platform:f.getType(),type:h.Type.LOGITECH},buttons:{byButton:[1,2,0,3,4,5,6,7,8,9,10,11,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:g.getType(),type:h.Type.LOGITECH},buttons:{byButton:[0,1,2,3,4,5,-1,-1,6,7,8,9,11,12,13,14,10],byAxis:[-1,-1,-1,-1,-1,-1,[2,0,1],[2,0,-1]]},axes:{byAxis:[0,1,3,4]}}],h.prototype.init=function(){var a=h.resolvePlatform(this),b=this;return this.platform=a,this.updateStrategy.start(function(){b._update()}),a.isSupported()},h.prototype.bind=function(a,b){return"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b),this},h.prototype.unbind=function(a,b){if("undefined"==typeof a)return void(this.listeners={});if("undefined"==typeof b)return void(this.listeners[a]=[]);if("undefined"==typeof this.listeners[a])return!1;for(var c=0;c<this.listeners[a].length;c++)if(this.listeners[a][c]===b)return this.listeners[a].splice(c,1),!0;return!1},h.prototype.count=function(){return this.gamepads.length},h.prototype._fire=function(a,b){if("undefined"!=typeof this.listeners[a])for(var c=0;c<this.listeners[a].length;c++)this.listeners[a][c].apply(this.listeners[a][c],[b])},h.getNullPlatform=function(){return Object.create(c)},h.resolvePlatform=function(a){var b,d=c;for(b=0;!d.isSupported()&&b<h.PlatformFactories.length;b++)d=h.PlatformFactories[b](a);return d},h.prototype._connect=function(a){var b,c,d=this._resolveMapping(a);for(a.state={},a.lastState={},a.updater=[],b=d.buttons.byButton.length,c=0;b>c;c++)this._addButtonUpdater(a,d,c);for(b=d.axes.byAxis.length,c=0;b>c;c++)this._addAxisUpdater(a,d,c);this.gamepads[a.index]=a,this._fire(h.Event.CONNECTED,a)},h.prototype._addButtonUpdater=function(a,c,d){var e=b,f=i(h.StandardButtons,d,"EXTRA_BUTTON_"),g=this._createButtonGetter(a,c.buttons,d),j=this,k={gamepad:a,control:f};a.state[f]=0,a.lastState[f]=0,e=function(){var b=g(),c=a.lastState[f],d=b>.5,e=c>.5;a.state[f]=b,d&&!e?j._fire(h.Event.BUTTON_DOWN,Object.create(k)):!d&&e&&j._fire(h.Event.BUTTON_UP,Object.create(k)),0!==b&&1!==b&&b!==c&&j._fireAxisChangedEvent(a,f,b),a.lastState[f]=b},a.updater.push(e)},h.prototype._addAxisUpdater=function(a,c,d){var e=b,f=i(h.StandardAxes,d,"EXTRA_AXIS_"),g=this._createAxisGetter(a,c.axes,d),j=this;a.state[f]=0,a.lastState[f]=0,e=function(){var b=g(),c=a.lastState[f];a.state[f]=b,b!==c&&j._fireAxisChangedEvent(a,f,b),a.lastState[f]=b},a.updater.push(e)},h.prototype._fireAxisChangedEvent=function(a,b,c){var d={gamepad:a,axis:b,value:c};this._fire(h.Event.AXIS_CHANGED,d)},h.prototype._createButtonGetter=function(){var a=function(){return 0},b=function(b,c,d){var e=a;return d>c?e=function(){var a=d-c,e=b();return e=(e-c)/a,0>e?0:e}:c>d&&(e=function(){var a=c-d,e=b();return e=(e-d)/a,e>1?0:1-e}),e},c=function(a){return"[object Array]"===Object.prototype.toString.call(a)};return function(d,e,f){var g,h=a,i=this;return g=e.byButton[f],-1!==g?"number"==typeof g&&g<d.buttons.length&&(h=function(){var a=d.buttons[g];return"number"==typeof a?a:"number"==typeof a.value?a.value:0}):e.byAxis&&f<e.byAxis.length&&(g=e.byAxis[f],c(g)&&3==g.length&&g[0]<d.axes.length&&(h=function(){var a=d.axes[g[0]];return i._applyDeadzoneMaximize(a)},h=b(h,g[1],g[2]))),h}}(),h.prototype._createAxisGetter=function(){var a=function(){return 0};return function(b,c,d){var e,f=a,g=this;return e=c.byAxis[d],-1!==e&&"number"==typeof e&&e<b.axes.length&&(f=function(){var a=b.axes[e];return g._applyDeadzoneMaximize(a)}),f}}(),h.prototype._disconnect=function(a){var b,c=[];for("undefined"!=typeof this.gamepads[a.index]&&delete this.gamepads[a.index],b=0;b<this.gamepads.length;b++)"undefined"!=typeof this.gamepads[b]&&(c[b]=this.gamepads[b]);this.gamepads=c,this._fire(h.Event.DISCONNECTED,a)},h.prototype._resolveControllerType=function(a){return a=a.toLowerCase().replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),-1!==a.indexOf("playstation")?h.Type.PLAYSTATION:-1!==a.indexOf("logitech")||-1!==a.indexOf("wireless gamepad")?h.Type.LOGITECH:-1!==a.indexOf("xbox")||-1!==a.indexOf("360")?h.Type.XBOX:-1!==a.indexOf("79-6-generic")&&-1!==a.indexOf("joystick")||-1!==a.indexOf("vendor: 0079 product: 0006")&&-1!==a.indexOf("generic usb joystick")?h.Type.N64:h.Type.UNKNOWN},h.prototype._resolveMapping=function(a){var b,c,d=h.Mappings,e=null,f={platform:this.platform.getType(),type:this._resolveControllerType(a.id)};for(b=0;!e&&b<d.length;b++)c=d[b],h.envMatchesFilter(c.env,f)&&(e=c);return e||h.StandardMapping},h.envMatchesFilter=function(a,b){var c,d=!0;for(c in a)a[c]!==b[c]&&(d=!1);return d},h.prototype._update=function(){this.platform.update(),this.gamepads.forEach(function(a){a&&a.updater.forEach(function(a){a()})}),this.gamepads.length>0&&this._fire(h.Event.TICK,this.gamepads)},h.prototype._applyDeadzoneMaximize=function(a,b,c){return b="undefined"!=typeof b?b:this.deadzone,c="undefined"!=typeof c?c:this.maximizeThreshold,a>=0?b>a?a=0:a>c&&(a=1):a>-b?a=0:-c>a&&(a=-1),a},a.Gamepad=h}("undefined"!=typeof module&&module.exports||window),InputObserver.prototype.isPausePressed=function(){return me.input.isKeyPressed("pause")||gamepadStatus.isStartPressed},InputObserver.prototype.isShootPressed=function(){return me.input.isKeyPressed("shoot")||gamepadStatus.isAPressed},InputObserver.prototype.isJumpPressed=function(){return me.input.isKeyPressed("jump")||gamepadStatus.isBPressed},InputObserver.prototype.isUpPressed=function(){return me.input.isKeyPressed("up")||gamepadStatus.isUpPressed||gamepadStatus.isStickUpPressed},InputObserver.prototype.isDownPressed=function(){return me.input.isKeyPressed("down")||gamepadStatus.isDownPressed||gamepadStatus.isStickDownPressed},InputObserver.prototype.isLeftPressed=function(){return me.input.isKeyPressed("left")||gamepadStatus.isLeftPressed||gamepadStatus.isStickLeftPressed},InputObserver.prototype.isRightPressed=function(){return me.input.isKeyPressed("right")||gamepadStatus.isRightPressed||gamepadStatus.isStickRightPressed},InputObserver.prototype.resetState=function(){gamepadStatus.isStartPressed=!1,gamepadStatus.isAPressed=!1,gamepadStatus.isBPressed=!1,gamepadStatus.isUpPressed=!1,gamepadStatus.isDownPressed=!1,gamepadStatus.isLeftPressed=!1,gamepadStatus.isRightPressed=!1,gamepadStatus.isStickUpPressed=!1,gamepadStatus.isStickDownPressed=!1,gamepadStatus.isStickLeftPressed=!1,gamepadStatus.isStickRightPressed=!1};var XboxController={FaceButtons:{A_BUTTON:"FACE_1",B_BUTTON:"FACE_2",X_BUTTON:"FACE_3",Y_BUTTON:"FACE_4"},ControlButtons:{START_BUTTON:"START_FORWARD",SELECT_BUTTON:"SELECT_BACK"},ShoulderButtons:{TOP_LEFT_SHOULDER_BUTTON:"LEFT_TOP_SHOULDER",TOP_RIGHT_SHOULDER_BUTTON:"RIGHT_TOP_SHOULDER",BOTTOM_LEFT_SHOULDER_BUTTON:"LEFT_BOTTOM_SHOULDER",BOTTOM_RIGHT_SHOULDER_BUTTON:"RIGHT_BOTTOM_SHOULDER"},DirectionalPad:{UP:"DPAD_UP",RIGHT:"DPAD_RIGHT",DOWN:"DPAD_DOWN",LEFT:"DPAD_LEFT"},Joystick:{LeftStick:{X:"LEFT_STICK_X",Y:"LEFT_STICK_Y"},RightStick:{X:"RIGHT_STICK_X",Y:"RIGHT_STICK_Y"}}},gamepad=new Gamepad,gamepadStatus={isAPressed:!1,isBPressed:!1,isUpPressed:!1,isDownPressed:!1,isLeftPressed:!1,isRightPressed:!1,isStartPressed:!1,isStickLeftPressed:!1,isStickRightPressed:!1,isStickUpPressed:!1,isStickDownPressed:!1};gamepad.bind(Gamepad.Event.CONNECTED,function(){}),gamepad.bind(Gamepad.Event.DISCONNECTED,function(){}),gamepad.bind(Gamepad.Event.UNSUPPORTED,function(){}),gamepad.bind(Gamepad.Event.BUTTON_DOWN,function(a){a.control===XboxController.FaceButtons.A_BUTTON?gamepadStatus.isAPressed=!0:a.control===XboxController.FaceButtons.B_BUTTON?gamepadStatus.isBPressed=!0:a.control===XboxController.DirectionalPad.LEFT?gamepadStatus.isLeftPressed=!0:a.control===XboxController.DirectionalPad.RIGHT?gamepadStatus.isRightPressed=!0:a.control===XboxController.DirectionalPad.UP?gamepadStatus.isUpPressed=!0:a.control===XboxController.DirectionalPad.DOWN?gamepadStatus.isDownPressed=!0:a.control===XboxController.ControlButtons.START_BUTTON&&(gamepadStatus.isStartPressed=!0)}),gamepad.bind(Gamepad.Event.BUTTON_UP,function(a){a.control===XboxController.DirectionalPad.UP?gamepadStatus.isUpPressed=!1:a.control===XboxController.DirectionalPad.DOWN?gamepadStatus.isDownPressed=!1:a.control===XboxController.DirectionalPad.LEFT?gamepadStatus.isLeftPressed=!1:a.control===XboxController.DirectionalPad.RIGHT?gamepadStatus.isRightPressed=!1:a.control===XboxController.ControlButtons.START_BUTTON?gamepadStatus.isStartPressed=!1:a.control===XboxController.FaceButtons.A_BUTTON?gamepadStatus.isAPressed=!1:a.control===XboxController.FaceButtons.B_BUTTON&&(gamepadStatus.isBPressed=!1)}),gamepad.bind(Gamepad.Event.AXIS_CHANGED,function(a){a.axis===XboxController.Joystick.LeftStick.X?(gamepadStatus.isStickLeftPressed=a.value<-.9,gamepadStatus.isStickRightPressed=a.value>.9):a.axis===XboxController.Joystick.LeftStick.Y&&(gamepadStatus.isStickUpPressed=a.value<-.9,gamepadStatus.isStickDownPressed=a.value>.9)}),gamepad.bind(Gamepad.Event.TICK,function(){}),!gamepad.init(),game.EventAlertEntity=me.ObjectEntity.extend({init:function(){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("event-alert"),32,32),this.z=999,this.parent(game.data.player.pos.x,game.data.player.pos.y-32,{image:"event-alert",spritewidth:32,spriteheight:32}),this.gravity=0,this.alwaysUpdate=!1,this.frameCount=0},update:function(){return 0==this.frameCount&&me.audio.isAudioEnable()&&me.audio.play("event-sfx"),this.frameCount>=120?me.game.remove(this):(this.pos.x=game.data.player.pos.x+5,game.data.player.pos.y-37>0&&(this.pos.y=game.data.player.pos.y-37)),this.frameCount=this.frameCount+1,this.parent(),!0}}),game.FallingSugarShotEntity=me.ObjectEntity.extend({init:function(a,b,c,d){this.parent(a,b,c),this.setVelocity(8,2),this.collidable=!0,this.isFacingRight=d,this.activeFrames=0,this.type=game.data.SUGARSHOT_TYPE},update:function(){return game.data.isPaused?!1:(this.activeFrames=this.activeFrames+1,this.isFacingRight?(this.flipX(!1),this.vel.x+=this.accel.x*me.timer.tick):(this.flipX(!0),this.vel.x-=this.accel.x*me.timer.tick),this.activeFrames%20==0&&this.setVelocity(Math.abs(this.vel.x)/3,2),this.updateMovement(),me.game.viewport.contains(this)&&0!=this.vel.y&&0!=this.vel.x||(game.data.sugarShotOnScreen=!1,me.game.remove(this)),this.parent(),!0)}}),game.LinearShot=me.ObjectEntity.extend({init:function(a,b,c,d,e){this.parent(a,b,c),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.gravity=0,this.velocity=e,this.direction=d,this.width=c.spritewidth,this.height=c.spriteheight,this.alwaysUpdate=!1},update:function(){return game.data.isPaused?!1:("west"===this.direction&&this.pos.x-this.velocity>0?(this.pos.x=this.pos.x-this.velocity,this.flipX(!0)):"east"===this.direction&&this.pos.x+this.velocity+this.width+1<game.data.stageWidth?this.pos.x=this.pos.x+this.velocity:"south"===this.direction&&this.pos.y+this.velocity+this.height+1<game.data.stageHeight?this.pos.y=this.pos.y+this.velocity:"north"===this.direction&&this.pos.y-this.velocity>0?this.pos.y=this.pos.y-this.velocity:me.game.remove(this),this.inViewport||me.game.remove(this),!0)}}),game.MoreEnergyEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("more-energy-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],250),this.renderable.setCurrentAnimation("active"),this.resetState()},update:function(){var a=!1;if(this.inViewport){a=!0;var b=this.collide();b&&b.obj.type==game.data.PLAYER_TYPE&&(game.data.playerHealth=game.data.playerHealth+1,game.data.playerHealth>4&&(game.data.playerHealth=4),me.audio.play("more-health-sfx"),me.game.remove(this))}return this.parent(),a},resetState:function(){this.collidable=!0,this.gravity=0,this.type=game.data.MORE_ENERGY_TYPE,this.alwaysUpdate=!1,this.renderable.setCurrentAnimation("active")}}),game.PlayerEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("player-spritesheet"),40,40),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=40,c.spriteheight=40,this.parent(a,b,c),this.setVelocity(3,15),this.isFacingRight=!0,this.collidable=!0,this.flipX(!1),this.type=game.data.PLAYER_TYPE,this.renderable.addAnimation("walk-r",[0,1]),this.renderable.addAnimation("walk-l",[2,3]),this.renderable.addAnimation("spit-r",[4,5]),this.renderable.addAnimation("spit-l",[6,7]),this.renderable.addAnimation("jump-r",[8,9]),this.renderable.addAnimation("jump-l",[10,11]),this.renderable.addAnimation("die",[12,13,14,15,16]),this.renderable.setCurrentAnimation("walk-r"),me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH),this.invincibleFrames=0,this.isInvincible=!1,this.alwaysUpdate=!0},hit:function(){this.isInvincible||(game.data.playerHealth=game.data.playerHealth-1,game.data.playerHealth<=0?this.die():(this.pos.x=this.isFacingRight?this.pos.x-20:this.pos.x+20,this.isInvincible=!0,me.audio.play("hit-sfx")))},die:function(){game.data.isPlayerDead||(game.data.isPlayerDead=!0,this.vel.x=0,game.data.playerLives=game.data.playerLives-1,game.data.playerHealth=4,game.data.sugarShotOnScreen=!1,me.audio.play("death-sfx"),me.audio.stopTrack(),this.isFacingRight||this.flipX(!0),this.renderable.setCurrentAnimation("die"))},update:function(){if(!game.data.isPaused){if(game.data.isPlayerDead)4===this.renderable.getCurrentAnimationFrame()&&me.state.change(game.data.checkpoint);else{this.isInvincible&&(this.invincibleFrames<=game.data.PLAYER_INVINCIBLE_FRAMES-3&&this.renderable.flicker(1),this.invincibleFrames=this.invincibleFrames+1,this.invincibleFrames>=game.data.PLAYER_INVINCIBLE_FRAMES&&(this.invincibleFrames=0,this.isInvincible=!1));var a=this.collide();if(a&&(a.obj.type===me.game.ENEMY_OBJECT&&this.hit(),a.obj.type===game.data.PLATFORM_TYPE&&(this.pos.y<=a.obj.pos.y&&a.y>0?this.pos.y=a.obj.pos.y-40:this.pos.y<a.obj.pos.y+a.obj.height&&0===this.vel.y&&(this.pos.x<=a.obj.pos.x?(this.pos.x=a.obj.pos.x-44,game.data.inputObserver.isRightPressed()&&null===me.game.currentLevel.getLayerByName("Collision").getTile(a.obj.pos.x+a.obj.width+3,a.obj.pos.y+a.obj.height-1)&&a.obj.pos.x+a.obj.width+10<game.data.stageWidth&&(a.obj.pos.x=a.obj.pos.x+3)):(this.pos.x=a.obj.pos.x+a.obj.width+1,game.data.inputObserver.isLeftPressed()&&null===me.game.currentLevel.getLayerByName("Collision").getTile(a.obj.pos.x-3,a.obj.pos.y+a.obj.height-1)&&a.obj.pos.x-10>0&&(a.obj.pos.x=a.obj.pos.x-3))),a.x&&(this.vel.x=0,0!=this.vel.y&&(this.pos.x=a.x>0?this.pos.x-5:this.pos.x+5)),a.y&&this.pos.y<=a.obj.pos.y?(this.vel.y=0,this.falling=!1):(this.vel.y=-1*this.vel.y,this.falling=!0)),a.obj.type===game.data.SOLID_TYPE&&(this.pos.y<=a.obj.pos.y?this.pos.y=a.obj.pos.y-40:this.pos.y<a.obj.pos.y+a.obj.height&&0===this.vel.y&&(this.pos.x=this.pos.x<=a.obj.pos.x?a.obj.pos.x-44:a.obj.pos.x+a.obj.width+1),a.x&&(this.vel.x=0,0!=this.vel.y&&(this.pos.x=a.x>0?this.pos.x-5:this.pos.x+5)),a.y&&this.pos.y<=a.obj.pos.y?(this.vel.y=0,this.falling=!1):(this.vel.y=-1*this.vel.y,this.falling=!0)),(a.obj.type===game.data.DEATH_TYPE||a.obj.type===game.data.WATER_TYPE)&&this.die()),!game.data.isPlayerDead){if(game.data.inputObserver.isLeftPressed()?(this.isFacingRight=!1,this.vel.x-=this.accel.x*me.timer.tick,this.renderable.isCurrentAnimation("walk-l")||0!=this.vel.y||this.renderable.setCurrentAnimation("walk-l")):game.data.inputObserver.isRightPressed()?(this.isFacingRight=!0,this.vel.x+=this.accel.x*me.timer.tick,this.renderable.isCurrentAnimation("walk-r")||0!=this.vel.y||this.renderable.setCurrentAnimation("walk-r")):this.vel.x=0,game.data.inputObserver.isShootPressed()&&!game.data.sugarShotOnScreen&&this.pos.y>0)if(this.isFacingRight?this.renderable.setCurrentAnimation("spit-r","walk-r"):this.renderable.setCurrentAnimation("spit-l","walk-l"),me.audio.isAudioEnable()&&me.audio.play("sugar-shot-sfx"),game.data.sugarShotOnScreen=!0,0!=this.vel.y){var b=new game.FallingSugarShotEntity(this.pos.x,this.pos.y,{image:"sugar-shot",spritewidth:20,spriteheight:20},this.isFacingRight);me.game.add(b,this.z)}else{var b=new game.StraightSugarShotEntity(this.pos.x,this.pos.y,{image:"sugar-shot",spritewidth:20,spriteheight:20},this.isFacingRight);me.game.add(b,this.z)}game.data.inputObserver.isJumpPressed()&&(this.jumping||this.falling||(this.isFacingRight?this.renderable.setCurrentAnimation("jump-r","walk-r"):this.renderable.setCurrentAnimation("jump-l","walk-l"),me.audio.isAudioEnable()&&me.audio.play("jump-sfx"),this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0))}}return 0!=this.vel.x||0!=this.vel.y||this.renderable.isCurrentAnimation("die")||this.isInvincible?(this.parent(),this.updateMovement(),!0):!1}}}),game.RoyalJellyEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("royal-jelly-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],250),this.renderable.setCurrentAnimation("active"),this.resetState()},update:function(){var a=!1;if(this.inViewport){a=!0;var b=this.collide();b&&b.obj.type==game.data.PLAYER_TYPE&&(game.data.playerHealth=game.data.playerHealth+1,game.data.playerHealth>4&&(game.data.playerHealth=4),me.audio.play("royal-jelly-sfx"),me.game.remove(this))}return this.parent(),a},resetState:function(){this.collidable=!0,this.gravity=0,this.type=game.data.MORE_ENERGY_TYPE,this.alwaysUpdate=!1,this.renderable.setCurrentAnimation("active")}}),game.StraightSugarShotEntity=me.ObjectEntity.extend({init:function(a,b,c,d){this.parent(a,b,c),this.setVelocity(8,2),this.collidable=!0,this.isFacingRight=d,this.gravity=0,this.type=game.data.SUGARSHOT_TYPE},update:function(){return game.data.isPaused?!1:(this.isFacingRight?(this.flipX(!1),this.vel.x+=this.accel.x*me.timer.tick):(this.flipX(!0),this.vel.x-=this.accel.x*me.timer.tick),this.updateMovement(),me.game.viewport.contains(this)&&0!=this.vel.x||(game.data.sugarShotOnScreen=!1,me.game.remove(this)),this.parent(),!0)}}),game.TemporaryEnemy=me.ObjectEntity.extend({init:function(a,b,c,d){this.parent(a,b,c),this.updateColRect(0,c.spritewidth,4,c.spriteheight-8),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.durationInFrames=d,this.currentDuration=0,this.gravity=0},update:function(){return game.data.isPaused?void 0:this.currentDuration<this.durationInFrames?(this.parent(),this.updateMovement(),this.currentDuration=this.currentDuration+1,!0):(me.game.remove(this),!1)}}),game.WarpTile=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.collidable=!0,this.type=game.data.WARP_TYPE,this.destination=0}}),game.CeilingLampEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("ceiling-lamp-spritesheet"),64,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=64,c.spriteheight=64,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],150),this.resetState()},update:function(){var a=!1;return game.data.isPaused||(this.parent(),this.updateMovement()),a},resetState:function(){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.renderable.setCurrentAnimation("active"),this.collidable=!1}}),game.DesertKnightEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("desert-knight-spritesheet"),50,50),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=50,c.spriteheight=50,this.parent(a,b,c),this.updateColRect(4,46,-1,50),this.renderable.addAnimation("walk",[0,1],250),this.renderable.addAnimation("freeze",[2,3,4,5],50),this.renderable.addAnimation("frozen",[5]),this.resetState()},update:function(){if(!game.data.isPaused){this.activeFrames=this.activeFrames+1;var a=this.collide();return a&&a.obj.type==game.data.SUGARSHOT_TYPE&&(game.data.sugarShotOnScreen=!1,me.game.remove(a.obj),this.aliveOnScreen&&(me.audio.play("freeze-sfx"),game.data.playerScore=game.data.playerScore+100,this.gravity=1,this.aliveOnScreen=!1,this.vel.x=0,this.type=game.data.PLATFORM_TYPE,this.renderable.setCurrentAnimation("freeze","frozen"))),this.aliveOnScreen&&(this.goingLeft?null!==me.game.collisionMap.getTile(this.pos.x,this.pos.y+this.height)?(this.vel.x-=this.accel.x*me.timer.tick,this.flipX(!1)):(this.goingLeft=!1,this.vel.x+=this.accel.x*me.timer.tick,this.flipX(!0)):null!==me.game.collisionMap.getTile(this.pos.x+this.width,this.pos.y+this.height)?(this.vel.x+=this.accel.x*me.timer.tick,this.flipX(!0)):(this.goingLeft=!0,this.vel.x-=this.accel.x*me.timer.tick,this.flipX(!1))),this.parent(),this.updateMovement(),!0}return!1},resetState:function(){this.collidable=!0,this.aliveOnScreen=!0,this.type=me.game.ENEMY_OBJECT,this.goingLeft=!0,this.setVelocity(.5,15),this.renderable.setCurrentAnimation("walk")}}),game.DesertSpikeTrap=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("desert-spike-trap"),64,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=64,c.spriteheight=64,this.parent(a,b,c),this.collidable=!0,this.type=game.data.DEATH_TYPE}}),game.Elevator=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("elevator"),96,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=96,c.spriteheight=64,this.parent(a,b,c),this.aliveOnScreen=this.inViewPort,this.alwaysUpdate=!0,this.resetState()},update:function(){if(!game.data.isPaused){var a=this.collide();this.activeFrames==this.max?(this.isGoingUp=!this.isGoingUp,this.activeFrames=0):this.isGoingUp?(a&&a.obj.type==game.data.PLAYER_TYPE&&0==game.data.player.vel.y&&(game.data.player.pos.y=game.data.player.pos.y-this.rate),this.pos.y=this.pos.y-this.rate,this.activeFrames=this.activeFrames+1):(game.data.PLAYER_TYPE&&!game.data.player.jumping&&game.data.player.pos.x>=this.pos.x-40&&game.data.player.pos.x<=this.pos.x+96&&game.data.player.pos.y<=this.pos.y&&this.pos.y-40-5<=game.data.player.pos.y&&(game.data.player.pos.y=game.data.player.pos.y+this.rate),this.pos.y=this.pos.y+this.rate,this.activeFrames=this.activeFrames+1)}return!0},resetState:function(){this.activeFrames=0,this.max=100,this.rate=2,this.isGoingUp=!0,this.collidable=!0,this.aliveOnScreen=!0,this.type=game.data.SOLID_TYPE}}),game.FlameShooterEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("flame-shooter-spritesheet"),50,43),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=50,c.spriteheight=43,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1,2,3],500),this.renderable.addAnimation("shooting",[0],0),this.renderable.setCurrentAnimation("active"),this.aliveOnScreen=this.inViewPort,this.alwaysUpdate=!1,this.resetState()},update:function(){var a=!1;return game.data.isPaused||(this.inViewport?this.pos.x-10>0&&0===this.vel.x&&(3!=this.renderable.getCurrentAnimationFrame()||this.hasFired?this.hasFired&&(this.shootingFrames=this.shootingFrames+1,15==this.shootingFrames?me.game.add(new game.TemporaryEnemy(this.pos.x-62,this.pos.y+3,{image:"flame-shot-2",spritewidth:60,spriteheight:36},30),this.z):45==this.shootingFrames?me.game.add(new game.TemporaryEnemy(this.pos.x-22,this.pos.y+3,{image:"flame-shot-1",spritewidth:20,spriteheight:36},15),this.z):60==this.shootingFrames&&(this.renderable.animationpause=!1,this.hasFired=!1)):(this.hasFired=!0,this.renderable.animationpause=!0,this.shootingFrames=0,me.game.add(new game.TemporaryEnemy(this.pos.x-22,this.pos.y+3,{image:"flame-shot-1",spritewidth:20,spriteheight:36},15),this.z),me.audio.isAudioEnable()&&me.audio.play("flame-shot-sfx")),this.parent(),this.updateMovement(),a=!0):this.resetState()),a},resetState:function(){this.shootingFrames=0,this.collidable=!0,this.aliveOnScreen=!0,this.hasFired=!1,this.type=game.data.PLATFORM_TYPE,this.renderable.setCurrentAnimation("active")}}),game.LanternEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("lantern-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],150),this.resetState()},update:function(){var a=!1;return game.data.isPaused||(this.parent(),this.updateMovement()),a},resetState:function(){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.renderable.setCurrentAnimation("active"),this.collidable=!1}}),game.PeaShooterEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("peashooter-spritesheet"),65,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=65,c.spriteheight=64,this.parent(a,b,c),this.updateColRect(4,40,0,54),this.renderable.addAnimation("float",[0,1]),this.renderable.addAnimation("cockback",[2,3]),this.renderable.addAnimation("freeze",[4,5,6,7],50),this.renderable.addAnimation("frozen",[7]),this.movementLength=20,this.initialX=a,this.initialY=b,this.aliveOnScreen=this.inViewPort,this.resetState(),this.alwaysUpdate=!1},update:function(){if(!game.data.isPaused){this.activeFrames=this.activeFrames+1;var a=this.collide();return a&&a.obj.type==game.data.SUGARSHOT_TYPE&&(game.data.sugarShotOnScreen=!1,me.game.remove(a.obj),this.aliveOnScreen&&(me.audio.play("freeze-sfx"),game.data.playerScore=game.data.playerScore+100,this.gravity=1,this.aliveOnScreen=!1,this.type=game.data.PLATFORM_TYPE,this.renderable.setCurrentAnimation("freeze","frozen"),this.updateColRect(0,65,0,64))),this.inViewport&&this.activeFrames%5==0&&this.aliveOnScreen&&(this.isDescending?(this.yDelta=this.yDelta+2,this.pos.y=this.pos.y+this.yDelta):(this.yDelta=this.yDelta-2,this.pos.y=this.pos.y+this.yDelta),Math.abs(this.yDelta)>=this.movementLength&&(this.isDescending=!this.isDescending)),this.inViewport&&this.aliveOnScreen&&this.activeFrames%120==0&&(me.audio.play("pea-shot-sfx"),this.isFacingRight===!1?me.game.add(new game.PeaShot(this.pos.x,this.pos.y,{image:"pea-shot",spritewidth:20,spriteheight:20},"west",6),this.z):me.game.add(new game.PeaShot(this.pos.x,this.pos.y,{image:"pea-shot",spritewidth:20,spriteheight:20},"east",6),this.z),this.renderable.setCurrentAnimation("cockback","float")),this.parent(),this.updateMovement(),!0}return!1},resetState:function(){this.gravity=0,this.collidable=!0,this.isDescending=!1,this.yDelta=0,this.activeFrames=0,this.pos.x=this.initialX,this.pos.y=this.initialY,this.aliveOnScreen=!0,this.type=me.game.ENEMY_OBJECT,this.isFacingRight=!1,this.renderable.setCurrentAnimation("float")}}),game.PeaShot=me.ObjectEntity.extend({init:function(a,b,c,d,e){this.parent(a,b,c),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.gravity=0,this.velocity=e,this.direction=d,this.alwaysUpdate=!1},update:function(){if(game.data.isPaused)return!1;"west"===this.direction?this.pos.x=this.pos.x-this.velocity:"east"===this.direction?this.pos.x=this.pos.x+this.velocity:"south"===this.direction?this.pos.y=this.pos.y+this.velocity:"north"===this.direction&&(this.pos.y=this.pos.y-this.velocity);this.updateMovement();return me.game.viewport.contains(this)||me.game.remove(this),this.parent(),!0}}),game.RotaryCannonEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("rotary-cannon-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1,2],375),this.renderable.setCurrentAnimation("active"),this.alwaysUpdate=!1,this.resetState()},update:function(){if(!game.data.isPaused){if(this.inViewport)return 1!=this.renderable.getCurrentAnimationFrame()||this.hasFired?1!=this.renderable.getCurrentAnimationFrame()&&(this.hasFired=!1):(this.toggle?(me.game.add(new game.LinearShot(this.pos.x+8,this.pos.y-16,{image:"rotary-cannon-bullet",spritewidth:18,spriteheight:18},"north",5),this.z),me.game.add(new game.LinearShot(this.pos.x+8,this.pos.y+16,{image:"rotary-cannon-bullet",spritewidth:18,spriteheight:18},"south",5),this.z)):(me.game.add(new game.LinearShot(this.pos.x+32,this.pos.y+8,{image:"rotary-cannon-bullet",spritewidth:18,spriteheight:18},"east",5),this.z),me.game.add(new game.LinearShot(this.pos.x,this.pos.y+8,{image:"rotary-cannon-bullet",spritewidth:18,spriteheight:18},"west",5),this.z)),this.toggle=!this.toggle,this.hasFired=!0),this.parent(),this.updateMovement(),!0;this.resetState()}return!1},resetState:function(){this.collidable=!0,this.aliveOnScreen=!0,this.hasFired=!1,this.gravity=0,this.type=me.game.ENEMY_OBJECT,this.toggle=!1}}),game.SandSharkEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.startingPos={x:a,y:b},this.renderable=new me.SpriteObject(0,0,me.loader.getImage("sand-shark-spritesheet"),50,50),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=50,c.spriteheight=50,this.parent(a,b,c),this.updateColRect(5,40,20,30),this.renderable.addAnimation("walk",[0,1,2,3,4],50),this.renderable.addAnimation("freeze",[5,6,7,8],50),this.renderable.addAnimation("frozen",[8],50),this.renderable.setCurrentAnimation("walk"),this.resetState()},update:function(){if(!game.data.isPaused){var a=this.collide();return a&&a.obj.type==game.data.SUGARSHOT_TYPE&&(game.data.sugarShotOnScreen=!1,me.game.remove(a.obj),this.alive&&(game.data.playerScore=game.data.playerScore+100,this.gravity=1,this.alive=!1,this.vel.x=0,this.renderable.setCurrentAnimation("freeze","frozen"),me.audio.play("freeze-sfx"),this.type=game.data.PLATFORM_TYPE,this.updateColRect(0,50,0,50))),this.inViewport&&this.alive&&(player_x=game.data.player.pos.x,this.goingLeft&&null!=me.game.collisionMap.getTile(this.pos.x,this.pos.y+this.height)?player_x<this.pos.x?(this.vel.x-=this.accel.x*me.timer.tick,this.flipX(!1)):(this.goingLeft=!1,this.vel.x+=this.accel.x*me.timer.tick,this.flipX(!0)):this.goingLeft||null==me.game.collisionMap.getTile(this.pos.x+this.width,this.pos.y+this.height)||(player_x>this.pos.x?(this.vel.x+=this.accel.x*me.timer.tick,this.flipX(!0)):(this.goingLeft=!0,this.vel.x-=this.accel.x*me.timer.tick,this.flipX(!1)))),this.parent(),this.updateMovement(),!0
}return!1},resetState:function(){this.pos.x=this.startingPos.x,this.pos.y=this.startingPos.y,this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.goingLeft=!0,this.alive=!0,this.alwaysUpdate=!1,this.setVelocity(1,15),this.renderable.setCurrentAnimation("walk")}}),game.SniperScopeEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.startingPos={x:a,y:b},this.renderable=new me.SpriteObject(0,0,me.loader.getImage("sniper-scope-spritesheet"),64,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=64,c.spriteheight=64,this.parent(a,b,c),this.renderable.addAnimation("hunt",[0,1],250),this.renderable.addAnimation("aim",[2,3,4],250),this.renderable.addAnimation("fire",[5,6,7],250),this.renderable.setCurrentAnimation("hunt"),this.resetState()},update:function(){var a=!1;if(!game.data.isPaused){if(this.visible&&!game.stage1_data.snipingComplete){if(player_x=game.data.player.pos.x,player_y=game.data.player.pos.y,this.renderable.isCurrentAnimation("hunt")&&(player_x<this.pos.x?this.pos.x=this.pos.x-3:player_x>this.pos.x&&(this.pos.x=this.pos.x+3),player_y<this.pos.y?this.pos.y=this.pos.y-3:player_y>this.pos.y&&(this.pos.y=player_y+3)),this.renderable.isCurrentAnimation("fire")){if(!this.soundPlayed&&me.audio.isAudioEnable()){me.audio.play("sniper-shot-sfx"),this.soundPlayed=!0,this.renderable.setAnimationFrame(0);var b=this.collide();b&&b.obj.type==game.data.PLAYER_TYPE&&game.data.player.hit()}2==this.renderable.getCurrentAnimationFrame()&&(this.pos.x=game.data.player.pos.x,this.pos.y=game.data.player.pos.y,this.activeFrames=0,this.soundPlayed=!1,this.renderable.setCurrentAnimation("hunt"))}240==this.activeFrames&&this.renderable.setCurrentAnimation("aim","fire"),this.activeFrames=this.activeFrames+1}this.parent(),this.updateMovement()}return a},resetState:function(){this.alive=!0,this.setVelocity(0,15),this.gravity=0,this.visible=!1,this.alwaysUpdate=!1,this.soundPlayed=!1,this.collidable=!0,this.activeFrames=0}}),game.StartSnipeEvent=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.collidable=!0,this.type=game.data.STARTSNIPE_TYPE}}),game.StopSnipeEvent=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.collidable=!0,this.type=game.data.STOPSNIPE_TYPE}}),game.VesperadoEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("vesperado-spritesheet"),60,80),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=60,c.spriteheight=80,this.parent(a,b,c),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.renderable.addAnimation("idle",[0,1],100),this.renderable.addAnimation("turnshoot",[2,3,4,5],100),this.renderable.addAnimation("teleport-out",[6,7,8,9,10],100),this.renderable.addAnimation("teleport-in",[10,9,8,7,6],100),this.renderable.addAnimation("die",[11,12,13,14],150),this.renderable.addAnimation("dead",[14]),this.renderable.setCurrentAnimation("idle"),this.invincibleFrames=0,this.health=10,this.isInvincible=!1,this.MAX_INVINCIBLE_FRAMES=60,this.facingLeft=!0,this.delayingFrames=0,this.MAX_DELAY_FRAMES=40,this.isDelaying=!1},update:function(){if(!game.data.isPaused){var a=this.collide();if(!a||a.obj.type!=game.data.SUGARSHOT_TYPE||this.renderable.isCurrentAnimation("die")||this.renderable.isCurrentAnimation("dead")||(game.data.sugarShotOnScreen=!1,me.game.remove(a.obj),this.isInvincible||(me.audio.play("boss-hurt-sfx"),this.health=this.health-1,this.isInvincible=!0,this.health<=0&&(this.renderable.setCurrentAnimation("die"),me.audio.stopTrack("boss")))),this.isInvincible&&(this.renderable.flicker(1),this.invincibleFrames=this.invincibleFrames+1,this.invincibleFrames>=this.MAX_INVINCIBLE_FRAMES&&(this.invincibleFrames=0,this.isInvincible=!1)),this.renderable.isCurrentAnimation("die")&&3===this.renderable.getCurrentAnimationFrame())this.renderable.setCurrentAnimation("dead"),game.data.frameCount=0;else if(this.renderable.isCurrentAnimation("dead"))game.data.frameCount=game.data.frameCount+1,90===game.data.frameCount&&(game.data.isBossDead=!0);else if(this.isDelaying){if(!this.renderable.isCurrentAnimation("die")&&!this.renderable.isCurrentAnimation("dead"))if(this.delayingFrames>=this.MAX_DELAY_FRAMES){this.delayingFrames=0,this.isDelaying=!1,game.data.player.pos.x>this.pos.x&&this.facingLeft?(this.flipX(!0),this.facingLeft=!1):game.data.player.pos.x<this.pos.x&&!this.facingLeft&&(this.flipX(!1),this.facingLeft=!0);var b=Math.random();.4>=b?(this.renderable.setCurrentAnimation("turnshoot"),this.renderable.setAnimationFrame(0)):b>.4&&.8>=b?(this.renderable.setCurrentAnimation("teleport-out"),this.renderable.setAnimationFrame(0)):(this.renderable.setCurrentAnimation("idle"),this.renderable.setAnimationFrame(0))}else this.delayingFrames=this.delayingFrames+1}else this.renderable.isCurrentAnimation("idle")&&1===this.renderable.getCurrentAnimationFrame()||this.renderable.isCurrentAnimation("turnshoot")&&3===this.renderable.getCurrentAnimationFrame()||this.renderable.isCurrentAnimation("teleport-in")&&4===this.renderable.getCurrentAnimationFrame()?(this.renderable.isCurrentAnimation("turnshoot")&&(me.audio.play("sniper-shot-sfx"),this.facingLeft?me.game.add(new game.LinearShot(this.pos.x+8,this.pos.y+40,{image:"vesperado-bullet",spritewidth:20,spriteheight:20},"west",6),this.z):me.game.add(new game.LinearShot(this.pos.x+68,this.pos.y+40,{image:"vesperado-bullet",spritewidth:20,spriteheight:20},"east",6),this.z)),this.isDelaying=!0,this.renderable.setCurrentAnimation("idle"),this.renderable.setAnimationFrame(0)):this.renderable.isCurrentAnimation("teleport-out")&&4==this.renderable.getCurrentAnimationFrame()&&(b=Math.random(),this.pos.x=.33>=b?570:.66>=b?290:10,this.renderable.setCurrentAnimation("teleport-in"),this.renderable.setAnimationFrame(0));return this.parent(),this.updateMovement(),!0}return!1}}),game.VesperadoShadowEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("vesperado-shadow-spritesheet"),45,120),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=45,c.spriteheight=120,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],150),this.renderable.addAnimation("eye",[2,3],200),this.resetState()},update:function(){return game.data.isPaused||(game.stage1_data.snipingStarted&&!this.renderable.isCurrentAnimation("eye")?this.renderable.setCurrentAnimation("eye"):game.stage1_data.snipingComplete&&(this.aliveOnScreen=!1,this.alwaysUpdate=!1,me.game.remove(this)),this.parent(),this.updateMovement()),!0},resetState:function(){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.renderable.setCurrentAnimation("active"),this.collidable=!1}}),game.CatFireball=me.ObjectEntity.extend({init:function(a,b,c,d){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("cat-fireball-spritesheet"),70,32),settings={image:this.renderable.image,spritewidth:32,spriteheight:32},this.renderable.offset.set(0,0),this.parent(a,b,settings),this.renderable.addAnimation("move",[0,1],150),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.gravity=0,this.velocity=d,this.direction=c,this.alwaysUpdate=!1,this.settings=settings,this.renderable.setCurrentAnimation("move")},update:function(){if(game.data.isPaused)return!1;"northwest"===this.direction?(this.pos.x=this.pos.x-this.velocity,this.pos.y=this.pos.y-this.velocity):"northeast"===this.direction?(this.pos.x=this.pos.x+this.velocity,this.pos.y=this.pos.y-this.velocity):"southwest"===this.direction?(this.pos.x=this.pos.x-this.velocity,this.pos.y=this.pos.y+this.velocity):"southeast"===this.direction&&(this.pos.x=this.pos.x+this.velocity,this.pos.y=this.pos.y+this.velocity);this.updateMovement();return(!me.game.viewport.contains(this)||this.pos.x-this.velocity<0||this.pos.x+this.velocity+this.settings.spritewidth>game.data.stageWidth||this.pos.y-this.velocity<20||this.pos.y+this.settings.spriteheight>game.data.stageHeight)&&me.game.remove(this),this.parent(),!0}}),game.FakeNinjaCatEnemy=me.ObjectEntity.extend({init:function(a,b,c,d,e){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("ninja-cat-spritesheet"),64,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=64,c.spriteheight=64,this.parent(a,b,c),this.renderable.addAnimation("teleport",[27,26,25],150),this.renderable.addAnimation("idle",[37]),this.renderable.addAnimation("teleport-left",[33,32,31],150),this.renderable.addAnimation("idle-left",[39]),this.renderable.addAnimation("teleport-right",[30,29,28],150),this.renderable.addAnimation("idle-right",[40]),this.renderable.addAnimation("teleport-up",[36,35,34],150),this.renderable.addAnimation("idle-up",[38],150),this.renderable.addAnimation("wave",[41,42,43,44,45],150),this.renderable.addAnimation("wave-left",[46,47,48,49,50],150),this.renderable.addAnimation("wave-right",[51,52,53,54,55],150),this.renderable.addAnimation("wave-up",[56,57,57,58,59],150),this.renderable.addAnimation("flame",[60,61,62,63,64],150),this.renderable.addAnimation("flame-left",[65,66,67,68,69],150),this.renderable.addAnimation("flame-right",[70,71,72,73,74],150),this.renderable.addAnimation("flame-up",[75,76,77,78,79],150),this.resetState(d,e)},update:function(){var a=!1;return game.data.isPaused||(this.framesPassed<=145?this.framesPassed=this.framesPassed+1:this.framesPassed>=146&&(0===this.type?this.renderable.isCurrentAnimation("idle")?(this.renderable.setCurrentAnimation("wave"),me.game.add(new game.Wave(this.pos.x,this.pos.y,"west",3),this.z),me.game.add(new game.Wave(this.pos.x,this.pos.y,"east",3),this.z)):this.renderable.isCurrentAnimation("idle-up")?(this.renderable.setCurrentAnimation("wave-up"),me.game.add(new game.Wave(this.pos.x,this.pos.y,"west",3),this.z),me.game.add(new game.Wave(this.pos.x,this.pos.y,"east",3),this.z)):this.renderable.isCurrentAnimation("idle-left")?(this.renderable.setCurrentAnimation("wave-left"),me.game.add(new game.Wave(this.pos.x,this.pos.y,"north",3),this.z),me.game.add(new game.Wave(this.pos.x,this.pos.y,"south",3),this.z)):this.renderable.isCurrentAnimation("idle-right")&&(this.renderable.setCurrentAnimation("wave-right"),me.game.add(new game.Wave(this.pos.x,this.pos.y,"north",3),this.z),me.game.add(new game.Wave(this.pos.x,this.pos.y,"south",3),this.z)):this.renderable.isCurrentAnimation("idle")?(this.renderable.setCurrentAnimation("flame"),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"northeast",1.5),this.z),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"northwest",1.5),this.z)):this.renderable.isCurrentAnimation("idle-up")?(this.renderable.setCurrentAnimation("flame-up"),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"southwest",1.5),this.z),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"southeast",1.5),this.z)):this.renderable.isCurrentAnimation("idle-left")?(this.renderable.setCurrentAnimation("flame-left"),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"southeast",1.5),this.z),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"northeast",1.5),this.z)):this.renderable.isCurrentAnimation("idle-right")&&(this.renderable.setCurrentAnimation("flame-right"),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"northwest",1.5),this.z),me.game.add(new game.CatFireball(this.pos.x,this.pos.y,"southwest",1.5),this.z))),2===this.renderable.getCurrentAnimationFrame()&&(this.renderable.isCurrentAnimation("teleport")?this.renderable.setCurrentAnimation("idle"):this.renderable.isCurrentAnimation("teleport-up")?this.renderable.setCurrentAnimation("idle-up"):this.renderable.isCurrentAnimation("teleport-left")?this.renderable.setCurrentAnimation("idle-left"):this.renderable.isCurrentAnimation("teleport-right")&&this.renderable.setCurrentAnimation("idle-right")),4===this.renderable.getCurrentAnimationFrame()&&me.game.remove(this),this.parent(),this.updateMovement(),a=!0),a},resetState:function(a,b){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.type=b,this.framesPassed=0,"down"===a?this.renderable.setCurrentAnimation("teleport"):"up"===a?this.renderable.setCurrentAnimation("teleport-up"):"left"===a?this.renderable.setCurrentAnimation("teleport-left"):"right"===a&&this.renderable.setCurrentAnimation("teleport-right")}}),game.NinjaCatEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("ninja-cat-spritesheet"),64,64),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=64,c.spriteheight=64,this.parent(a,b,c),this.renderable.addAnimation("idle",[0,1],150),this.renderable.addAnimation("teleport",[2,3,4],150),this.renderable.addAnimation("teleport-in",[4,3,2],150),this.renderable.addAnimation("idle-left",[5,6],150),this.renderable.addAnimation("teleport-left",[7,8,9],150),this.renderable.addAnimation("teleport-in-left",[9,8,7],150),this.renderable.addAnimation("idle-right",[10,11],150),this.renderable.addAnimation("teleport-right",[12,13,14],150),this.renderable.addAnimation("teleport-in-right",[14,13,12],150),this.renderable.addAnimation("idle-up",[15,16],150),this.renderable.addAnimation("teleport-up",[17,18,19],150),this.renderable.addAnimation("teleport-in-up",[19,18,17],150),this.renderable.addAnimation("dying",[20,21,22,23,24],150),this.renderable.addAnimation("dead",[24],150),this.resetState()},playAttackSFX:function(){me.audio.play(0===this.typeSeed?"cat-wave-sfx":"cat-flame-sfx")},update:function(){var a=!1;if(!game.data.isPaused){var b=this.collide();if(!b||b.obj.type!==game.data.PLAYER_TYPE||this.renderable.isCurrentAnimation("dying")||this.renderable.isCurrentAnimation("dead")?b&&b.obj.type==game.data.SUGARSHOT_TYPE&&!(this.renderable.isCurrentAnimation("teleport")||this.renderable.isCurrentAnimation("teleport-left")||this.renderable.isCurrentAnimation("teleport-up")||this.renderable.isCurrentAnimation("teleport-right"))&&(game.data.sugarShotOnScreen=!1,me.game.remove(b.obj),this.isInvincible||(me.audio.play("boss-hurt-sfx"),this.health=this.health-1,this.isInvincible=!0,this.health<=0&&(this.pos.x=288,this.pos.y=288,this.renderable.setCurrentAnimation("dying"),me.audio.stopTrack("boss")))):game.data.player.hit(),this.isInvincible&&(this.renderable.flicker(1),this.invincibleFrames=this.invincibleFrames+1,this.invincibleFrames>=this.MAX_INVINCIBLE_FRAMES&&(this.invincibleFrames=0,this.isInvincible=!1)),this.renderable.isCurrentAnimation("teleport-in")&&2===this.renderable.getCurrentAnimationFrame()?this.renderable.setCurrentAnimation("idle"):this.renderable.isCurrentAnimation("teleport-in-left")&&2===this.renderable.getCurrentAnimationFrame()?this.renderable.setCurrentAnimation("idle-left"):this.renderable.isCurrentAnimation("teleport-in-right")&&2===this.renderable.getCurrentAnimationFrame()?this.renderable.setCurrentAnimation("idle-right"):this.renderable.isCurrentAnimation("teleport-in-up")&&2===this.renderable.getCurrentAnimationFrame()&&this.renderable.setCurrentAnimation("idle-up"),this.framesPassed<=150&&!this.renderable.isCurrentAnimation("dead"))this.framesPassed=this.framesPassed+1;else if(this.renderable.isCurrentAnimation("idle"))this.initialView||this.playAttackSFX(),this.renderable.setCurrentAnimation("teleport"),this.renderable.setAnimationFrame(0),this.initialView=!1;else if(this.renderable.isCurrentAnimation("idle-left"))this.initialView||this.playAttackSFX(),this.renderable.setCurrentAnimation("teleport-left"),this.renderable.setAnimationFrame(0),this.initialView=!1;else if(this.renderable.isCurrentAnimation("idle-right"))this.renderable.setCurrentAnimation("teleport-right"),this.renderable.setAnimationFrame(0),this.initialView||this.playAttackSFX(),this.initialView=!1;else if(this.renderable.isCurrentAnimation("idle-up"))this.renderable.setCurrentAnimation("teleport-up"),this.renderable.setAnimationFrame(0),this.initialView||this.playAttackSFX(),this.initialView=!1;else if(this.renderable.isCurrentAnimation("teleport")&&2===this.renderable.getCurrentAnimationFrame()||this.renderable.isCurrentAnimation("teleport-left")&&2===this.renderable.getCurrentAnimationFrame()||this.renderable.isCurrentAnimation("teleport-right")&&2===this.renderable.getCurrentAnimationFrame()||this.renderable.isCurrentAnimation("teleport-up")&&2===this.renderable.getCurrentAnimationFrame()){var c=Math.floor(4*Math.random());if(this.typeSeed=Math.floor(2*Math.random()),0===c)this.renderable.setCurrentAnimation("teleport-in"),this.pos.x=288,this.pos.y=288,me.game.add(new game.FakeNinjaCatEnemy(288,32,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"up",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(32,160,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"left",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(544,160,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"right",this.typeSeed),this.z);else if(1===c){this.renderable.setCurrentAnimation("teleport-in-up"),this.pos.x=288,this.pos.y=32;{Math.floor(2*Math.random())}me.game.add(new game.FakeNinjaCatEnemy(288,288,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"down",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(32,160,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"left",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(544,160,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"right",this.typeSeed),this.z)}else if(2===c){this.renderable.setCurrentAnimation("teleport-in-left"),this.pos.x=32,this.pos.y=160;{Math.floor(2*Math.random())}me.game.add(new game.FakeNinjaCatEnemy(288,32,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"up",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(288,288,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"down",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(544,160,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"right",this.typeSeed),this.z)}else if(3===c){this.renderable.setCurrentAnimation("teleport-in-right"),this.pos.x=544,this.pos.y=160;{Math.floor(2*Math.random())}me.game.add(new game.FakeNinjaCatEnemy(288,32,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"up",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(288,288,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"down",this.typeSeed),this.z),me.game.add(new game.FakeNinjaCatEnemy(32,160,{image:"ninja-cat-spritesheet",spritewidth:64,spriteheight:64},"left",this.typeSeed),this.z)}this.renderable.setAnimationFrame(0),this.framesPassed=0}this.renderable.isCurrentAnimation("dying")&&4===this.renderable.getCurrentAnimationFrame()?(this.renderable.setCurrentAnimation("dead"),this.framesPassed=0):this.renderable.isCurrentAnimation("dead")&&(this.framesPassed=this.framesPassed+1,90===this.framesPassed&&(game.data.isBossDead=!0)),this.parent(),this.updateMovement(),a=!0}return a},resetState:function(){this.MAX_INVINCIBLE_FRAMES=60,this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.framesPassed=0,this.gravity=0,this.invincibleFrames=0,this.renderable.setCurrentAnimation("idle"),this.collidable=!0,this.health=7,this.initialView=!0,this.typeSeed=0}}),game.ParrotEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("parrot-spritesheet"),50,50),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=50,c.spriteheight=50,this.parent(a,b,c),this.updateColRect(4,46,-1,50),this.renderable.addAnimation("fly",[0,1,2,3],150),this.renderable.addAnimation("freeze",[4,5,6,7],150),this.renderable.addAnimation("frozen",[7],150),this.resetState()},update:function(){var a=!1;if(this.inViewport&&!game.data.isPaused){this.parent(),this.updateMovement();var b=this.collide();b&&b.obj.type===game.data.PLAYER_TYPE&&!this.isRetreating?(this.isRetreating=!0,this.isRetreatingLeft=b.obj.pos.x<this.pos.x):b&&b.obj.type===game.data.SUGARSHOT_TYPE?(game.data.sugarShotOnScreen=!1,me.game.remove(b.obj),this.aliveOnScreen&&(me.audio.play("freeze-sfx"),game.data.playerScore=game.data.playerScore+100,this.gravity=1,this.aliveOnScreen=!1,this.vel.x=0,this.type=game.data.PLATFORM_TYPE,this.renderable.setCurrentAnimation("freeze","frozen"))):this.isRetreating&&this.aliveOnScreen?this.retreatingDistance<this._maxRetreatingDistance?(this.isRetreatingLeft?(this.pos.x+2*this._xSpeed<game.data.stageWidth&&(this.pos.x=this.pos.x+2*this._xSpeed),this.pos.y-2*this._ySpeed>0&&(this.pos.y=this.pos.y-2*this._ySpeed)):(this.pos.x-2*this._xSpeed>0&&(this.pos.x=this.pos.x-2*this._xSpeed),this.pos.y-2*this._ySpeed>0&&(this.pos.y=this.pos.y-2*this._ySpeed)),this.retreatingDistance=this.retreatingDistance+2*this._xSpeed+2*this._ySpeed):this.pauseFrames<this._maxPauseFrames?this.pauseFrames=this.pauseFrames+1:(this.pauseFrames=0,this.retreatingDistance=0,this.isRetreating=!1,this.isChasing=!1):this.aliveOnScreen&&game.data.player.distanceTo(this)<=this._triggerRadius?(this.isChasing||(me.audio.play("parrot-sfx"),this.isChasing=!0),this.pos.x=game.data.player.pos.x<=this.pos.x?this.pos.x-this._xSpeed:this.pos.x+this._xSpeed,this.pos.y=game.data.player.pos.y<=this.pos.y?this.pos.y-this._ySpeed:this.pos.y+this._ySpeed):this.isChasing=!1,a=!0}return a},resetState:function(){this._triggerRadius=250,this._xSpeed=2,this._ySpeed=2,this.collidable=!0,this.aliveOnScreen=!0,this.isChasing=!1,this.isRetreating=!1,this.isRetreatingLeft=!1,this.retreatingDistance=0,this._maxRetreatingDistance=200,this.pauseFrames=0,this._maxPauseFrames=150,this.type=me.game.ENEMY_OBJECT,this.gravity=0,this.renderable.setCurrentAnimation("fly")}}),game.PixieEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("pixie-spritesheet"),64,88),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=64,c.spriteheight=88,this.parent(a,b,c),this.renderable.addAnimation("walk",[2,3,4,3,2,1,0,1],75),this.renderable.addAnimation("freeze",[5,6,7,8],75),this.renderable.addAnimation("frozen",[8],150),this.resetState()},update:function(){if(!game.data.isPaused){this.activeFrames=this.activeFrames+1;var a=this.collide();return this.aliveOnScreen&&(a&&a.obj.type===game.data.SUGARSHOT_TYPE?(game.data.sugarShotOnScreen=!1,me.game.remove(a.obj),this.aliveOnScreen&&(me.audio.play("freeze-sfx"),game.data.playerScore=game.data.playerScore+100,this.gravity=1,this.aliveOnScreen=!1,this.vel.x=0,this.type=game.data.PLATFORM_TYPE,this.renderable.setCurrentAnimation("freeze","frozen"))):(this.goingLeft?null!==me.game.collisionMap.getTile(this.pos.x,this.pos.y+this.height)&&null===me.game.collisionMap.getTile(this.pos.x,this.pos.y)?(this.vel.x-=this.accel.x*me.timer.tick,this.flipX(!1)):(this.goingLeft=!1,this.vel.x+=this.accel.x*me.timer.tick,this.flipX(!0)):null!==me.game.collisionMap.getTile(this.pos.x+this.width,this.pos.y+this.height)&&null===me.game.collisionMap.getTile(this.pos.x+this.width+1,this.pos.y)?(this.vel.x+=this.accel.x*me.timer.tick,this.flipX(!0)):(this.goingLeft=!0,this.vel.x-=this.accel.x*me.timer.tick,this.flipX(!1)),this.inViewport&&-1===this.framesShot&&(this.goingLeft===!1&&game.data.player.pos.x>this.pos.x&&game.data.player.pos.y>=this.pos.y&&game.data.player.pos.y<=this.pos.y+88?(me.audio.play("pixie-shot-sfx"),me.game.add(new game.PixieShot(this.pos.x,this.pos.y+40,{image:"pixie-shot-spritesheet",spritewidth:50,spriteheight:50},"east",1),this.z),this.framesShot=0):this.goingLeft&&game.data.player.pos.x<this.pos.x&&game.data.player.pos.y>=this.pos.y&&game.data.player.pos.y<=this.pos.y+88&&(me.audio.play("pixie-shot-sfx"),me.game.add(new game.PixieShot(this.pos.x,this.pos.y+40,{image:"pixie-shot-spritesheet",spritewidth:50,spriteheight:50},"west",1),this.z),this.framesShot=0)),this.framesShot>-1&&(this.framesShot=this.framesShot+1,this.framesShot>=300&&(this.framesShot=-1)))),this.parent(),this.updateMovement(),!0}return!1},resetState:function(){this.collidable=!0,this.aliveOnScreen=!0,this.type=me.game.ENEMY_OBJECT,this.goingLeft=!0,this.setVelocity(.5,15),this.renderable.setCurrentAnimation("walk"),this.framesShot=-1}}),game.PixieShot=me.ObjectEntity.extend({init:function(a,b,c,d,e){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("pixie-shot-spritesheet"),50,50),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=50,c.spriteheight=50,this.parent(a,b,c),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.gravity=0,this.velocity=e,this.direction=d,this.alwaysUpdate=!0},update:function(){if(game.data.isPaused)return!1;"west"===this.direction&&this.pos.x-this.velocity>0?this.pos.x=this.pos.x-this.velocity:"east"===this.direction&&this.pos.x+this.velocity+this.width+1<game.data.stageWidth?this.pos.x=this.pos.x+this.velocity:"south"===this.direction&&this.pos.y+this.velocity+this.height+1<game.data.stageHeight?this.pos.y=this.pos.y+this.velocity:"north"===this.direction&&this.pos.y-this.velocity>0?this.pos.y=this.pos.y-this.velocity:me.game.remove(this);this.updateMovement();return this.inViewport||me.game.remove(this),this.parent(),!0}}),game.PopoutFishEnemy=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("popout-fish-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("idle",[0,1],150),this.renderable.addAnimation("watching",[2,3,4,5],150),this.renderable.addAnimation("waiting",[4,5],150),this.renderable.addAnimation("eating",[6,7,8],100),this.renderable.addAnimation("hiding",[6,5,4,3,2],100),this.updateColRect(6,20,6,20),this.resetState()},update:function(){var a=!1;if(!game.data.isPaused){if(this.aliveOnScreen){game.data.player.distanceTo(this)<=this._watchingTriggerRadius&&this.renderable.isCurrentAnimation("idle")?(me.audio.play("popout-fish-splash-sfx"),this.renderable.setCurrentAnimation("watching","waiting")):game.data.player.distanceTo(this)<=this._eatingTriggerRadius&&this.renderable.isCurrentAnimation("waiting")?(this.renderable.setCurrentAnimation("eating"),me.audio.play("popout-fish-eat-sfx")):!this.renderable.isCurrentAnimation("idle")&&!this.renderable.isCurrentAnimation("hiding")&&game.data.player.distanceTo(this)>this._watchingTriggerRadius&&this.renderable.setCurrentAnimation("hiding","idle");var b=this.collide();b&&b.obj.type===game.data.PLAYER_TYPE&&this.renderable.isCurrentAnimation("eating")&&game.data.player.hit()}this.parent(),this.updateMovement(),a=!0}return a},resetState:function(){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.renderable.setCurrentAnimation("idle"),this.collidable=!1,this._watchingTriggerRadius=250,this._eatingTriggerRadius=125}}),game.RaftEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("raft"),200,50),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=200,c.spriteheight=50,this.parent(a,b,c),this.aliveOnScreen=this.inViewPort,this.alwaysUpdate=!0,this.resetState()},update:function(){if(!game.data.isPaused){var a=this.collide();a&&a.obj.type===game.data.PLAYER_TYPE&&(this.isMoving=!0),this.isMoving&&(this.pos.x=this.pos.x+this.rate,0===game.data.player.vel.x&&0===game.data.player.vel.y&&game.data.player.pos.x+40>this.pos.x&&game.data.player.pos.x<this.pos.x+200&&this.pos.y-game.data.player.pos.y<=40&&(game.data.player.pos.x=game.data.player.pos.x+this.rate))}return!0},resetState:function(){this.activeFrames=0,this.rate=2,this.isMoving=!1,this.collidable=!0,this.aliveOnScreen=!0,this.gravity=0,this.type=game.data.SOLID_TYPE}}),game.RotateLeftEvent=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.collidable=!0,this.type=game.data.ROTATELEFT_TYPE}}),game.RotateRightEvent=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.collidable=!0,this.type=game.data.ROTATERIGHT_TYPE}}),game.WaterEvent=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.collidable=!0,this.type=game.data.WATER_TYPE}}),game.WaterfallBaseEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("waterfall-base-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],150),this.resetState()},update:function(){var a=!1;return game.data.isPaused||(this.parent(),this.updateMovement()),a},resetState:function(){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.renderable.setCurrentAnimation("active"),this.collidable=!1}}),game.WaterfallEntity=me.ObjectEntity.extend({init:function(a,b,c){this.renderable=new me.SpriteObject(0,0,me.loader.getImage("waterfall-spritesheet"),32,32),this.renderable.offset.set(0,0),c.image=this.renderable.image,c.spritewidth=32,c.spriteheight=32,this.parent(a,b,c),this.renderable.addAnimation("active",[0,1],150),this.resetState()},update:function(){var a=!1;return game.data.isPaused||(this.parent(),this.updateMovement()),a},resetState:function(){this.aliveOnScreen=!0,this.alwaysUpdate=!0,this.gravity=0,this.renderable.setCurrentAnimation("active"),this.collidable=!1}}),game.Wave=me.ObjectEntity.extend({init:function(a,b,c,d){"west"===c||"east"===c?(this.renderable=new me.SpriteObject(0,0,me.loader.getImage("wave-spritesheet-lr"),32,70),settings={image:this.renderable.image,spritewidth:32,spriteheight:70},this.renderable.offset.set(0,0),this.parent(a,b,settings),this.renderable.addAnimation("flow-right",[0,1],150),this.renderable.addAnimation("flow-left",[2,3],150)):(this.renderable=new me.SpriteObject(0,0,me.loader.getImage("wave-spritesheet-ud"),70,32),settings={image:this.renderable.image,spritewidth:70,spriteheight:32},this.renderable.offset.set(0,0),this.parent(a,b,settings),this.renderable.addAnimation("flow-up",[0,1],150),this.renderable.addAnimation("flow-down",[2,3],150)),this.collidable=!0,this.type=me.game.ENEMY_OBJECT,this.gravity=0,this.velocity=d,this.direction=c,this.alwaysUpdate=!1,this.settings=settings,"west"===this.direction?this.renderable.setCurrentAnimation("flow-left"):"east"===this.direction?this.renderable.setCurrentAnimation("flow-right"):"north"===this.direction?this.renderable.setCurrentAnimation("flow-up"):"south"===this.direction&&this.renderable.setCurrentAnimation("flow-down")},update:function(){if(game.data.isPaused)return!1;"west"===this.direction?this.pos.x=this.pos.x-this.velocity:"east"===this.direction?this.pos.x=this.pos.x+this.velocity:"south"===this.direction?this.pos.y=this.pos.y+this.velocity:"north"===this.direction&&(this.pos.y=this.pos.y-this.velocity);this.updateMovement();return(!me.game.viewport.contains(this)||this.pos.x-this.velocity<0||this.pos.x+this.velocity+this.settings.spritewidth>game.data.stageWidth||this.pos.y-this.velocity<20||this.pos.y+this.settings.spriteheight>game.data.stageHeight)&&me.game.remove(this),this.parent(),!0}}),game.HUD=game.HUD||{},game.HUD.Container=me.ObjectContainer.extend({init:function(){this.parent(),this.isPersistent=!0,this.collidable=!1,this.z=1/0,this.name="HUD",this.addChild(new game.HUD.EnergyBar1(400,435)),this.addChild(new game.HUD.EnergyBar2(440,435)),this.addChild(new game.HUD.EnergyBar3(480,435)),this.addChild(new game.HUD.EnergyBar4(520,435)),this.addChild(new game.HUD.HUDLabels(100,410)),this.addChild(new game.HUD.Background(0,400))}}),game.HUD.Background=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.floating=!0,this.image=me.loader.getImage("hud")},draw:function(a){a.drawImage(this.image,this.pos.x,this.pos.y)}}),game.HUD.HUDLabels=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.floating=!0,this.font=new me.Font("Varela Round","20px","#ffffff"),this.playerlives=0,this.playerScore=-1},update:function(){var a=!1;return this.playerLives!==game.data.playerLives&&(this.playerLives=game.data.playerLives,a=!0),this.score!==game.data.playerScore&&(this.score=game.data.playerScore,a=!0),a
},draw:function(a){this.font.draw(a,"LIVES:",this.pos.x,this.pos.y),this.font.draw(a,"x"+game.data.playerLives,this.pos.x,this.pos.y+20),this.font.draw(a,"SCORE:",this.pos.x+150,this.pos.y),this.font.draw(a,game.data.playerScore,this.pos.x+150,this.pos.y+20),this.font.draw(a,"ENERGY:",this.pos.x+300,this.pos.y)}}),game.HUD.EnergyBar1=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.floating=!0,this.image=me.loader.getImage("health-meter-1")},draw:function(a){game.data.playerHealth>=1&&a.drawImage(this.image,this.pos.x,this.pos.y)}}),game.HUD.EnergyBar2=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.floating=!0,this.image=me.loader.getImage("health-meter-2")},draw:function(a){game.data.playerHealth>=2&&a.drawImage(this.image,this.pos.x,this.pos.y)}}),game.HUD.EnergyBar3=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.floating=!0,this.image=me.loader.getImage("health-meter-3")},draw:function(a){game.data.playerHealth>=3&&a.drawImage(this.image,this.pos.x,this.pos.y)}}),game.HUD.EnergyBar4=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.floating=!0,this.image=me.loader.getImage("health-meter-4")},draw:function(a){4==game.data.playerHealth&&a.drawImage(this.image,this.pos.x,this.pos.y)}}),game.dialog=game.dialog||{},game.dialog.Container=me.ObjectContainer.extend({init:function(a,b){this.parent(),this.isPersistent=!0,this.collidable=!1,this.z=1/0,this.floating=!0,this.name="pause",this.addChild(new game.dialog.Message(0,0,a,b))}}),game.dialog.Message=me.Renderable.extend({init:function(a,b,c,d){this.parent(new me.Vector2d(a,b),10,10),this.font=new me.Font("Varela Round","20px","#ffffff"),this.floating=!0,this.image=me.loader.getImage(c),this.text=d},draw:function(a){a.drawImage(me.loader.getImage("dialog"),this.pos.x,this.pos.y),a.drawImage(this.image,20,10),this.font.draw(a,this.text,this.pos.x+100,this.pos.y+30)}}),game.pause=game.pause||{},game.pause.Container=me.ObjectContainer.extend({init:function(){this.parent(),this.isPersistent=!0,this.collidable=!1,this.z=1/0,this.name="pause",this.addChild(new game.pause.Message(220,150))}}),game.pause.Message=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.font=new me.Font("Varela Round","20px","#ffffff"),this.floating=!0,this.image=me.loader.getImage("pause")},draw:function(a){a.drawImage(this.image,this.pos.x,this.pos.y),this.font.draw(a,"PAUSED",this.pos.x+60,this.pos.y+30)}}),game.IntroScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.image=me.loader.getImage("logo"),this.x=0,this.y=0},onDestroyEvent:function(){},onResetEvent:function(){me.audio.play("intro"),game.data.frameCount=0},draw:function(a){a.fillStyle="#000",a.fillRect(0,0,640,480),a.drawImage(this.image,this.x,this.y)},update:function(){return this.y<=180&&(this.y=this.y+1),game.data.frameCount=game.data.frameCount+1,game.data.frameCount>=360&&me.state.change(game.screen_data.TITLE),!0}}),game.TitleScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.Title={frame_1:me.loader.getImage("title-1"),frame_2:me.loader.getImage("title-2")},this.Action={text:"Press Start!",x:50,y:250,font:new me.Font("Varela Round","30px","#fff"),bFont:new me.Font("Varela Round","30px","#000")},this.Credits={text:"April Release - Olin Gallet, 2016",x:50,y:450,font:new me.Font("Varela Round","20px","#fff")},this.Menu={StartOption:{text:"Start Game",x:70,y:250,font:new me.Font("Varela Round","30px","#fff")},ConfigOption:{text:"Configuration",x:70,y:320,font:new me.Font("Varela Round","30px","#fff")}},this.State={MenuStateList:{PRESS_START_STATE:0,SELECT_OPTION_STATE:1},OptionStateList:{START_OPTION_STATE:0,CONFIG_OPTION_STATE:1},menuState:0,optionState:0},this.Cursor={image:me.loader.getImage("title-cursor"),x:40,y:260,Positions:{StartOption:{x:40,y:260},ConfigOption:{x:40,y:330}}},this.Name={image:me.loader.getImage("title-name"),x:50,y:100}},onResetEvent:function(){me.audio.playTrack("title-screen"),game.data.frameCount=0,game.data.playerLives=99,game.data.playerScore=0,game.data.playerHealth=4,this.isLocked=!1,this.State.menuState=this.State.MenuStateList.PRESS_START_STATE,game.data.inputObserver.resetState(),game.data.inputObserver.isAcceptingInput=!0},onDestroyEvent:function(){},draw:function(a){game.data.frameCount<=15||game.data.frameCount>=30&&game.data.frameCount<=45?a.drawImage(this.Title.frame_1,0,0):a.drawImage(this.Title.frame_2,0,0),this.Credits.font.draw(a,this.Credits.text,this.Credits.x,this.Credits.y),a.drawImage(this.Name.image,this.Name.x,this.Name.y),this.State.menuState===this.State.MenuStateList.PRESS_START_STATE?(game.data.frameCount<=30?this.Action.font.draw(a,this.Action.text,this.Action.x,this.Action.y):game.data.frameCount<60?this.Action.bFont.draw(a,this.Action.text,this.Action.x,this.Action.y):game.data.frameCount>=60&&(game.data.frameCount=0),game.data.frameCount=game.data.frameCount+1):this.State.menuState===this.State.MenuStateList.SELECT_OPTION_STATE&&(this.Menu.StartOption.font.draw(a,this.Menu.StartOption.text,this.Menu.StartOption.x,this.Menu.StartOption.y),this.Menu.ConfigOption.font.draw(a,this.Menu.ConfigOption.text,this.Menu.ConfigOption.x,this.Menu.ConfigOption.y),a.drawImage(this.Cursor.image,this.Cursor.x,this.Cursor.y))},update:function(){return this.State.menuState===this.State.MenuStateList.PRESS_START_STATE&&game.data.inputObserver.isPausePressed()&&game.data.inputObserver.isAcceptingInput?(me.audio.stop("title-screen"),this.State.menuState=this.State.MenuStateList.SELECT_OPTION_STATE,me.audio.play("game-start"),game.data.inputObserver.isAcceptingInput=!1,game.data.frameCount=0):this.State.menuState!==this.State.MenuStateList.SELECT_OPTION_STATE||this.isLocked||(game.data.inputObserver.isAcceptingInput?game.data.inputObserver.isUpPressed()&&this.State.optionState===this.State.OptionStateList.CONFIG_OPTION_STATE?(game.data.inputObserver.isAcceptingInput=!1,this.Cursor.x=this.Cursor.Positions.StartOption.x,this.Cursor.y=this.Cursor.Positions.StartOption.y,this.State.optionState=this.State.OptionStateList.START_OPTION_STATE,me.audio.play("select-sfx")):game.data.inputObserver.isDownPressed()&&this.State.optionState===this.State.OptionStateList.START_OPTION_STATE?(game.data.inputObserver.isAcceptingInput=!1,this.Cursor.x=this.Cursor.Positions.ConfigOption.x,this.Cursor.y=this.Cursor.Positions.ConfigOption.y,this.State.optionState=this.State.OptionStateList.CONFIG_OPTION_STATE,me.audio.play("select-sfx")):this.State.optionState===this.State.OptionStateList.START_OPTION_STATE&&(game.data.inputObserver.isPausePressed()||game.data.inputObserver.isShootPressed())?(game.data.inputObserver.isAcceptingInput=!1,this.isLocked=!0,me.audio.play("game-start",!1,function(){me.state.change(game.data.showIntros?game.level_data.STAGE1_MOVIE:game.level_data.STAGE1)})):this.State.optionState===this.State.OptionStateList.CONFIG_OPTION_STATE&&(game.data.inputObserver.isPausePressed()||game.data.inputObserver.isShootPressed())&&(game.data.inputObserver.isAcceptingInput=!1,me.state.change(game.screen_data.CONFIG)):(game.data.frameCount=game.data.frameCount+1,game.data.frameCount>30&&(game.data.inputObserver.isAcceptingInput=!0))),!0}}),game.ConfigScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.image=me.loader.getImage("title"),this.IntrosLabel={text:"Intros",x:60,y:50,font:new me.Font("Varela Round","30px","#fff")},this.DialogsLabel={text:"Dialogs",x:60,y:150,font:new me.Font("Varela Round","30px","#fff")},this.ExitLabel={text:"Exit",x:60,y:400,font:new me.Font("Varela Round","30px","#fff")},this.YesIntrosLabel={text:"Yes",x:310,y:50,font:new me.Font("Varela Round","30px","#fff")},this.NoIntrosLabel={text:"No",x:410,y:50,font:new me.Font("Varela Round","30px","#fff")},this.YesDialogsLabel={text:"Yes",x:310,y:150,font:new me.Font("Varela Round","30px","#fff")},this.NoDialogsLabel={text:"No",x:410,y:150,font:new me.Font("Varela Round","30px","#fff")},this.Font={ON:new me.Font("Varela Round","30px","#77add9"),OFF:new me.Font("Varela Round","30px","#fff")},game.data.showIntros?(this.YesIntrosLabel.font=this.Font.ON,this.NoIntrosLabel.font=this.Font.OFF):(this.YesIntrosLabel.font=this.Font.OFF,this.NoIntrosLabel.font=this.Font.ON),game.data.showDialogs?(this.YesDialogsLabel.font=this.Font.ON,this.NoDialogsLabel.font=this.Font.OFF):(this.YesDialogsLabel.font=this.Font.OFF,this.NoDialogsLabel.font=this.Font.ON),this.State={MenuStateList:{INTROS_OPTION_STATE:0,DIALOGS_OPTION_STATE:1,EXIT_OPTION_STATE:2},menuState:0},this.Cursor={image:me.loader.getImage("title-cursor"),x:10,y:60,Positions:{IntrosOption:{x:10,y:60},DialogsOption:{x:10,y:160},ExitOption:{x:10,y:410}}}},onResetEvent:function(){game.data.inputObserver.resetState(),game.data.inputObserver.isAcceptingInput=!0,game.data.frameCount=0,this.isLocked=!1,this.State.menuState=0,this.Cursor.x=10,this.Cursor.y=60},onDestroyEvent:function(){},draw:function(a){a.fillStyle="#000",a.fillRect(0,0,640,480),a.drawImage(this.Cursor.image,this.Cursor.x,this.Cursor.y),this.IntrosLabel.font.draw(a,this.IntrosLabel.text,this.IntrosLabel.x,this.IntrosLabel.y),this.DialogsLabel.font.draw(a,this.DialogsLabel.text,this.DialogsLabel.x,this.DialogsLabel.y),this.ExitLabel.font.draw(a,this.ExitLabel.text,this.ExitLabel.x,this.ExitLabel.y),this.YesIntrosLabel.font.draw(a,this.YesIntrosLabel.text,this.YesIntrosLabel.x,this.YesIntrosLabel.y),this.NoIntrosLabel.font.draw(a,this.NoIntrosLabel.text,this.NoIntrosLabel.x,this.NoIntrosLabel.y),this.YesDialogsLabel.font.draw(a,this.YesDialogsLabel.text,this.YesDialogsLabel.x,this.YesDialogsLabel.y),this.NoDialogsLabel.font.draw(a,this.NoDialogsLabel.text,this.NoDialogsLabel.x,this.NoDialogsLabel.y)},update:function(){var a=!1;return this.isLocked||(game.data.inputObserver.isAcceptingInput?this.State.menuState===this.State.MenuStateList.INTROS_OPTION_STATE?game.data.inputObserver.isDownPressed()?(this.State.menuState=this.State.MenuStateList.DIALOGS_OPTION_STATE,this.Cursor.y=this.Cursor.Positions.DialogsOption.y,game.data.inputObserver.isAcceptingInput=!1,a=!0,me.audio.play("select-sfx")):game.data.inputObserver.isRightPressed()&&game.data.showIntros?(this.YesIntrosLabel.font=this.Font.OFF,this.NoIntrosLabel.font=this.Font.ON,game.data.showIntros=!1,a=!0,me.audio.play("select-sfx")):game.data.inputObserver.isLeftPressed()&&!game.data.showIntros&&(this.YesIntrosLabel.font=this.Font.ON,this.NoIntrosLabel.font=this.Font.OFF,game.data.showIntros=!0,a=!0,me.audio.play("select-sfx")):this.State.menuState===this.State.MenuStateList.DIALOGS_OPTION_STATE?game.data.inputObserver.isUpPressed()?(this.State.menuState=this.State.MenuStateList.INTROS_OPTION_STATE,this.Cursor.y=this.Cursor.Positions.IntrosOption.y,game.data.inputObserver.isAcceptingInput=!1,a=!0,me.audio.play("select-sfx")):game.data.inputObserver.isDownPressed()?(this.State.menuState=this.State.MenuStateList.EXIT_OPTION_STATE,this.Cursor.y=this.Cursor.Positions.ExitOption.y,game.data.inputObserver.isAcceptingInput=!1,a=!0,me.audio.play("select-sfx")):game.data.inputObserver.isRightPressed()&&game.data.showDialogs?(this.YesDialogsLabel.font=this.Font.OFF,this.NoDialogsLabel.font=this.Font.ON,game.data.showDialogs=!1,a=!0,me.audio.play("select-sfx")):game.data.inputObserver.isLeftPressed()&&!game.data.showDialogs&&(this.YesDialogsLabel.font=this.Font.ON,this.NoDialogsLabel.font=this.Font.OFF,game.data.showDialogs=!0,a=!0,me.audio.play("select-sfx")):this.State.menuState===this.State.MenuStateList.EXIT_OPTION_STATE&&(game.data.inputObserver.isUpPressed()?(this.State.menuState=this.State.MenuStateList.DIALOGS_OPTION_STATE,this.Cursor.y=this.Cursor.Positions.DialogsOption.y,game.data.inputObserver.isAcceptingInput=!1,a=!0,me.audio.play("select-sfx")):(game.data.inputObserver.isPausePressed()||game.data.inputObserver.isShootPressed())&&(game.data.inputObserver.isAcceptingInput=!1,this.isLocked=!0,me.state.change(game.screen_data.TITLE))):(game.data.frameCount=game.data.frameCount+1,game.data.frameCount>=30&&(game.data.inputObserver.isAcceptingInput=!0,game.data.frameCount=0))),a}}),game.Stage1Movie=me.ScreenObject.extend({init:function(){this.parent(!0)},onDestroyEvent:function(){},onResetEvent:function(){game.data.frameCount=0,this.images=[],this.images[0]={image:me.loader.getImage("stage-1-cutscene-1"),x:0,y:0},this.images[1]={image:me.loader.getImage("stage-1-cutscene-2"),x:0,y:480},this.images[2]={image:me.loader.getImage("stage-1-cutscene-3"),x:0,y:480},this.images[3]={image:me.loader.getImage("stage-1-cutscene-4"),x:0,y:480},this.imageCounter=0,this.isMovingFrame=!1,game.data.inputObserver.isAcceptingInput=!0,me.audio.playTrack("movie")},draw:function(a){a.fillStyle="#000",a.fillRect(0,0,640,480),a.drawImage(this.images[this.imageCounter].image,this.images[this.imageCounter].x,this.images[this.imageCounter].y),this.imageCounter+1<this.images.length&&a.drawImage(this.images[this.imageCounter+1].image,this.images[this.imageCounter+1].x,this.images[this.imageCounter+1].y)},update:function(){return game.data.inputObserver.isPausePressed()||this.imageCounter+1===this.images.length&&game.data.inputObserver.isAcceptingInput&&game.data.inputObserver.isShootPressed()?(game.data.inputObserver.isAcceptingInput=!1,this.isMovingFrame=!0,me.audio.stopTrack("movie"),me.state.change(game.level_data.STAGE1)):!this.isMovingFrame&&game.data.inputObserver.isAcceptingInput&&game.data.inputObserver.isShootPressed()?this.isMovingFrame=!0:this.isMovingFrame&&(this.images[this.imageCounter+1].y=this.images[this.imageCounter+1].y-20,0===this.images[this.imageCounter+1].y&&(this.imageCounter=this.imageCounter+1,this.isMovingFrame=!1,game.data.inputObserver.isAcceptingInput=!0)),!0}}),game.Stage2Movie=me.ScreenObject.extend({init:function(){this.parent(!0)},onDestroyEvent:function(){},onResetEvent:function(){game.data.frameCount=0,this.images=[],this.images[0]={image:me.loader.getImage("stage-2-cutscene-1"),x:0,y:0},this.images[1]={image:me.loader.getImage("stage-2-cutscene-2"),x:0,y:480},this.images[2]={image:me.loader.getImage("stage-2-cutscene-3"),x:0,y:480},this.images[3]={image:me.loader.getImage("stage-2-cutscene-4"),x:0,y:480},this.imageCounter=0,this.isMovingFrame=!1,game.data.inputObserver.isAcceptingInput=!0,me.audio.playTrack("movie")},draw:function(a){a.fillStyle="#000",a.fillRect(0,0,640,480),a.drawImage(this.images[this.imageCounter].image,this.images[this.imageCounter].x,this.images[this.imageCounter].y),this.imageCounter+1<this.images.length&&a.drawImage(this.images[this.imageCounter+1].image,this.images[this.imageCounter+1].x,this.images[this.imageCounter+1].y)},update:function(){return game.data.inputObserver.isPausePressed()||this.imageCounter+1===this.images.length&&game.data.inputObserver.isAcceptingInput&&game.data.inputObserver.isShootPressed()?(game.data.inputObserver.isAcceptingInput=!1,this.isMovingFrame=!0,me.audio.stopTrack("movie"),me.state.change(game.level_data.STAGE2_PT1)):!this.isMovingFrame&&game.data.inputObserver.isAcceptingInput&&game.data.inputObserver.isShootPressed()?this.isMovingFrame=!0:this.isMovingFrame&&(this.images[this.imageCounter+1].y=this.images[this.imageCounter+1].y-20,0===this.images[this.imageCounter+1].y&&(this.imageCounter=this.imageCounter+1,this.isMovingFrame=!1,game.data.inputObserver.isAcceptingInput=!0)),!0}}),game.Stage1=me.ScreenObject.extend({init:function(){this.parent(!0)},onResetEvent:function(){me.levelDirector.loadLevel("desert"),game.data.checkpoint=game.level_data.STAGE1,game.data.frameCount=0,game.data.player=me.game.getEntityByName("player")[0],game.data.playerHeatlh=4,game.data.isAcceptingInput=!0,game.data.sniperScope=me.game.getEntityByName("sniper-scope-enemy")[0],game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,game.data.isPlayerDead=!1,game.stage1_data.snipingStarted=!1,game.stage1_data.snipingComplete=!1,game.data.sniperScope.alwaysUpdate=!0,game.data.sugarShotOnScreen=!1,game.stage1_data.dialogShown=!1,this.isPauseDown=!1,game.data.inputObserver.resetState(),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause),me.audio.isAudioEnable()&&me.audio.playTrack("stage-1-bg")},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){game.data.frameCount=game.data.frameCount+1,60==game.data.frameCount?(me.game.currentLevel.getLayerByName("bg2").image=me.loader.getImage("oilbg-3"),game.data.frameCount=0):40==game.data.frameCount?me.game.currentLevel.getLayerByName("bg2").image=me.loader.getImage("oilbg-2"):20==game.data.frameCount&&(me.game.currentLevel.getLayerByName("bg2").image=me.loader.getImage("oilbg-1")),!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0);var a=game.data.player.collide();if(a&&a.obj.type==game.data.WARP_TYPE)me.audio.pauseTrack(),game.data.checkpoint=game.level_data.STAGE1_PT2,me.state.change(game.level_data.STAGE1_PT2);else if(!a||game.stage1_data.snipingStarted||game.stage1_data.snipingComplete||a.obj.type!=game.data.STARTSNIPE_TYPE)a&&game.stage1_data.snipingStarted&&!game.stage1_data.snipingComplete&&a.obj.type==game.data.STOPSNIPE_TYPE&&(game.data.sniperScope.visible=!1,game.data.sniperScope.alwaysUpdate=!1,game.stage1_data.snipingComplete=!0);else{game.stage1_data.snipingStarted=!0,game.data.sniperScope.visible=!0;var b=new game.EventAlertEntity;me.game.add(b)}return!0}}),game.Stage1pt2=me.ScreenObject.extend({init:function(){this.parent(!0),this.isPaused=!1},onResetEvent:function(){me.audio.isAudioEnable()&&("stage-1-bg"!==me.audio.getCurrentTrack()?me.audio.playTrack("stage-1-bg"):me.audio.resumeTrack()),me.levelDirector.loadLevel("desert2"),game.data.inputObserver.resetState(),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,this.isPauseDown=!1,game.data.player=me.game.getEntityByName("player")[0],game.data.isPlayerDead=!1,game.data.sugarShotOnScreen=!1,game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0);var a=game.data.player.collide();return a&&a.obj.type==game.data.WARP_TYPE&&(me.audio.pauseTrack(),game.data.isBossDead=!1,game.data.checkpoint=game.level_data.STAGE1_PT3,me.state.change(game.level_data.STAGE1_PT3)),!0}}),game.Stage1pt3=me.ScreenObject.extend({init:function(){this.parent(!0),this.isPaused=!1},onResetEvent:function(){me.audio.isAudioEnable()&&(me.audio.stopTrack(),me.audio.playTrack("boss")),me.levelDirector.loadLevel("desert3"),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,game.data.player=me.game.getEntityByName("player")[0],game.data.isPlayerDead=!1,game.data.sugarShotOnScreen=!1,game.data.inputObserver.resetState(),game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,this.isPauseDown=!1,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){return!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0),game.data.isBossDead&&(me.audio.stopTrack(),me.state.change(game.level_data.STAGE2_MOVIE)),!0}}),game.Stage2pt1=me.ScreenObject.extend({init:function(){this.parent(!0)},onResetEvent:function(){me.audio.isAudioEnable()&&(me.audio.stopTrack(),me.audio.playTrack("stage-2-bg")),me.levelDirector.loadLevel("jungle1"),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,game.data.frameCount=0,game.data.player=me.game.getEntityByName("player")[0],game.data.isPlayerDead=!1,game.data.sugarShotOnScreen=!1,game.data.checkpoint=game.level_data.STAGE2_PT1,game.data.isPaused=!1,game.data.inputObserver.resetState(),game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,game.data.playerHealth=4,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){game.data.frameCount=game.data.frameCount+1,20==game.data.frameCount?me.game.currentLevel.getLayerByName("bg").image=me.loader.getImage("junglebg-2"):game.data.frameCount>=40&&(me.game.currentLevel.getLayerByName("bg").image=me.loader.getImage("junglebg-1"),game.data.frameCount=0),!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0);var a=game.data.player.collide();a&&a&&a.obj.type==game.data.WARP_TYPE&&(me.audio.pauseTrack(),game.data.checkpoint=game.level_data.STAGE2_PT2,me.state.change(game.level_data.STAGE2_PT2))}}),game.Stage2pt2=me.ScreenObject.extend({init:function(){this.parent(!0)},onResetEvent:function(){me.audio.isAudioEnable()&&("stage-2-bg"!==me.audio.getCurrentTrack()?me.audio.playTrack("stage-2-bg"):me.audio.resumeTrack()),me.levelDirector.loadLevel("jungle2"),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,this.isRotating=!1,this.delayFrames=0,this.mapOffset=0,this.MAX_DELAY_FRAMES=20,this.alwaysUpdate=!0,game.data.player=me.game.getEntityByName("player")[0],game.data.isPlayerDead=!1,game.data.sugarShotOnScreen=!1,game.data.isPaused=!1,game.data.inputObserver.resetState(),game.data.frameCount=0,game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){game.data.frameCount=game.data.frameCount+1,20==game.data.frameCount?me.game.currentLevel.getLayerByName("bg").image=me.loader.getImage("junglebg-2"):game.data.frameCount>=40&&(me.game.currentLevel.getLayerByName("bg").image=me.loader.getImage("junglebg-1"),game.data.frameCount=0),!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0);var a=game.data.player.collide();return a&&a.obj.type==game.data.WARP_TYPE&&(me.audio.pauseTrack(),game.data.isBossDead=!1,game.data.checkpoint=game.level_data.STAGE2_PT3,me.state.change(game.level_data.STAGE2_PT3)),!0}}),game.Stage2pt3=me.ScreenObject.extend({init:function(){this.parent(!0),this.isPaused=!1},onResetEvent:function(){me.audio.isAudioEnable()&&(me.audio.stopTrack(),me.audio.playTrack("boss")),me.levelDirector.loadLevel("jungle3"),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,game.data.player=me.game.getEntityByName("player")[0],game.data.isPlayerDead=!1,game.data.sugarShotOnScreen=!1,game.data.inputObserver.resetState(),game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,this.isPauseDown=!1,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){return!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0),game.data.isBossDead&&(me.audio.stopTrack(),me.state.change(game.level_data.STAGE3_MOVIE)),!0}}),game.Stage3Movie=me.ScreenObject.extend({init:function(){this.parent(!0)},onDestroyEvent:function(){},onResetEvent:function(){game.data.frameCount=0,this.images=[],this.images[0]={image:me.loader.getImage("stage-3-cutscene-1"),x:0,y:0},this.images[1]={image:me.loader.getImage("stage-3-cutscene-2"),x:0,y:480},this.images[2]={image:me.loader.getImage("stage-3-cutscene-3"),x:0,y:480},this.images[3]={image:me.loader.getImage("stage-3-cutscene-4"),x:0,y:480},this.imageCounter=0,this.isMovingFrame=!1,game.data.inputObserver.isAcceptingInput=!0,me.audio.playTrack("movie")},draw:function(a){a.fillStyle="#000",a.fillRect(0,0,640,480),a.drawImage(this.images[this.imageCounter].image,this.images[this.imageCounter].x,this.images[this.imageCounter].y),this.imageCounter+1<this.images.length&&a.drawImage(this.images[this.imageCounter+1].image,this.images[this.imageCounter+1].x,this.images[this.imageCounter+1].y)},update:function(){return game.data.inputObserver.isPausePressed()||this.imageCounter+1===this.images.length&&game.data.inputObserver.isAcceptingInput&&game.data.inputObserver.isShootPressed()?(game.data.inputObserver.isAcceptingInput=!1,this.isMovingFrame=!0,me.audio.stopTrack("movie"),me.state.change(game.screen_data.GAME_COMPLETE)):!this.isMovingFrame&&game.data.inputObserver.isAcceptingInput&&game.data.inputObserver.isShootPressed()?this.isMovingFrame=!0:this.isMovingFrame&&(this.images[this.imageCounter+1].y=this.images[this.imageCounter+1].y-20,0===this.images[this.imageCounter+1].y&&(this.imageCounter=this.imageCounter+1,this.isMovingFrame=!1,game.data.inputObserver.isAcceptingInput=!0)),!0}}),game.Stage3pt1=me.ScreenObject.extend({init:function(){this.parent(!0)},onResetEvent:function(){me.levelDirector.loadLevel("desert"),game.data.checkpoint=game.level_data.STAGE1,game.data.frameCount=0,game.data.player=me.game.getEntityByName("player")[0],game.data.playerHeatlh=4,game.data.isAcceptingInput=!0,game.data.sniperScope=me.game.getEntityByName("sniper-scope-enemy")[0],game.data.stageWidth=me.game.currentLevel.cols*me.game.currentLevel.tilewidth,game.data.stageHeight=me.game.currentLevel.rows*me.game.currentLevel.tileheight,game.data.isPlayerDead=!1,game.stage1_data.snipingStarted=!1,game.stage1_data.snipingComplete=!1,game.data.sniperScope.alwaysUpdate=!0,game.data.sugarShotOnScreen=!1,game.stage1_data.dialogShown=!1,this.isPauseDown=!1,game.data.inputObserver.resetState(),this.HUD=new game.HUD.Container,this.pause=new game.pause.Container,this.pause.visible=!1,me.game.world.addChild(this.HUD),me.game.world.addChild(this.pause),me.audio.isAudioEnable()&&me.audio.playTrack("stage-3-bg")},onDestroyEvent:function(){me.game.world.removeChild(this.HUD),me.game.world.removeChild(this.pause)},update:function(){game.data.frameCount=game.data.frameCount+1,60==game.data.frameCount?(me.game.currentLevel.getLayerByName("bg2").image=me.loader.getImage("oilbg-3"),game.data.frameCount=0):40==game.data.frameCount?me.game.currentLevel.getLayerByName("bg2").image=me.loader.getImage("oilbg-2"):20==game.data.frameCount&&(me.game.currentLevel.getLayerByName("bg2").image=me.loader.getImage("oilbg-1")),!game.data.inputObserver.isPausePressed()||this.isPauseDown||game.data.isPaused?game.data.inputObserver.isPausePressed()&&!this.isPauseDown&&game.data.isPaused?(me.audio.resumeTrack(),this.isPauseDown=!0,game.data.isPaused=!1,this.pause.visible=!1):game.data.inputObserver.isPausePressed()||(this.isPauseDown=!1):(me.audio.pauseTrack(),me.audio.play("pause-sfx"),this.isPauseDown=!0,game.data.isPaused=!0,this.pause.visible=!0);var a=game.data.player.collide();if(a&&a.obj.type==game.data.WARP_TYPE)me.audio.pauseTrack(),game.data.checkpoint=game.level_data.STAGE1_PT2,me.state.change(game.level_data.STAGE1_PT2);else if(!a||game.stage1_data.snipingStarted||game.stage1_data.snipingComplete||a.obj.type!=game.data.STARTSNIPE_TYPE)a&&game.stage1_data.snipingStarted&&!game.stage1_data.snipingComplete&&a.obj.type==game.data.STOPSNIPE_TYPE&&(game.data.sniperScope.visible=!1,game.data.sniperScope.alwaysUpdate=!1,game.stage1_data.snipingComplete=!0);else{game.stage1_data.snipingStarted=!0,game.data.sniperScope.visible=!0;var b=new game.EventAlertEntity;me.game.add(b)}return!0}}),game.GameCompleteScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.image=me.loader.getImage("thankyou"),game.data.checkpoint=game.level_data.STAGE1,game.data.isBossDead=!1,this.isPressed=!1,this.idleFrames=0,this.MAX_IDLE_FRAMES=180},onResetEvent:function(){this.isPressed=!1},onDestroyEvent:function(){},draw:function(a){a.drawImage(this.image,0,0)},update:function(){return this.idleFrames>=this.MAX_IDLE_FRAMES&&me.input.isKeyPressed("shoot")&&!this.isPressed&&(this.isPressed=!0,me.state.change(game.screen_data.TITLE)),this.idleFrames=this.idleFrames+1,!0}});